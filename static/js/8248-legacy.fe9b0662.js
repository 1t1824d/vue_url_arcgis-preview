"use strict";(self["webpackChunkvue_url_arcgis"]=self["webpackChunkvue_url_arcgis"]||[]).push([[8248],{10030:function(e,t,r){r.d(t,{j:function(){return c}});var i=r(76133),a=r(92751),n=r(99418),s=r(49161),o=(r(69600),r(21249),r(57327),r(41539),r(68309),r(54747),r(9653),r(63825)),u=r(44171),l=r(48595),h=r(2553),p=(r(57787),r(35425),r(90202),r(92236)),y={visible:"visibleSublayers"},c=function(e){(0,n.Z)(r,e);var t=(0,s.Z)(r);function r(e){var a;return(0,i.Z)(this,r),a=t.call(this,e),a.scale=0,a}return(0,a.Z)(r,[{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.sublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("wms-sublayer-update",(function(e){return t.notifyChange(y[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){var e=this.visibleSublayers;return e.filter((function(e){return e.name})).map((function(e){return e.name})).join(",")}},{key:"version",get:function(){this.commitProperty("layers");var e=this.layer;return e&&e.commitProperty("imageTransparency"),(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){var e=this.layer,t=this.scale,r=null==e?void 0:e.sublayers,i=[],a=function e(r){var a=r.minScale,n=r.maxScale,s=r.sublayers,o=r.visible;o&&(0===t||(0===a||t<=a)&&(0===n||t>=n))&&(s?s.forEach(e):i.unshift(r))};return null==r||r.forEach(a),i}},{key:"toJSON",value:function(){var e=this.layer,t=this.layers,r=e.imageFormat,i=e.imageTransparency,a=e.version;return{format:r,request:"GetMap",service:"WMS",styles:"",transparent:i,version:a,layers:t}}}]),r}((0,l.p)(u.Z));(0,o._)([(0,h.Cb)()],c.prototype,"layer",null),(0,o._)([(0,h.Cb)({readOnly:!0})],c.prototype,"layers",null),(0,o._)([(0,h.Cb)({type:Number})],c.prototype,"scale",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],c.prototype,"version",null),(0,o._)([(0,h.Cb)({readOnly:!0})],c.prototype,"visibleSublayers",null),c=(0,o._)([(0,p.j)("esri.layers.support.ExportWMSImageParameters")],c)},38248:function(e,t,r){r.r(t),r.d(t,{default:function(){return P}});var i=r(4367),a=r(16198),n=r(76133),s=r(92751),o=r(99418),u=r(49161),l=(r(78975),r(41539),r(63825)),h=r(25585),p=r(87441),y=r(24446),c=r(2553),m=(r(57787),r(35425),r(90202),r(92236)),v=r(7230),f=r(26797),d=r(21211),g=r(33503),b=r(74139),w=r(68801),x=r(15387),_=r(10030),k=function(e){var t=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"initialize",value:function(){this.exportImageParameters=new _.j({layer:this.layer})}},{key:"destroy",value:function(){this.exportImageParameters.destroy(),this.exportImageParameters=null}},{key:"exportImageVersion",get:function(){var e;return null==(e=this.exportImageParameters)||e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}},{key:"fetchPopupFeatures",value:function(e){var t=this.layer;if(!e)return Promise.reject(new h.Z("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t}));var r=t.popupEnabled;if(!r)return Promise.reject(new h.Z("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:r}));var i=this.createFetchPopupFeaturesQuery(e);if(!i)return Promise.resolve([]);var a=i.extent,n=i.width,s=i.height,o=i.x,u=i.y;if(!(a&&n&&s))throw new h.Z("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:a,width:n,height:s});var l=t.fetchFeatureInfo(a,n,s,o,u);return Promise.resolve(l?[l]:[])}}]),r}(e);return(0,l._)([(0,c.Cb)()],t.prototype,"exportImageParameters",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,l._)([(0,c.Cb)()],t.prototype,"layer",void 0),(0,l._)([(0,c.Cb)(x.qG)],t.prototype,"timeExtent",void 0),t=(0,l._)([(0,m.j)("esri.layers.mixins.WMSLayerView")],t),t},C=p.Z.getLogger("esri.views.2d.layers.WMSLayerView2D"),Z=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"initialize",value:function(){var e=this.layer,t=this.view;e.supportsSpatialReference(t.spatialReference)||this.addResolvingPromise(Promise.reject(new h.Z("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view",{layer:e})))}},{key:"update",value:function(e){this.strategy.update(e).catch((function(e){(0,y.D_)(e)||C.error(e)}))}},{key:"attach",value:function(){var e=this,t=this.layer,r=t.imageMaxHeight,i=t.imageMaxWidth;this._bitmapContainer=new f.c,this.container.addChild(this._bitmapContainer),this.strategy=new g.Z({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:r,imageMaxWidth:i,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch("exportImageVersion",(function(){return e.requestUpdate()})),"exportImageVersion")}},{key:"detach",value:function(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"createFetchPopupFeaturesQuery",value:function(e){var t=this.view,r=this._bitmapContainer,i=e.x,a=e.y,n=t.spatialReference,s=null,o=0,u=0;if(r.children.some((function(e){var t=e.width,r=e.height,l=e.resolution,h=e.x,p=e.y,y=h+l*t,c=p-l*r;return i>=h&&i<=y&&a<=p&&a>=c&&(s=new v.Z({xmin:h,ymin:c,xmax:y,ymax:p,spatialReference:n}),o=t,u=r,!0)})),!s)return null;var l=s.width/o,h=Math.round((i-s.xmin)/l),p=Math.round((s.ymax-a)/l);return{extent:s,width:o,height:u,x:h,y:p}}},{key:"doRefresh",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"fetchImage",value:function(e,t,r,a){return this.layer.fetchImage(e,t,r,(0,i.Z)({timeExtent:this.timeExtent},a))}}]),r}(k((0,w.y)((0,d.y)(b.Z))));(0,l._)([(0,c.Cb)()],Z.prototype,"strategy",void 0),(0,l._)([(0,c.Cb)()],Z.prototype,"updating",void 0),Z=(0,l._)([(0,m.j)("esri.views.2d.layers.WMSLayerView2D")],Z);var P=Z}}]);