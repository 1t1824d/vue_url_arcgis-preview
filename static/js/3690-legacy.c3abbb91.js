"use strict";(self["webpackChunkvue_url_arcgis"]=self["webpackChunkvue_url_arcgis"]||[]).push([[3690],{73690:function(e,n,t){t.r(n),t.d(n,{registerFunctions:function(){return O}});var r=t(62032),a=(t(41539),t(38862),t(21703),t(68309),t(57327),t(47042),t(39714),t(92222),t(85251)),i=t(60390),l=t(6133),o=t(63377),s=t(7353),u=t(21735),c=t(16647),f=t(9327),d=t(39589),y=t(40618),p=t(63497),m=t(92630),h=t(88913),v=t(68603),g=t(91662),F=t(75461),E=t(85788),I=t(13122),D=t(24446),w=t(77263),b=t(42995),N=t(46713);function x(e,n,t,r){if(1===r.length){if((0,f.a)(r[0]))return(0,I.t)(e,r[0],-1);if((0,f.b)(r[0]))return(0,I.t)(e,r[0].toArray(),-1)}return(0,I.t)(e,r,-1)}function A(e,n,t){var r=e.getVariables();if(r.length>0){for(var a=[],i=0;i<r.length;i++){var l={name:r[i]};a.push(n.evaluateIdentifier(t,l))}return(0,D.$6)(a).then((function(n){for(var t={},a=0;a<r.length;a++)t[r[a]]=n[a];return e.parameters=t,e}))}return(0,D.DB)(e)}function S(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(var r in e)if(r.toLowerCase()===n.toLowerCase())return e[r];return t}function Z(e){if(null===e)return null;var n={type:S(e,"type",""),name:S(e,"name","")};if("range"===n.type)n.range=S(e,"range",[]);else{n.codedValues=[];var t,a=(0,r.Z)(S(e,"codedValues",[]));try{for(a.s();!(t=a.n()).done;){var i=t.value;n.codedValues.push({name:S(i,"name",""),code:S(i,"code",null)})}}catch(l){a.e(l)}finally{a.f()}}return n}function C(e){if(null===e)return null;var n={},t=S(e,"wkt",null);null!==t&&(n.wkt=t);var r=S(e,"wkid",null);return null!==r&&(n.wkid=r),n}function T(e){if(null===e)return null;var n={hasZ:S(e,"hasz",!1),hasM:S(e,"hasm",!1)},t=S(e,"spatialreference",null);t&&(n.spatialReference=C(t));var r=S(e,"x",null);if(null!==r)return n.x=r,n.y=S(e,"y",null),n;var a=S(e,"rings",null);if(null!==a)return n.rings=a,n;var i=S(e,"paths",null);if(null!==i)return n.paths=i,n;var l=S(e,"points",null);if(null!==l)return n.points=l,n;for(var o=0,s=["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"];o<s.length;o++){var u=s[o],c=S(e,u,null);null!==c&&(n[u]=c)}return n}function L(e,n){var t,a=(0,r.Z)(n);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(i===e)return!0}}catch(l){a.e(l)}finally{a.f()}return!1}function P(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==L(e.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==(0,f.a)(e.layerDefinition.fields)&&!1!==(0,f.a)(e.featureSet.features)}function O(e){"async"===e.mode&&(e.functions.getuser=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){(0,f.p)(r,1,2);var l=(0,f.E)(r[1],""),o=!0===l;if(l=!0===l||!1===l?"":(0,f.d)(l),r[0]instanceof a.Z){var u=null;return n.services&&n.services.portal&&(u=n.services.portal),u=(0,s.getPortal)(r[0],u),(0,s.lookupUser)(u,l,o).then((function(e){if(e){for(var n=JSON.parse(JSON.stringify(e)),t=0,r=["lastLogin","created","modified"];t<r.length;t++){var a=r[t];void 0!==n[a]&&null!==n[a]&&(n[a]=new Date(n[a]))}return i.Z.convertObjectToArcadeDictionary(n)}return null}))}var c=null;if((0,f.o)(r[0])&&(c=r[0]),c)return o=!1,l?null:c.load().then((function(){return c.getOwningSystemUrl()})).then((function(e){if(!e)return l?null:c.getIdentityUser().then((function(e){return e?i.Z.convertObjectToArcadeDictionary({username:e}):null}));var t=null;return n.services&&n.services.portal&&(t=n.services.portal),t=(0,s.getPortal)(new a.Z(e),t),(0,s.lookupUser)(t,l,o).then((function(e){if(e){for(var n=JSON.parse(JSON.stringify(e)),t=0,r=["lastLogin","created","modified"];t<r.length;t++){var a=r[t];void 0!==n[a]&&null!==n[a]&&(n[a]=new Date(n[a]))}return i.Z.convertObjectToArcadeDictionary(n)}return null}))}));throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getuser",min:"1",max:"2"}),e.functions.featuresetbyid=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if((0,f.p)(t,2,4),t[0]instanceof o.Z){var r=(0,f.d)(t[1]),a=(0,f.E)(t[2],null),i=(0,f.y)((0,f.E)(t[3],!0));if(null===a&&(a=["*"]),!1===(0,f.a)(a))throw new Error("Invalid Parameter");return t[0].featureSetById(r,i,a)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.getfeatureset=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){if((0,f.p)(r,1,2),r[0]instanceof l.Z){var a=(0,f.E)(r[1],"datasource");return null===a&&(a="datasource"),a=(0,f.d)(a).toLowerCase(),(0,s.convertToFeatureSet)(r[0]._layer,a,n.lrucache,n.interceptor,n.spatialReference)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getfeatureset",min:"1",max:"2"}),e.functions.featuresetbyportalitem=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){if((0,f.p)(r,2,5),null===r[0])throw new Error("Portal is required");if(r[0]instanceof a.Z){var i=(0,f.d)(r[1]),l=(0,f.d)(r[2]),o=(0,f.E)(r[3],null),u=(0,f.y)((0,f.E)(r[4],!0));if(null===o&&(o=["*"]),!1===(0,f.a)(o))throw new Error("Invalid Parameter");var c=null;return n.services&&n.services.portal&&(c=n.services.portal),c=(0,s.getPortal)(r[0],c),(0,s.constructFeatureSetFromPortalItem)(i,l,n.spatialReference,o,u,c,n.lrucache,n.interceptor)}if(!1===(0,f.f)(r[0]))throw new Error("Portal is required");var d=(0,f.d)(r[0]),y=(0,f.d)(r[1]),p=(0,f.E)(r[2],null),m=(0,f.y)((0,f.E)(r[3],!0));if(null===p&&(p=["*"]),!1===(0,f.a)(p))throw new Error("Invalid Parameter");if(n.services&&n.services.portal)return(0,s.constructFeatureSetFromPortalItem)(d,y,n.spatialReference,p,m,n.services.portal,n.lrucache,n.interceptor);throw new Error("Portal is required")}))},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),e.functions.featuresetbyname=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if((0,f.p)(t,2,4),t[0]instanceof o.Z){var r=(0,f.d)(t[1]),a=(0,f.E)(t[2],null),i=(0,f.y)((0,f.E)(t[3],!0));if(null===a&&(a=["*"]),!1===(0,f.a)(a))throw new Error("Invalid Parameter");return t[0].featureSetByName(r,i,a)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(n,t){return e.standardFunction(n,t,(function(e,t,a){(0,f.p)(a,1,1);var l=a[0],o={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if((0,f.f)(l))l=JSON.parse(l),void 0!==l.layerDefinition?(o.layerDefinition=l.layerDefinition,o.featureSet=l.featureSet,l.layerDefinition.spatialReference&&(o.layerDefinition.spatialReference=l.layerDefinition.spatialReference)):(o.featureSet.features=l.features,o.featureSet.geometryType=l.geometryType,o.layerDefinition.geometryType=o.featureSet.geometryType,o.layerDefinition.objectIdField=l.objectIdFieldName,o.layerDefinition.typeIdField=l.typeIdFieldName,o.layerDefinition.globalIdField=l.globalIdFieldName,o.layerDefinition.fields=l.fields,l.spatialReference&&(o.layerDefinition.spatialReference=l.spatialReference));else{if(!(a[0]instanceof i.Z))throw new Error("Invalid Parameter");l=JSON.parse(a[0].castToText());var s=S(l,"layerdefinition");if(null!==s){o.layerDefinition.geometryType=S(s,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.globalIdField=S(s,"globalidfield",""),o.layerDefinition.objectIdField=S(s,"objectidfield",""),o.layerDefinition.typeIdField=S(s,"typeidfield","");var u=S(s,"spatialreference",null);u&&(o.layerDefinition.spatialReference=C(u));var c,d=(0,r.Z)(S(s,"fields",[]));try{for(d.s();!(c=d.n()).done;){var y=c.value,p={name:S(y,"name",""),alias:S(y,"alias",""),type:S(y,"type",""),nullable:S(y,"nullable",!0),editable:S(y,"editable",!0),length:S(y,"length",null),domain:Z(S(y,"domain"))};o.layerDefinition.fields.push(p)}}catch(J){d.e(J)}finally{d.f()}var m=S(l,"featureset",null);if(m){var h,g={},F=(0,r.Z)(o.layerDefinition.fields);try{for(F.s();!(h=F.n()).done;){var E=h.value;g[E.name.toLowerCase()]=E.name}}catch(J){F.e(J)}finally{F.f()}var I,D=(0,r.Z)(S(m,"features",[]));try{for(D.s();!(I=D.n()).done;){var w=I.value,b={},N=S(w,"attributes",{});for(var x in N)b[g[x.toLowerCase()]]=N[x];o.featureSet.features.push({attributes:b,geometry:T(S(w,"geometry",null))})}}catch(J){D.e(J)}finally{D.f()}}}else{o.layerDefinition.geometryType=S(l,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.objectIdField=S(l,"objectidfieldname",""),o.layerDefinition.typeIdField=S(l,"typeidfieldname","");var A=S(l,"spatialreference",null);A&&(o.layerDefinition.spatialReference=C(A));var L,O=(0,r.Z)(S(l,"fields",[]));try{for(O.s();!(L=O.n()).done;){var R=L.value,W={name:S(R,"name",""),alias:S(R,"alias",""),type:S(R,"type",""),nullable:S(R,"nullable",!0),editable:S(R,"editable",!0),length:S(R,"length",null),domain:Z(S(R,"domain"))};o.layerDefinition.fields.push(W)}}catch(J){O.e(J)}finally{O.f()}var B,k={},M=(0,r.Z)(o.layerDefinition.fields);try{for(M.s();!(B=M.n()).done;){var G=B.value;k[G.name.toLowerCase()]=G.name}}catch(J){M.e(J)}finally{M.f()}var j,V=(0,r.Z)(S(l,"features",[]));try{for(V.s();!(j=V.n()).done;){var H=j.value,_={},X=S(H,"attributes",{});for(var z in X)_[k[z.toLowerCase()]]=X[z];o.featureSet.features.push({attributes:_,geometry:T(S(H,"geometry",null))})}}catch(J){V.e(J)}finally{V.f()}}}if(!1===P(o))throw new Error("Invalid Parameter");return v.Z.create(o,n.spatialReference)}))},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(n,t){return e.standardFunctionAsync(n,t,(function(t,r,a){if((0,f.p)(a,2,2),(0,f.a)(a[0])||(0,f.b)(a[0])){var i=[],l=a[0];l instanceof c.Z&&(l=l.toArray());var o=null;if(a[1]instanceof u.Z)o=e.arcadeCustomFunctionHandler(a[1]);else if(a[1]instanceof f.N)o=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return a[1].fn(n,{preparsed:!0,arguments:t})};else{if(!(a[1]instanceof f.S))throw new Error("Invalid Parameter");o=function(){var e;if(arguments.length!==a[1].paramCount)throw new Error("Invalid parameters");return(e=a[1]).fn.apply(e,arguments)}}return l.reduce((function(e,n,t){return e.then((function(e){t>0&&!0===e&&i.push(l[t-1]);var r=o(n);return(0,D.y8)(r)?r:(0,D.DB)(r)}))}),Promise.resolve(!1)).then((function(e){return!0===e&&l.length>0&&i.push(l[l.length-1]),i}))}return(0,f.o)(a[0])?a[0].load().then((function(t){var r=w.WhereClause.create(a[1],t.getFieldsIndex()),i=r.getVariables();if(i.length>0){for(var l=[],o=0;o<i.length;o++){var s={name:i[o]};l.push(e.evaluateIdentifier(n,s))}return(0,D.$6)(l).then((function(e){for(var n={},t=0;t<i.length;t++)n[i[t]]=e[t];return r.parameters=n,new y.Z({parentfeatureset:a[0],whereclause:r})}))}return(0,D.DB)(new y.Z({parentfeatureset:a[0],whereclause:r}))})):e.failDefferred("Filter cannot accept this parameter type")}))},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(n,t){return e.standardFunctionAsync(n,t,(function(n,t,r){if((0,f.p)(r,2,2),(0,f.o)(r[0])){var a=new g.Z(r[1]);return(0,D.DB)(new p.Z({parentfeatureset:r[0],orderbyclause:a}))}return e.failDefferred("Order cannot accept this parameter type")}))},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(n,t){return e.standardFunctionAsync(n,t,(function(n,t,r){return(0,f.p)(r,2,2),(0,f.o)(r[0])?(0,D.DB)(new m.Z({parentfeatureset:r[0],topnum:r[1]})):(0,f.a)(r[0])?(0,f.t)(r[1])>=r[0].length?r[0].slice(0):r[0].slice(0,(0,f.t)(r[1])):(0,f.b)(r[0])?(0,f.t)(r[1])>=r[0].length()?r[0].slice(0):r[0].slice(0,(0,f.t)(r[1])):e.failDefferred("Top cannot accept this parameter type")}))},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return(0,f.p)(t,1,1),(0,f.o)(t[0])?t[0].first(e.abortSignal).then((function(e){if(null!==e){var n=l.Z.createFromGraphicLikeObject(e.geometry,e.attributes,t[0]);n._underlyingGraphic=e,e=n}return e})):(0,f.a)(t[0])?0===t[0].length?(0,D.DB)(null):(0,D.DB)(t[0][0]):(0,f.b)(t[0])?0===t[0].length()?(0,D.DB)(null):(0,D.DB)(t[0].get(0)):null}))},e.signatures.push({name:"first",min:"1",max:"1"}),e.functions.attachments=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){(0,f.p)(r,1,2);var a={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(r.length>1)if(r[1]instanceof i.Z){if(r[1].hasField("minsize")&&(a.minsize=(0,f.t)(r[1].field("minsize"))),r[1].hasField("metadata")&&(a.returnMetadata=(0,f.y)(r[1].field("metadata"))),r[1].hasField("maxsize")&&(a.maxsize=(0,f.t)(r[1].field("maxsize"))),r[1].hasField("types")){var o=(0,f.V)(r[1].field("types"),!1);o.length>0&&(a.types=o)}}else if(null!==r[1])throw new Error("Invalid Parameter");if(r[0]instanceof l.Z){var u=r[0]._layer;return u instanceof b["default"]&&(u=(0,s.constructFeatureSet)(u,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===u||!1===(0,f.o)(u)?[]:u.load().then((function(){return u.queryAttachments(r[0].field(u.objectIdField),a.minsize,a.maxsize,a.types,a.returnMetadata)}))}if(null===r[0])return[];throw new Error("Invalid Parameter")}))},e.signatures.push({name:"attachments",min:"1",max:"2"}),e.functions.featuresetbyrelationshipname=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){(0,f.p)(r,2,4);var a=r[0],i=(0,f.d)(r[1]),o=(0,f.E)(r[2],null),u=(0,f.y)((0,f.E)(r[3],!0));if(null===o&&(o=["*"]),!1===(0,f.a)(o))throw new Error("Invalid Parameter");if(null===r[0])return null;if(!(r[0]instanceof l.Z))throw new Error("Invalid Parameter");var c=a._layer;return c instanceof b["default"]&&(c=(0,s.constructFeatureSet)(c,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===c||!1===(0,f.o)(c)?null:c.load().then((function(e){var t=e.relationshipMetaData().filter((function(e){return e.name===i}));if(0===t.length)return null;if(void 0!==t[0].relationshipTableId&&null!==t[0].relationshipTableId&&t[0].relationshipTableId>-1)return(0,s.constructFeatureSetFromRelationship)(e,t[0],a.field(e.objectIdField),e.spatialReference,o,u,n.lrucache,n.interceptor);var r=e.serviceUrl();return r?(r="/"===r.charAt(r.length-1)?r+t[0].relatedTableId.toString():r+"/"+t[0].relatedTableId.toString(),(0,s.constructFeatureSetFromUrl)(r,e.spatialReference,o,u,n.lrucache,n.interceptor).then((function(n){return n.load().then((function(){return n.relationshipMetaData()})).then((function(r){if(r=r.filter((function(e){return e.id===t[0].id})),!1===a.hasField(t[0].keyField)||null===a.field(t[0].keyField))return e.getFeatureByObjectId(a.field(e.objectIdField),[t[0].keyField]).then((function(e){if(e){var a=w.WhereClause.create(r[0].keyField+"= @id",n.getFieldsIndex());return a.parameters={id:e.attributes[t[0].keyField]},n.filter(a)}return new h.Z({parentfeatureset:n})}));var i=w.WhereClause.create(r[0].keyField+"= @id",n.getFieldsIndex());return i.parameters={id:a.field(t[0].keyField)},n.filter(i)}))}))):null}))}))},e.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),e.functions.featuresetbyassociation=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,a){(0,f.p)(a,2,3);var i=a[0],o=(0,f.d)((0,f.E)(a[1],"")).toLowerCase(),u=(0,f.f)(a[2])?(0,f.d)(a[2]):null;if(null===a[0])return null;if(!(a[0]instanceof l.Z))throw new Error("Invalid Parameter");var c=i._layer;return c instanceof b["default"]&&(c=(0,s.constructFeatureSet)(c,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===c||!1===(0,f.o)(c)?null:c.load().then((function(){var e=c.serviceUrl();return(0,s.constructAssociationMetaDataFeatureSetFromUrl)(e,n.spatialReference)})).then((function(e){var n=null,t=null,a=!1;if(null!==u&&""!==u&&void 0!==u){var l,s=(0,r.Z)(e.terminals);try{for(s.s();!(l=s.n()).done;){var y=l.value;y.terminalName===u&&(t=y.terminalId)}}catch(_){s.e(_)}finally{s.f()}null===t&&(a=!0)}var p,m=e.associations.getFieldsIndex(),h=m.get("TOGLOBALID").name,v=m.get("FROMGLOBALID").name,g=m.get("TOTERMINALID").name,E=m.get("FROMTERMINALID").name,I=m.get("FROMNETWORKSOURCEID").name,D=m.get("TONETWORKSOURCEID").name,b=m.get("ASSOCIATIONTYPE").name,x=m.get("ISCONTENTVISIBLE").name,A=m.get("OBJECTID").name,S=(0,r.Z)(c.fields);try{for(S.s();!(p=S.n()).done;){var Z=p.value;if("global-id"===Z.type){n=i.field(Z.name);break}}}catch(_){S.e(_)}finally{S.f()}var C=null,T=new d.yN(new N.Z({name:"percentalong",alias:"percentalong",type:"double"}),w.WhereClause.create("0",e.associations.getFieldsIndex())),L=new d.yN(new N.Z({name:"side",alias:"side",type:"string"}),w.WhereClause.create("''",e.associations.getFieldsIndex())),P="globalid",O="globalId",R={};for(var W in e.lkp)R[W]=e.lkp[W].sourceId;var B=new d.TO(new N.Z({name:"classname",alias:"classname",type:"string"}),null,R),k="";switch(o){case"midspan":k="((".concat(h,"='").concat(n,"') OR ( ").concat(v,"='").concat(n,"')) AND (").concat(b," IN (5))"),B.codefield=w.WhereClause.create("CASE WHEN (".concat(h,"='").concat(n,"') THEN ").concat(I," ELSE ").concat(D," END"),e.associations.getFieldsIndex());var M=(0,F.JW)(d.Xx.findField(e.associations.fields,v));M.name=P,M.alias=P,C=new d.yN(M,w.WhereClause.create("CASE WHEN (".concat(v,"='").concat(n,"') THEN ").concat(h," ELSE ").concat(v," END"),e.associations.getFieldsIndex())),T=e.unVersion>=4?new d.$X(d.Xx.findField(e.associations.fields,m.get("PERCENTALONG").name)):new d.yN(new N.Z({name:"percentalong",alias:"percentalong",type:"double"}),w.WhereClause.create("0",e.associations.getFieldsIndex()));break;case"junctionedge":k="((".concat(h,"='").concat(n,"') OR ( ").concat(v,"='").concat(n,"')) AND (").concat(b," IN (4,6))"),B.codefield=w.WhereClause.create("CASE WHEN (".concat(h,"='").concat(n,"') THEN ").concat(I," ELSE ").concat(D," END"),e.associations.getFieldsIndex());var G=(0,F.JW)(d.Xx.findField(e.associations.fields,v));G.name=P,G.alias=P,C=new d.yN(G,w.WhereClause.create("CASE WHEN (".concat(v,"='").concat(n,"') THEN ").concat(h," ELSE ").concat(v," END"),e.associations.getFieldsIndex())),L=new d.yN(new N.Z({name:"side",alias:"side",type:"string"}),w.WhereClause.create("CASE WHEN (".concat(b,"=4) THEN 'from' ELSE 'to' END"),e.associations.getFieldsIndex()));break;case"connected":var j="".concat(h,"='@T'"),V="".concat(v,"='@T'");null!==t&&(j+=" AND ".concat(g,"=@A"),V+=" AND ".concat(E,"=@A")),k="(("+j+") OR ("+V+"))",k=(0,f.P)(k,"@T",n),j=(0,f.P)(j,"@T",n),null!==t&&(j=(0,f.P)(j,"@A",t.toString()),k=(0,f.P)(k,"@A",t.toString())),B.codefield=w.WhereClause.create("CASE WHEN "+j+" THEN ".concat(I," ELSE ").concat(D," END"),e.associations.getFieldsIndex());var H=(0,F.JW)(d.Xx.findField(e.associations.fields,v));H.name=P,H.alias=P,C=new d.yN(H,w.WhereClause.create("CASE WHEN "+j+" THEN ".concat(v," ELSE ").concat(h," END"),e.associations.getFieldsIndex()));break;case"container":k="".concat(h,"='").concat(n,"' AND ").concat(b," = 2"),null!==t&&(k+=" AND ".concat(g," = ")+t.toString()),B.codefield=I,k="( "+k+" )",C=new d.QP(d.Xx.findField(e.associations.fields,v),P,P);case"content":k="(".concat(v,"='").concat(n,"' AND ").concat(b," = 2)"),null!==t&&(k+=" AND ".concat(E," = ")+t.toString()),B.codefield=D,k="( "+k+" )",C=new d.QP(d.Xx.findField(e.associations.fields,h),P,P);break;case"structure":k="(".concat(h,"='").concat(n,"' AND ").concat(b," = 3)"),null!==t&&(k+=" AND ".concat(g," = ")+t.toString()),B.codefield=I,k="( "+k+" )",C=new d.QP(d.Xx.findField(e.associations.fields,v),P,O);break;case"attached":k="(".concat(v,"='").concat(n,"' AND ").concat(b," = 3)"),null!==t&&(k+=" AND ".concat(E," = ")+t.toString()),B.codefield=D,k="( "+k+" )",C=new d.QP(d.Xx.findField(e.associations.fields,h),P,O);break;default:throw new Error("Invalid Parameter")}return a&&(k="1 <> 1"),new d.Xx({parentfeatureset:e.associations,adaptedFields:[new d.$X(d.Xx.findField(e.associations.fields,A)),new d.$X(d.Xx.findField(e.associations.fields,x)),C,L,B,T],extraFilter:k?w.WhereClause.create(k,e.associations.getFieldsIndex()):null})}))}))},e.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),e.functions.groupby=function(n,t){return e.standardFunctionAsync(n,t,(function(t,a,l){return(0,f.p)(l,3,3),(0,f.o)(l[0])?l[0].load().then((function(t){var a=[],o=[],s=!1,u=[];if((0,f.f)(l[1]))u.push(l[1]);else if(l[1]instanceof i.Z)u.push(l[1]);else if((0,f.a)(l[1]))u=l[1];else{if(!(0,f.b)(l[1]))return e.failDefferred("Illegal Value: GroupBy");u=l[1].toArray()}var c,d=(0,r.Z)(u);try{for(d.s();!(c=d.n()).done;){var y=c.value;if((0,f.f)(y)){var p=w.WhereClause.create((0,f.d)(y),t.getFieldsIndex()),m=!0===(0,E.y5)(p)?(0,f.d)(y):"%%%%FIELDNAME";a.push({name:m,expression:p}),"%%%%FIELDNAME"===m&&(s=!0)}else{if(!(y instanceof i.Z))return e.failDefferred("Illegal Value: GroupBy");var h=y.hasField("name")?y.field("name"):"%%%%FIELDNAME",v=y.hasField("expression")?y.field("expression"):"";if("%%%%FIELDNAME"===h&&(s=!0),!h)return e.failDefferred("Illegal Value: GroupBy");a.push({name:h,expression:w.WhereClause.create(v||h,t.getFieldsIndex())})}}}catch($){d.e($)}finally{d.f()}if(u=[],(0,f.f)(l[2]))u.push(l[2]);else if((0,f.a)(l[2]))u=l[2];else if((0,f.b)(l[2]))u=l[2].toArray();else{if(!(l[2]instanceof i.Z))return e.failDefferred("Illegal Value: GroupBy");u.push(l[2])}var g,F=(0,r.Z)(u);try{for(F.s();!(g=F.n()).done;){var I=g.value;if(!(I instanceof i.Z))return e.failDefferred("Illegal Value: GroupBy");var b=I.hasField("name")?I.field("name"):"",N=I.hasField("statistic")?I.field("statistic"):"",x=I.hasField("expression")?I.field("expression"):"";if(!b||!N||!x)return e.failDefferred("Illegal Value: GroupBy");o.push({name:b,statistic:N.toLowerCase(),expression:w.WhereClause.create(x,t.getFieldsIndex())})}}catch($){F.e($)}finally{F.f()}if(s){var S,Z={},C=(0,r.Z)(t.fields);try{for(C.s();!(S=C.n()).done;){var T=S.value;Z[T.name.toLowerCase()]=1}}catch($){C.e($)}finally{C.f()}var L,P=(0,r.Z)(a);try{for(P.s();!(L=P.n()).done;){var O=L.value;"%%%%FIELDNAME"!==O.name&&(Z[O.name.toLowerCase()]=1)}}catch($){P.e($)}finally{P.f()}var R,W=(0,r.Z)(o);try{for(W.s();!(R=W.n()).done;){var B=R.value;"%%%%FIELDNAME"!==B.name&&(Z[B.name.toLowerCase()]=1)}}catch($){W.e($)}finally{W.f()}var k,M=0,G=(0,r.Z)(a);try{for(G.s();!(k=G.n()).done;){var j=k.value;if("%%%%FIELDNAME"===j.name){for(;1===Z["field_"+M.toString()];)M++;Z["field_"+M.toString()]=1,j.name="FIELD_"+M.toString()}}}catch($){G.e($)}finally{G.f()}}for(var V=[],H=0,_=a;H<_.length;H++){var X=_[H];V.push(A(X.expression,e,n))}for(var z=0,J=o;z<J.length;z++){var U=J[z];V.push(A(U.expression,e,n))}return V.length>0?(0,D.$6)(V).then((function(){return(0,D.DB)(l[0].groupby(a,o))})):(0,D.DB)(l[0].groupby(a,o))})):e.failDefferred("Illegal Value: GroupBy")}))},e.signatures.push({name:"groupby",min:"3",max:"3"}),e.functions.distinct=function(n,t){return e.standardFunctionAsync(n,t,(function(t,a,l){return(0,f.o)(l[0])?((0,f.p)(l,2,2),l[0].load().then((function(t){var a=[],o=[];if((0,f.f)(l[1]))o.push(l[1]);else if(l[1]instanceof i.Z)o.push(l[1]);else if((0,f.a)(l[1]))o=l[1];else{if(!(0,f.b)(l[1]))return e.failDefferred("Illegal Value: GroupBy");o=l[1].toArray()}var s,u=!1,c=(0,r.Z)(o);try{for(c.s();!(s=c.n()).done;){var d=s.value;if((0,f.f)(d)){var y=w.WhereClause.create((0,f.d)(d),t.getFieldsIndex()),p=!0===(0,E.y5)(y)?(0,f.d)(d):"%%%%FIELDNAME";a.push({name:p,expression:y}),"%%%%FIELDNAME"===p&&(u=!0)}else{if(!(d instanceof i.Z))return e.failDefferred("Illegal Value: GroupBy");var m=d.hasField("name")?d.field("name"):"%%%%FIELDNAME",h=d.hasField("expression")?d.field("expression"):"";if("%%%%FIELDNAME"===m&&(u=!0),!m)return e.failDefferred("Illegal Value: GroupBy");a.push({name:m,expression:w.WhereClause.create(h||m,t.getFieldsIndex())})}}}catch(W){c.e(W)}finally{c.f()}if(u){var v,g={},F=(0,r.Z)(t.fields);try{for(F.s();!(v=F.n()).done;){var I=v.value;g[I.name.toLowerCase()]=1}}catch(W){F.e(W)}finally{F.f()}var b,N=(0,r.Z)(a);try{for(N.s();!(b=N.n()).done;){var x=b.value;"%%%%FIELDNAME"!==x.name&&(g[x.name.toLowerCase()]=1)}}catch(W){N.e(W)}finally{N.f()}var S,Z=0,C=(0,r.Z)(a);try{for(C.s();!(S=C.n()).done;){var T=S.value;if("%%%%FIELDNAME"===T.name){for(;1===g["field_"+Z.toString()];)Z++;g["field_"+Z.toString()]=1,T.name="FIELD_"+Z.toString()}}}catch(W){C.e(W)}finally{C.f()}}for(var L=[],P=0,O=a;P<O.length;P++){var R=O[P];L.push(A(R.expression,e,n))}return L.length>0?(0,D.$6)(L).then((function(){return(0,D.DB)(l[0].groupby(a,[]))})):(0,D.DB)(l[0].groupby(a,[]))}))):x("distinct",t,a,l)}))})}}}]);