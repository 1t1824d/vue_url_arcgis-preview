"use strict";(self["webpackChunkvue_url_arcgis"]=self["webpackChunkvue_url_arcgis"]||[]).push([[2415],{62415:function(e,t,r){r.d(t,{Z:function(){return te}});var n=r(4367),i=r(62032),a=r(16198),s=r(92751),u=r(76133),o=(r(78975),r(41539),r(70189),r(78783),r(33948),r(91038),r(83753),r(54747),r(38862),r(57327),r(21249),r(74916),r(23123),r(25585)),c=r(40199),l=r(27092),h=r(81529),f=r(19509),d=r(40502),p=r(49938),m=r(75012),y=r(64316),v=r(61859),x=r(71563),g=r(1936),_=(r(68309),r(73210),r(92222),r(46019)),w=r(77263),b=function(){function e(t,r){(0,u.Z)(this,e),this._cache=new _.Z(t),this._invalidCache=new _.Z(r)}return(0,s.Z)(e,[{key:"get",value:function(e,t){var r="".concat(t.uid,":").concat(e),n=this._cache.get(r);if(n)return n;if(void 0!==this._invalidCache.get(r))return null;try{var i=w.WhereClause.create(e,t);return this._cache.put(r,i),i}catch(a){return this._invalidCache.put(r,null),null}}}]),e}(),k=new b(50,500),R="feature-store:unsupported-query",F=" as ",S=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function I(e,t){if(!t)return!0;var r=k.get(t,e);if(!r)throw new o.Z(R,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new o.Z(R,"where clause is not standard",{where:t});return Q(e,r.fieldNames,"where clause contains missing fields"),!0}function Z(e,t,r){if(!t)return!0;var n=k.get(t,e);if(!n)throw new o.Z(R,"invalid SQL expression",{having:t});if(!n.isAggregate)throw new o.Z(R,"having does not contain a valid aggregate function",{having:t});var i=n.fieldNames;if(Q(e,i,"having contains missing fields"),!n.getExpressions().every((function(t){var n=t.aggregateType,i=t.field,a=e.has(i)&&e.get(i).name;return r.some((function(t){var r=t.onStatisticField,i=t.statisticType;return(e.has(r)&&e.get(r).name)===a&&i.toLowerCase().trim()===n}))})))throw new o.Z(R,"expressions in having should also exist in outStatistics",{having:t});return!0}function T(e,t){return e?k.get(e,t):null}function Q(e,t,r){var n,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=[],u=(0,i.Z)(t);try{for(u.s();!(n=u.n()).done;){var c=n.value;if("*"!==c&&!e.has(c))if(a){var l=A(c);try{var h=T(l,e);if(!h)throw new o.Z(R,"invalid SQL expression",{where:l});if(!h.isStandardized)throw new o.Z(R,"expression is not standard",{clause:h});Q(e,h.fieldNames,"expression contains missing fields")}catch(d){var f=d&&d.details;if(f&&(f.clause||f.where))throw d;f&&f.missingFields?s.push.apply(s,(0,g.Z)(f.missingFields)):s.push(c)}}else s.push(c)}}catch(p){u.e(p)}finally{u.f()}if(s.length)throw new o.Z(R,r,{missingFields:s})}function A(e){return e.split(F)[0]}function z(e){return e.split(F)[1]}function C(e,t){var r=t.get(e);return!!r&&!S.has(r.type)}var V=r(76400),E=r(24305),P=(r(51532),r(69600),r(2707),r(21703),r(26699),r(32023),r(47042),r(9653),r(58798)),D=r(32503),M=(r(35192),r(33033)),G=function(){function e(t,r,n){(0,u.Z)(this,e),this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues,this.fieldsIndex=n,this.featureAdapter=r;var a=t.outFields;if(a&&-1===a.indexOf("*")){this.outFields=a;var s,o=0,c=(0,i.Z)(a);try{for(c.s();!(s=c.n()).done;){var l=s.value,h=A(l),f=this.fieldsIndex.get(h),d=f?null:T(h,n),p=f?f.name:z(l)||"FIELD_EXP_"+o++;this._fieldDataCache.set(l,{alias:p,clause:d})}}catch(m){c.e(m)}finally{c.f()}}}return(0,s.Z)(e,[{key:"countDistinctValues",value:function(e){var t=this;return this.returnDistinctValues?(e.forEach((function(e){return t.getAttributes(e)})),this._returnDistinctMap.size):e.length}},{key:"getAttributes",value:function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}},{key:"getFieldValue",value:function(e,t,r){var n=r?r.name:t,i=null;return this._fieldDataCache.has(n)?i=this._fieldDataCache.get(n).clause:r||(i=T(t,this.fieldsIndex),this._fieldDataCache.set(n,{alias:n,clause:i})),r?this.featureAdapter.getAttribute(e,n):i.calculateValue(e,this.featureAdapter)}},{key:"getNormalizedValue",value:function(e,t){var r=t.normalizationType,n=t.normalizationTotal,i=this.getFieldValue(e,t.field,t.fieldInfo);if(r&&Number.isFinite(i)){var a=this.getFieldValue(e,t.normalizationField,t.normalizationFieldInfo);i=(0,M.fk)(i,r,a,n)}return i}},{key:"getExpressionValue",value:function(e,t,r){var n={attributes:this.featureAdapter.getAttributes(e)},i=r.createExecContext(n,t.viewInfo);return r.executeFunction(t.compiledFunc,i)}},{key:"validateItem",value:function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:T(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)}},{key:"validateItems",value:function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:T(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)}},{key:"_processAttributesForOutFields",value:function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);var r,n={},a=(0,i.Z)(t);try{for(a.s();!(r=a.n()).done;){var s=r.value,u=this._fieldDataCache.get(s),o=u.alias,c=u.clause;n[o]=c?c.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,o)}}catch(l){a.e(l)}finally{a.f()}return n}},{key:"_processAttributesForDistinctValues",value:function(e){if((0,l.Wi)(e)||!this.returnDistinctValues)return e;var t=this.outFields,r=[];if(t){var n,a=(0,i.Z)(t);try{for(a.s();!(n=a.n()).done;){var s=n.value,u=this._fieldDataCache.get(s),o=u.alias;r.push(e[o])}}catch(d){a.e(d)}finally{a.f()}}else for(var c in e)r.push(e[c]);var h="".concat((t||["*"]).join(","),"=").concat(r.join(",")),f=this._returnDistinctMap.get(h)||0;return this._returnDistinctMap.set(h,++f),f>1?null:e}}]),e}(),O=r(70805),q=r(63608),N=r(63390),j=r(74887),B=function(){function e(t,r,n){(0,u.Z)(this,e),this.items=t,this.queryGeometry=r,this.definitionExpression=n.definitionExpression,this.geometryType=n.geometryType,this.hasM=n.hasM,this.hasZ=n.hasZ,this.objectIdField=n.objectIdField,this.spatialReference=n.spatialReference,this.fieldsIndex=n.fieldsIndex,this.timeInfo=n.timeInfo,this.featureAdapter=n.featureAdapter,this.aggregateAdapter=n.aggregateAdapter}return(0,s.Z)(e,[{key:"size",get:function(){return this.items.length}},{key:"createQueryResponseForCount",value:function(e){var t=new G(e,this.featureAdapter,this.fieldsIndex);if(!e.outStatistics)return t.countDistinctValues(this.items);var r=e.groupByFieldsForStatistics,n=e.having;if(!(null==r?void 0:r.length))return 1;var a,s=new Map,u=new Map,o=new Set,c=e.outStatistics,l=(0,i.Z)(c);try{for(l.s();!(a=l.n()).done;){var h=a.value,f=h.statisticType,d="exceedslimit"!==f?h.onStatisticField:void 0;if(!u.has(d)){var p,m=[],y=(0,i.Z)(r);try{for(y.s();!(p=y.n()).done;){var v=p.value,x=this._getAttributeValues(t,v,s);m.push(x)}}catch(F){y.e(F)}finally{y.f()}u.set(d,this._calculateUniqueValues(m,t.returnDistinctValues))}var g=u.get(d);for(var _ in g){var w=g[_],b=w.data,k=w.items,R=b.join(",");n&&!t.validateItems(k,n)||o.add(R)}}}catch(F){l.e(F)}finally{l.f()}return o.size}},{key:"createQueryResponse",value:function(e){var t;return t=e.outStatistics?e.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&((0,x.JY)(e.outSR)&&!(0,x.fS)(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=(0,q.S2)((0,n.Z)({spatialReference:e.outSR},(0,V.iV)(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=(0,q.S2)((0,n.Z)({spatialReference:e.outSR},this.queryGeometry))),t}},{key:"createSnappingResponse",value:function(e,t){var r,n=this.featureAdapter,a=U(this.hasZ,this.hasM),s=e.point,u=s.x,o=s.y,c="number"==typeof e.distance?e.distance:e.distance.x,h="number"==typeof e.distance?e.distance:e.distance.y,f={candidates:[]},d="esriGeometryPolygon"===this.geometryType,p=this.getPointCreator(e.point,this.spatialReference,t),m=(0,i.Z)(this.items);try{for(m.s();!(r=m.n()).done;){var y=r.value,v=n.getGeometry(y);if(!(0,l.Wi)(v)){var x=v.coords,g=v.lengths;if(1&e.types)for(var _=0,w=0;w<g.length;w++)for(var b=g[w],k=0;k<b;k++,_+=a){var R=x[_],F=x[_+1];if(k!==b-1){var S=x[_+a],I=x[_+a+1],Z=L(u,o,R,F,S,I),T=Z.x,Q=Z.y,A=(u-T)/c,z=(o-Q)/h,C=A*A+z*z;C<=1&&f.candidates.push({type:"edge",objectId:n.getObjectId(y),distance:Math.sqrt(C),target:p(T,Q),start:p(R,F),end:p(S,I)})}}if(2&e.types)for(var V=d?x.length-a:x.length,E=0;E<V;E+=a){var P=x[E],D=x[E+1],M=(u-P)/c,G=(o-D)/h,O=M*M+G*G;O<=1&&f.candidates.push({type:"vertex",objectId:n.getObjectId(y),distance:Math.sqrt(O),target:p(P,D)})}}}}catch(q){m.e(q)}finally{m.f()}return f.candidates.sort((function(e,t){return e.distance-t.distance})),f}},{key:"getPointCreator",value:function(e,t,r){var n=(0,l.pC)(r)&&!(0,x.fS)(t,r)?function(e){return(0,V.iV)(e,t,r)}:function(e){return e};return null!=e.z&&null!=e.m?function(t,r){return n({x:t,y:r,z:e.z,m:e.m})}:null!=e.z?function(t,r){return n({x:t,y:r,z:e.z})}:null!=e.m?function(t,r){return n({x:t,y:r,m:e.m})}:function(e,t){return n({x:e,y:t})}}},{key:"executeAttributesQuery",value:function(t){var r=T(t.where,this.fieldsIndex);if(!r)return Promise.resolve(this);if(r.isStandardized){var n,a=0,s=[],u=(0,i.Z)(this.items);try{for(u.s();!(n=u.n()).done;){var o=n.value;r.testFeature(o,this.featureAdapter)&&(s[a++]=o)}}catch(l){u.e(l)}finally{u.f()}var c=new e(s,this.queryGeometry,this);return c.definitionExpression=t.where,Promise.resolve(c)}return Promise.reject(new TypeError("Where clause is not standardized"))}},{key:"executeAggregateIdsQuery",value:function(t){if(!t.aggregateIds||!t.aggregateIds.length||(0,l.Wi)(this.aggregateAdapter))return Promise.resolve(this);var r,n=new Set,a=(0,i.Z)(t.aggregateIds);try{for(a.s();!(r=a.n()).done;){var s=r.value;this.aggregateAdapter.getFeatureObjectIds(s).forEach((function(e){return n.add(e)}))}}catch(o){a.e(o)}finally{a.f()}var u=this.featureAdapter.getObjectId;return Promise.resolve(new e(this.items.filter((function(e){return n.has(u(e))})),this.queryGeometry,this))}},{key:"executeObjectIdsQuery",value:function(t){if(!t.objectIds||!t.objectIds.length)return Promise.resolve(this);var r=new Set(t.objectIds),n=this.featureAdapter.getObjectId;return Promise.resolve(new e(this.items.filter((function(e){return r.has(n(e))})),this.queryGeometry,this))}},{key:"executeTimeQuery",value:function(t){var r=(0,O.y)(this.timeInfo,t.timeExtent,this.featureAdapter);if(!(0,l.pC)(r))return Promise.resolve(this);var n=this.items.filter(r);return Promise.resolve(new e(n,this.queryGeometry,this))}},{key:"filterLatest",value:function(){var t,r=this.timeInfo,n=r.trackIdField,a=r.startTimeField,s=r.endTimeField,u=s||a,o=new Map,c=this.featureAdapter.getAttribute,l=(0,i.Z)(this.items);try{for(l.s();!(t=l.n()).done;){var h=t.value,f=c(h,n),d=c(h,u),p=o.get(f);(!p||d>c(p,u))&&o.set(f,h)}}catch(y){l.e(y)}finally{l.f()}var m=Array.from(o.values());return Promise.resolve(new e(m,this.queryGeometry,this))}},{key:"project",value:function(){var t=(0,a.Z)(regeneratorRuntime.mark((function t(r){var n,i,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r&&!(0,x.fS)(this.spatialReference,r)){t.next=2;break}return t.abrupt("return",this);case 2:return n=this.featureAdapter,t.next=5,(0,V.oj)(this.items.map((function(e){return(0,q.Op)(a.geometryType,a.hasZ,a.hasM,n.getGeometry(e))})),this.spatialReference,r);case 5:return i=t.sent.map((function(e,t){return n.cloneWithGeometry(a.items[t],(0,D.GH)(e,a.hasZ,a.hasM))})),t.abrupt("return",new e(i,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:r,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter}));case 7:case"end":return t.stop()}}),t,this)})));function r(e){return t.apply(this,arguments)}return r}()},{key:"createSummaryStatisticsResponse",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r){var n,i,a,s,u,o,c,l,h,f,d,p,m,y;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r.field,i=r.valueExpression,a=r.normalizationField,s=r.normalizationType,u=r.normalizationTotal,o=r.minValue,c=r.maxValue,l=r.scale,h=this.fieldsIndex.isDateField(n),e.next=11,this._getDataValues(t,{field:n,valueExpression:i,normalizationField:a,normalizationType:s,normalizationTotal:u,scale:l});case 11:return f=e.sent,d=(0,M.S5)({normalizationType:s,normalizationField:a,minValue:o,maxValue:c}),p=this.fieldsIndex.get(n),m={value:.5,fieldType:null==p?void 0:p.type},y=(0,N.qN)(p)?(0,M.H0)({values:f,supportsNullCount:d,percentileParams:m}):(0,M.i5)({values:f,minValue:o,maxValue:c,useSampleStdDev:!s,supportsNullCount:d,percentileParams:m}),e.abrupt("return",(0,M.F_)(y,h));case 17:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"createUniqueValuesResponse",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r){var n,i,a,s,u,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r.field,i=r.valueExpression,a=r.domain,s=r.returnAllCodedValues,u=r.scale,e.next=7,this._getDataValues(t,{field:n,valueExpression:i,scale:u});case 7:return o=e.sent,c=(0,M.eT)(o),e.abrupt("return",(0,M.Qm)(c,a,s));case 10:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"createClassBreaksResponse",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r){var n,i,a,s,u,o,c,l,h,f,d,p,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r.field,i=r.valueExpression,a=r.normalizationField,s=r.normalizationType,u=r.normalizationTotal,o=r.classificationMethod,c=r.standardDeviationInterval,l=r.minValue,h=r.maxValue,f=r.numClasses,d=r.scale,e.next=13,this._getDataValues(t,{field:n,valueExpression:i,normalizationField:a,normalizationType:s,normalizationTotal:u,scale:d});case 13:return p=e.sent,m=(0,M.G2)(p,{field:n,normalizationField:a,normalizationType:s,normalizationTotal:u,classificationMethod:o,standardDeviationInterval:c,minValue:l,maxValue:h,numClasses:f}),e.abrupt("return",(0,M.DL)(m,o));case 16:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"createHistogramResponse",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r){var n,i,a,s,u,o,c,l,h,f,d,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r.field,i=r.valueExpression,a=r.normalizationField,s=r.normalizationType,u=r.normalizationTotal,o=r.classificationMethod,c=r.standardDeviationInterval,l=r.minValue,h=r.maxValue,f=r.numBins,d=r.scale,e.next=13,this._getDataValues(t,{field:n,valueExpression:i,normalizationField:a,normalizationType:s,normalizationTotal:u,scale:d});case 13:return p=e.sent,e.abrupt("return",(0,M.oF)(p,{field:n,normalizationField:a,normalizationType:s,normalizationTotal:u,classificationMethod:o,standardDeviationInterval:c,minValue:l,maxValue:h,numBins:f}));case 15:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_sortFeatures",value:function(e,t,r){var n=this;if(e.length>1&&t&&t.length){var a,s=(0,i.Z)(t.reverse());try{var u=function(){var t=a.value,i=t.split(" "),s=i[0],u=n.fieldsIndex.get(s),o=i[1]&&"desc"===i[1].toLowerCase(),c=(0,M.Lq)(null==u?void 0:u.type,o);e.sort((function(e,t){var n=r(e,s,u),i=r(t,s,u);return c(n,i)}))};for(s.s();!(a=s.n()).done;)u()}catch(o){s.e(o)}finally{s.f()}}}},{key:"_createFeatureQueryResponse",value:function(e){var t=this,r=this.items,n=this.geometryType,i=this.hasM,a=this.hasZ,s=this.objectIdField,u=this.spatialReference,o=e.outFields,c=e.outSR,l=e.quantizationParameters,h=e.resultRecordCount,f=e.resultOffset,d=e.returnZ,p=e.returnM,m=null!=h&&r.length>(f||0)+h,y=o&&(o.includes("*")?(0,g.Z)(this.fieldsIndex.fields):o.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:m,features:this._createFeatures(e,r),fields:y,geometryType:n,hasM:i&&p,hasZ:a&&d,objectIdFieldName:s,spatialReference:(0,q.S2)(c||u),transform:l&&(0,P.vY)(l)||null}}},{key:"_createFeatures",value:function(e,t){var r=new G(e,this.featureAdapter,this.fieldsIndex),n=this.hasM,a=this.hasZ,s=e.orderByFields,u=e.quantizationParameters,o=e.returnGeometry,c=e.returnCentroid,l=e.maxAllowableOffset,h=e.resultOffset,f=e.resultRecordCount,d=e.returnZ,p=void 0!==d&&d,m=e.returnM,y=void 0!==m&&m,v=a&&p,x=n&&y,_=[],w=0,b=(0,g.Z)(t);if(this._sortFeatures(b,s,(function(e,t,n){return r.getFieldValue(e,t,n)})),o||c){var k=(0,P.vY)(u);if(o&&!c){var R,F=(0,i.Z)(b);try{for(F.s();!(R=F.n()).done;){var S=R.value;_[w++]={attributes:r.getAttributes(S),geometry:(0,q.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(S),l,k,v,x)}}}catch(N){F.e(N)}finally{F.f()}}else if(!o&&c){var I,Z=(0,i.Z)(b);try{for(Z.s();!(I=Z.n()).done;){var T=I.value;_[w++]={attributes:r.getAttributes(T),centroid:(0,q.EG)(this,this.featureAdapter.getCentroid(T,this),k)}}}catch(N){Z.e(N)}finally{Z.f()}}else{var Q,A=(0,i.Z)(b);try{for(A.s();!(Q=A.n()).done;){var z=Q.value;_[w++]={attributes:r.getAttributes(z),centroid:(0,q.EG)(this,this.featureAdapter.getCentroid(z,this),k),geometry:(0,q.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(z),l,k,v,x)}}}catch(N){A.e(N)}finally{A.f()}}}else{var C,V=(0,i.Z)(b);try{for(V.s();!(C=V.n()).done;){var E=C.value,D=r.getAttributes(E);D&&(_[w++]={attributes:D})}}catch(N){V.e(N)}finally{V.f()}}var M=h||0;if(null!=f){var O=M+f;_=_.slice(M,Math.min(_.length,O))}return _}},{key:"_createExceedsLimitQueryResponse",value:function(e){var t,r=!1,n=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,u=(0,i.Z)(e.outStatistics);try{for(u.s();!(t=u.n()).done;){var o=t.value;if("exceedslimit"===o.statisticType){n=null!=o.maxPointCount?o.maxPointCount:Number.POSITIVE_INFINITY,a=null!=o.maxRecordCount?o.maxRecordCount:Number.POSITIVE_INFINITY,s=null!=o.maxVertexCount?o.maxVertexCount:Number.POSITIVE_INFINITY;break}}}catch(f){u.e(f)}finally{u.f()}if("esriGeometryPoint"===this.geometryType)r=this.items.length>n;else if(this.items.length>a)r=!0;else{var c=this.hasZ?this.hasM?4:3:this.hasM?3:2,h=this.featureAdapter;r=this.items.reduce((function(e,t){var r=h.getGeometry(t);return e+((0,l.pC)(r)&&r.coords.length||0)}),0)/c>s}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(r)}}]}}},{key:"_createStatisticsQueryResponse",value:function(e){var t,r=this,n={attributes:{}},a=[],s=new Map,u=new Map,o=new Map,c=new Map,l=new G(e,this.featureAdapter,this.fieldsIndex),h=e.outStatistics,f=e.groupByFieldsForStatistics,d=e.having,p=e.orderByFields,m=f&&f.length,y=!!m,v=y&&f[0],x=y&&!this.fieldsIndex.get(v),g=(0,i.Z)(h);try{for(g.s();!(t=g.n()).done;){var _=t.value,w=_.outStatisticFieldName,b=_.statisticType,k=_,R="exceedslimit"!==b?_.onStatisticField:void 0,F="percentile_disc"===b||"percentile_cont"===b,S=y&&1===m&&(R===v||x)&&"count"===b;if(y){if(!o.has(R)){var I,Z=[],T=(0,i.Z)(f);try{for(T.s();!(I=T.n()).done;){var Q=I.value,A=this._getAttributeValues(l,Q,s);Z.push(A)}}catch(D){T.e(D)}finally{T.f()}o.set(R,this._calculateUniqueValues(Z,l.returnDistinctValues))}var z=o.get(R),C=function(e){var t=z[e],n=t.count,i=t.data,a=t.items,u=t.itemPositions,o=i.join(",");if(!d||l.validateItems(a,d)){var h=c.get(o)||{attributes:{}},p=null;if(S)p=n;else{var m=r._getAttributeValues(l,R,s),y=u.map((function(e){return m[e]}));p=F&&"statisticParameters"in k?r._getPercentileValue(k,y):r._getStatisticValue(k,y,null,l.returnDistinctValues)}h.attributes[w]=p,f.forEach((function(e,t){return h.attributes[r.fieldsIndex.get(e)?e:"EXPR_".concat(t+1)]=i[t]})),c.set(o,h)}};for(var V in z)C(V)}else{var E=this._getAttributeValues(l,R,s);n.attributes[w]=F&&"statisticParameters"in k?this._getPercentileValue(k,E):this._getStatisticValue(k,E,u,l.returnDistinctValues)}a.push({name:w,alias:w,type:"esriFieldTypeDouble"})}}catch(D){g.e(D)}finally{g.f()}var P=y?Array.from(c.values()):[n];return this._sortFeatures(P,p,(function(e,t){return e.attributes[t]})),{fields:a,features:P}}},{key:"_getStatisticValue",value:function(e,t,r,n){var i=e.onStatisticField,a=e.statisticType,s=null;return s=null!=r&&r.has(i)?r.get(i):(0,N.qN)(this.fieldsIndex.get(i))?(0,M.H0)({values:t,returnDistinct:n}):(0,M.i5)({values:t,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(i,s),s["var"===a?"variance":a]}},{key:"_getPercentileValue",value:function(e,t){var r=e.onStatisticField,n=e.statisticParameters,i=e.statisticType,a=n.value,s=n.orderBy,u=this.fieldsIndex.get(r),o={value:a,orderBy:s,fieldType:null==u?void 0:u.type,isDiscrete:"percentile_disc"===i};return(0,M.XL)(t,o)}},{key:"_getAttributeValues",value:function(e,t,r){if(r.has(t))return r.get(t);var n=this.fieldsIndex.get(t),i=this.items.map((function(r){return e.getFieldValue(r,t,n)}));return r.set(t,i),i}},{key:"_getAttributeNormalizedValues",value:function(e,t){var r=this;return this.items.map((function(n){return e.getNormalizedValue(n,{field:t.field,fieldInfo:r.fieldsIndex.get(t.field),normalizationField:t.normalizationField,normalizationFieldInfo:r.fieldsIndex.get(t.normalizationField),normalizationType:t.normalizationType,normalizationTotal:t.normalizationTotal})}))}},{key:"_getAttributeExpressionValues",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r,n){var i,a,s,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,j.LC)();case 2:return i=e.sent,a=i.arcadeUtils,s=a.createFunction(r),u=n&&a.getViewInfo(n),e.abrupt("return",this.items.map((function(e){return t.getExpressionValue(e,{compiledFunc:s,viewInfo:u},a)})));case 7:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"_calculateUniqueValues",value:function(e,t){for(var r={},n=this.items,a=n.length,s=0;s<a;s++){var u,o=n[s],c=[],l=(0,i.Z)(e);try{for(l.s();!(u=l.n()).done;){var h=u.value;c.push(h[s])}}catch(d){l.e(d)}finally{l.f()}var f=c.join(",");t?null==r[f]&&(r[f]={count:1,data:c,items:[o],itemPositions:[s]}):null==r[f]?r[f]={count:1,data:c,items:[o],itemPositions:[s]}:(r[f].count++,r[f].items.push(o),r[f].itemPositions.push(s))}return r}},{key:"_getDataValues",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r){var n,i,a,s,u,o,c,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=new G(t,this.featureAdapter,this.fieldsIndex),i=r.valueExpression,a=r.field,s=r.normalizationField,u=r.normalizationType,o=r.normalizationTotal,c=r.scale,l=i?{viewingMode:"map",scale:c,spatialReference:t.outSR||this.spatialReference}:null,e.abrupt("return",i?this._getAttributeExpressionValues(n,i,l):this._getAttributeNormalizedValues(n,{field:a,normalizationField:s,normalizationType:u,normalizationTotal:o}));case 2:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()}]),e}();function L(e,t,r,n,i,a){var s=i-r,u=a-n,o=s*s+u*u,c=(e-r)*s+(t-n)*u,l=Math.min(1,Math.max(0,c/o));return{x:r+s*l,y:n+u*l}}function U(e,t){return e?t?4:3:t?3:2}var W=r(57446),H=r(83683),Y=r(12314);function J(e){return e.every((function(e){return"exceedslimit"!==e.statisticType}))}var X="feature-store:unsupported-query",$=new Set,K=new h.WJ(2e6),ee=0,te=function(){function e(t){var r=this;(0,u.Z)(this,e),this.capabilities={query:E.g},this.geometryType=t.geometryType,this.hasM=t.hasM,this.hasZ=t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(function(){return r.clearCache()})),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new h.Xq(ee+++"$$",K)),this.fieldsIndex=new H.Z(t.fields),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}return(0,s.Z)(e,[{key:"destroy",value:function(){this._frameTask=(0,l.hw)(this._frameTask),this.clearCache(),(0,l.SC)(this._geometryQueryCache),this._changeHandle=(0,l.hw)(this._changeHandle),(0,l.SC)(this.fieldsIndex)}},{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:(0,q.S2)(this.spatialReference)}:null}},{key:"timeExtent",get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=(0,O.R)(this.timeInfo,this.featureStore)),this._timeExtent):null}},{key:"clearCache",value:function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null}},{key:"executeQuery",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r,n,i,a=this,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},r=s.length>1?s[1]:void 0,i=(0,c.d9)(t),e.prev=3,e.next=6,this._schedule((function(){return(0,q.Up)(i,a.definitionExpression,a.spatialReference)}),r);case 6:return i=e.sent,e.next=9,this._reschedule((function(){return a._checkQuerySupport(i)}),r);case 9:return i=e.sent,e.next=12,this._reschedule((function(){return a._executeGeometryQuery(i,r)}),r);case 12:return n=e.sent,e.next=15,this._reschedule((function(){return n.executeAggregateIdsQuery(i)}),r);case 15:return n=e.sent,e.next=18,this._reschedule((function(){return n.executeObjectIdsQuery(i)}),r);case 18:return n=e.sent,e.next=21,this._reschedule((function(){return n.executeTimeQuery(i)}),r);case 21:return n=e.sent,e.next=24,this._reschedule((function(){return n.executeAttributesQuery(i)}),r);case 24:n=e.sent,e.next=32;break;case 27:if(e.prev=27,e.t0=e["catch"](3),e.t0===q.vF){e.next=31;break}throw e.t0;case 31:n=new B([],null,this);case 32:return e.abrupt("return",n.createQueryResponse(i));case 33:case"end":return e.stop()}}),e,this,[[3,27]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"executeQueryForCount",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r,n,i,a=this,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},r=s.length>1?s[1]:void 0,n=(0,c.d9)(t),n.returnGeometry=!1,n.returnCentroid=!1,n.outSR=null,e.prev=4,e.next=7,this._schedule((function(){return(0,q.Up)(n,a.definitionExpression,a.spatialReference)}),r);case 7:return n=e.sent,e.next=10,this._reschedule((function(){return a._checkQuerySupport(n)}),r);case 10:return n=e.sent,e.next=13,this._reschedule((function(){return a._executeGeometryQuery(n,r)}),r);case 13:return i=e.sent,e.next=16,this._reschedule((function(){return i.executeAggregateIdsQuery(n)}),r);case 16:return i=e.sent,e.next=19,this._reschedule((function(){return i.executeObjectIdsQuery(n)}),r);case 19:return i=e.sent,e.next=22,this._reschedule((function(){return i.executeTimeQuery(n)}),r);case 22:return i=e.sent,e.next=25,this._reschedule((function(){return i.executeAttributesQuery(n)}),r);case 25:return i=e.sent,e.abrupt("return",i.createQueryResponseForCount(n));case 29:if(e.prev=29,e.t0=e["catch"](4),e.t0===q.vF){e.next=33;break}throw e.t0;case 33:return e.abrupt("return",0);case 34:case"end":return e.stop()}}),e,this,[[4,29]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"executeQueryForExtent",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r,n,i,a,s,u,o,l,h,p,m=this,y=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=y.length>0&&void 0!==y[0]?y[0]:{},r=y.length>1?y[1]:void 0,i=(0,c.d9)(t),a=i.outSR,e.prev=4,e.next=7,this._schedule((function(){return(0,q.Up)(i,m.definitionExpression,m.spatialReference)}),r);case 7:return i=e.sent,e.next=10,this._reschedule((function(){return m._checkQuerySupport(i)}),r);case 10:return i=e.sent,i.returnGeometry=!0,i.returnCentroid=!1,i.outSR=null,e.next=16,this._reschedule((function(){return m._executeGeometryQuery(i,r)}),r);case 16:return n=e.sent,e.next=19,this._reschedule((function(){return n.executeAggregateIdsQuery(i)}),r);case 19:return n=e.sent,e.next=22,this._reschedule((function(){return n.executeObjectIdsQuery(i)}),r);case 22:return n=e.sent,e.next=25,this._reschedule((function(){return n.executeTimeQuery(i)}),r);case 25:return n=e.sent,e.next=28,this._reschedule((function(){return n.executeAttributesQuery(i)}),r);case 28:if(n=e.sent,s=n.size,s){e.next=32;break}return e.abrupt("return",{count:s,extent:null});case 32:return(0,d.t8)(ne,d.Gv),this.featureStore.forEachBounds(n.items,(function(e){return(0,d.TC)(ne,e)}),re),u={xmin:ne[0],ymin:ne[1],xmax:ne[3],ymax:ne[4],spatialReference:(0,q.S2)(this.spatialReference)},this.hasZ&&isFinite(ne[2])&&isFinite(ne[5])&&(u.zmin=ne[2],u.zmax=ne[5]),o=(0,V.iV)(u,n.spatialReference,a),o.spatialReference=(0,q.S2)(a||this.spatialReference),o.xmax-o.xmin==0&&(l=(0,f.c9)(o.spatialReference),o.xmin-=l,o.xmax+=l),o.ymax-o.ymin==0&&(h=(0,f.c9)(o.spatialReference),o.ymin-=h,o.ymax+=h),this.hasZ&&null!=o.zmin&&null!=o.zmax&&o.zmax-o.zmin==0&&(p=(0,f.c9)(o.spatialReference),o.zmin-=p,o.zmax+=p),e.abrupt("return",{count:s,extent:o});case 42:if(e.prev=42,e.t0=e["catch"](4),e.t0!==q.vF){e.next=46;break}return e.abrupt("return",{count:0,extent:null});case 46:throw e.t0;case 47:case"end":return e.stop()}}),e,this,[[4,42]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"executeQueryForIds",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r,n=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1?n[1]:void 0,e.abrupt("return",this.executeQueryForIdSet(t,r).then((function(e){return Array.from(e)})));case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"executeQueryForIdSet",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r,n,a,s,u,o=this,l=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:{},r=l.length>1?l[1]:void 0,a=(0,c.d9)(t),a.returnGeometry=!1,a.returnCentroid=!1,a.outSR=null,e.prev=4,e.next=7,this._schedule((function(){return(0,q.Up)(a,o.definitionExpression,o.spatialReference)}),r);case 7:return a=e.sent,e.next=10,this._reschedule((function(){return o._checkQuerySupport(a)}),r);case 10:return a=e.sent,e.next=13,this._reschedule((function(){return o._executeGeometryQuery(a,r)}),r);case 13:return n=e.sent,e.next=16,this._reschedule((function(){return n.executeAggregateIdsQuery(a)}),r);case 16:return n=e.sent,e.next=19,this._reschedule((function(){return n.executeObjectIdsQuery(a)}),r);case 19:return n=e.sent,e.next=22,this._reschedule((function(){return n.executeTimeQuery(a)}),r);case 22:return n=e.sent,e.next=25,this._reschedule((function(){return n.executeAttributesQuery(a)}),r);case 25:return n=e.sent,s=n.items,u=new Set,e.next=29,this._reschedule((function(){var e,t=(0,i.Z)(s);try{for(t.s();!(e=t.n()).done;){var r=e.value;u.add(n.featureAdapter.getObjectId(r))}}catch(a){t.e(a)}finally{t.f()}}),r);case 29:return e.abrupt("return",u);case 32:if(e.prev=32,e.t0=e["catch"](4),e.t0!==q.vF){e.next=36;break}return e.abrupt("return",new Set);case 36:throw e.t0;case 37:case"end":return e.stop()}}),e,this,[[4,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"executeQueryForSnapping",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r){var i,a,s,u,o,c,h,f,d,p,m,g,_,w,b,k=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=t.point,a=t.distance,s=t.types,0!==s){e.next=3;break}return e.abrupt("return",{candidates:[]});case 3:return e.next=5,this._reschedule((function(){return k._checkQuerySupport(t.query)}),r);case 5:if(u=e.sent,o=!(0,x.fS)(i.spatialReference,this.spatialReference),e.t0=o,!e.t0){e.next=11;break}return e.next=11,(0,V._W)(i.spatialReference,this.spatialReference);case 11:if(c="number"==typeof a?a:a.x,h="number"==typeof a?a:a.y,f={xmin:i.x-c,xmax:i.x+c,ymin:i.y-h,ymax:i.y+h,spatialReference:i.spatialReference},d=o?(0,V.iV)(f,this.spatialReference):f,d){e.next=14;break}return e.abrupt("return",{candidates:[]});case 14:return e.next=16,(0,v.aX)((0,y.im)(i),null,{signal:r});case 16:return p=e.sent[0],e.next=19,(0,v.aX)((0,y.im)(d),null,{signal:r});case 19:if(m=e.sent[0],!(0,l.Wi)(p)&&!(0,l.Wi)(m)){e.next=22;break}return e.abrupt("return",{candidates:[]});case 22:return g=new B(this._searchFeatures(this._getQueryBBoxes(m.toJSON())),null,this),e.next=25,this._reschedule((function(){return g.executeObjectIdsQuery(u)}),r);case 25:return g=e.sent,e.next=28,this._reschedule((function(){return g.executeTimeQuery(u)}),r);case 28:return g=e.sent,e.next=31,this._reschedule((function(){return g.executeAttributesQuery(u)}),r);case 31:return g=e.sent,_=p.toJSON(),w=o?(0,V.iV)(_,this.spatialReference):_,b=o?Math.max(d.xmax-d.xmin,d.ymax-d.ymin)/2:a,e.abrupt("return",g.createSnappingResponse((0,n.Z)((0,n.Z)({},t),{},{point:w,distance:b}),i.spatialReference));case 34:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"executeQueryForLatestObservations",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r,n,i,a=this,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},r=s.length>1?s[1]:void 0,this.timeInfo&&this.timeInfo.trackIdField){e.next=4;break}throw new o.Z(X,"Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:this.timeInfo});case 4:return i=(0,c.d9)(t),e.prev=5,e.next=8,this._schedule((function(){return(0,q.Up)(i,a.definitionExpression,a.spatialReference)}),r);case 8:return i=e.sent,e.next=11,this._reschedule((function(){return a._checkQuerySupport(i)}),r);case 11:return i=e.sent,e.next=14,this._reschedule((function(){return a._executeGeometryQuery(i,r)}),r);case 14:return n=e.sent,e.next=17,this._reschedule((function(){return n.executeAggregateIdsQuery(i)}),r);case 17:return n=e.sent,e.next=20,this._reschedule((function(){return n.executeObjectIdsQuery(i)}),r);case 20:return n=e.sent,e.next=23,this._reschedule((function(){return n.executeTimeQuery(i)}),r);case 23:return n=e.sent,e.next=26,this._reschedule((function(){return n.executeAttributesQuery(i)}),r);case 26:return n=e.sent,e.next=29,this._reschedule((function(){return n.filterLatest()}),r);case 29:n=e.sent,e.next=37;break;case 32:if(e.prev=32,e.t0=e["catch"](5),e.t0===q.vF){e.next=36;break}throw e.t0;case 36:n=new B([],null,this);case 37:return e.abrupt("return",n.createQueryResponse(i));case 38:case"end":return e.stop()}}),e,this,[[5,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"executeQueryForSummaryStatistics",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r,n,i,a,s,u=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1?u[1]:void 0,n=u.length>2?u[2]:void 0,i=r.field,a=r.normalizationField,s=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:a,valueExpression:s},n);case 6:return e.abrupt("return",e.sent.createSummaryStatisticsResponse(t,r));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"executeQueryForUniqueValues",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r,n,i,a,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},r=s.length>1?s[1]:void 0,n=s.length>2?s[2]:void 0,i=r.field,a=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,valueExpression:a},n);case 6:return e.abrupt("return",e.sent.createUniqueValuesResponse(t,r));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"executeQueryForClassBreaks",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r,n,i,a,s,u=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1?u[1]:void 0,n=u.length>2?u[2]:void 0,i=r.field,a=r.normalizationField,s=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:a,valueExpression:s},n);case 6:return e.abrupt("return",e.sent.createClassBreaksResponse(t,r));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"executeQueryForHistogram",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r,n,i,a,s,u=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1?u[1]:void 0,n=u.length>2?u[2]:void 0,i=r.field,a=r.normalizationField,s=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:a,valueExpression:s},n);case 6:return e.abrupt("return",e.sent.createHistogramResponse(t,r));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_schedule",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.pC)(this._frameTask)?this._frameTask.schedule(t,r):t(Y.G5));case 1:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_reschedule",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.pC)(this._frameTask)?this._frameTask.reschedule(t,r):t(Y.G5));case 1:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_getAll",value:function(){if(!this._allItems){var e=[];this.featureStore.forEach((function(t){return e.push(t)})),this._allItems=new B(e,null,this)}return this._allItems}},{key:"_executeGeometryQuery",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r){var n,s,u,o,c,h,f,d,p,m,y,v,g,_,w,b,k,R,F,S,I,Z,T,Q=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.geometry,s=t.outSR,u=t.spatialRel,o=t.returnGeometry,c=t.returnCentroid,h=o||c,f=(0,x.JY)(s)&&!(0,x.fS)(this.spatialReference,s),d=this._geometryQueryCache?f&&h?JSON.stringify({geometry:n,spatialRelationship:u,outSpatialReference:s}):JSON.stringify({geometry:n,spatialRelationship:u}):null,!d){e.next=5;break}if(p=this._geometryQueryCache.get(d),(0,l.o8)(p)){e.next=5;break}return e.abrupt("return",p);case 5:if(m=function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!f||!h){e.next=5;break}return e.next=3,t.project(s);case 3:return r=e.sent,e.abrupt("return",(d&&Q._geometryQueryCache.put(d,r,r.size||1),r));case 5:return e.abrupt("return",(d&&Q._geometryQueryCache.put(d,t,t.size||1),t));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n){e.next=8;break}return e.abrupt("return",m(this._getAll()));case 8:if(y=this.featureAdapter,"esriSpatialRelDisjoint"!==u){e.next=22;break}if(v=this._searchFeatures(this._getQueryBBoxes(n)),v.length){e.next=13;break}return e.abrupt("return",m(this._getAll()));case 13:w=new Set,b=(0,i.Z)(v);try{for(b.s();!(k=b.n()).done;)R=k.value,w.add(y.getObjectId(R))}catch(A){b.e(A)}finally{b.f()}return e.next=18,this._reschedule((function(){var e=0;g=new Array(w.size),Q.featureStore.forEach((function(t){return g[e++]=t})),_=w}),r);case 18:return e.next=20,this._reschedule((0,a.Z)(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,W.cW)(u,n,Q.geometryType,Q.hasZ,Q.hasM);case 2:return t=e.sent,i=function(e){return!_.has(y.getObjectId(e))||t(y.getGeometry(e))},e.t0=B,e.next=7,Q._runSpatialFilter(g,i,r);case 7:return e.t1=e.sent,e.t2=n,e.t3=Q,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3));case 11:case"end":return e.stop()}}),e)}))),r);case 20:return F=e.sent,e.abrupt("return",m(F));case 22:if(S=this._searchFeatures(this._getQueryBBoxes(n)),S.length){e.next=26;break}return I=new B([],n,this),e.abrupt("return",(d&&this._geometryQueryCache.put(d,I,I.size||1),I));case 26:if(!this._canExecuteSoloPass(n,t)){e.next=28;break}return e.abrupt("return",m(new B(S,n,this)));case 28:return e.next=30,(0,W.cW)(u,n,this.geometryType,this.hasZ,this.hasM);case 30:return Z=e.sent,e.next=33,this._runSpatialFilter(S,(function(e){return Z(y.getGeometry(e))}),r);case 33:return T=e.sent,e.abrupt("return",m(new B(T,n,this)));case 35:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_runSpatialFilter",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r,n){var i,s,u,o=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t);case 2:if(!(0,l.Wi)(this._frameTask)){e.next=4;break}return e.abrupt("return",t.filter((function(e){return r(e)})));case 4:return i=0,s=new Array,u=function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(a){var c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(i<t.length)){e.next=9;break}if(c=t[i++],r(c)&&(s.push(c),a.madeProgress()),e.t0=a.done,!e.t0){e.next=7;break}return e.next=7,o._reschedule((function(e){return u(e)}),n);case 7:e.next=0;break;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",this._reschedule((function(e){return u(e)}),n).then((function(){return s})));case 7:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"_canExecuteSoloPass",value:function(e,t){var r=this.geometryType,n=t.spatialRel;return(0,W.hN)(e)&&("esriSpatialRelEnvelopeIntersects"===n||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===n||"esriSpatialRelContains"===n||"esriSpatialRelWithin"===n))}},{key:"_getQueryBBoxes",value:function(e){if((0,W.hN)(e)){if((0,y.YX)(e))return[(0,p.al)(e.xmin,e.ymin,e.xmax,e.ymax)];if((0,y.oU)(e))return e.rings.map((function(e){return(0,p.al)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[(0,m.$P)((0,p.Ue)(),e)]}},{key:"_searchFeatures",value:function(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.featureStore.forEachInBounds(n,(function(e){$.add(e)}))}}catch(u){r.e(u)}finally{r.f()}var a=new Array($.size),s=0;return $.forEach((function(e){return a[s++]=e})),$.clear(),a}},{key:"_checkStatisticsSupport",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text||t.outStatistics||t.groupByFieldsForStatistics||t.having||t.orderByFields)){e.next=2;break}throw new o.Z(X,"Unsupported query options",{query:t});case 2:return e.abrupt("return",Promise.all([this._checkAttributesQuerySupport(t),this._checkStatisticsParamsSupport(r),(0,W.P0)(t,this.geometryType,this.spatialReference),(0,V._W)(this.spatialReference,t.outSR)]).then((function(){return t})));case 3:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_checkStatisticsParamsSupport",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=[],!t.valueExpression){e.next=7;break}return e.next=4,(0,j.LC)();case 4:n=e.sent,i=n.arcadeUtils,r=i.extractFieldNames(t.valueExpression);case 7:if(t.field&&r.push(t.field),t.normalizationField&&r.push(t.normalizationField),r.length){e.next=9;break}throw new o.Z(X,"params should have at least a field or valueExpression",{params:t});case 9:Q(this.fieldsIndex,r,"params contains missing fields");case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_checkQuerySupport",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text)){e.next=2;break}throw new o.Z(X,"Unsupported query options",{query:t});case 2:return e.abrupt("return",Promise.all([this._checkAttributesQuerySupport(t),this._checkStatisticsQuerySupport(t),(0,W.P0)(t,this.geometryType,this.spatialReference),(0,V._W)(this.spatialReference,t.outSR)]).then((function(){return t})));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_checkAttributesQuerySupport",value:function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues,i=e.outStatistics,a=i?i.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})):[];if(r&&r.length>0){var s=" asc",u=" desc",c=r.map((function(e){var t=e.toLowerCase();return t.indexOf(s)>-1?t.split(s)[0]:t.indexOf(u)>-1?t.split(u)[0]:e})).filter((function(e){return-1===a.indexOf(e)}));Q(this.fieldsIndex,c,"orderByFields contains missing fields")}if(t&&t.length>0)Q(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new o.Z(X,"outFields should be specified for returnDistinctValues",{query:e});I(this.fieldsIndex,e.where)}},{key:"_checkStatisticsQuerySupport",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t){var r,n,a,s,u,c,l,h,f,d,p,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=t.outStatistics,n=t.groupByFieldsForStatistics,a=t.having,s=n&&n.length,u=r&&r.length,!a){e.next=5;break}if(s&&u){e.next=4;break}throw new o.Z(X,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:t});case 4:Z(this.fieldsIndex,a,r);case 5:if(!u){e.next=34;break}if(J(r)){e.next=8;break}return e.abrupt("return");case 8:c=r.map((function(e){return e.onStatisticField})),Q(this.fieldsIndex,c,"onStatisticFields contains missing fields"),s&&Q(this.fieldsIndex,n,"groupByFieldsForStatistics contains missing fields"),l=(0,i.Z)(r),e.prev=11,l.s();case 13:if((h=l.n()).done){e.next=26;break}if(f=h.value,d=f.onStatisticField,p=f.statisticType,"percentile_disc"!==p&&"percentile_cont"!==p||!("statisticParameters"in f)){e.next=22;break}if(m=f.statisticParameters,m){e.next=20;break}throw new o.Z(X,"statisticParamters should be set for percentile type",{definition:f,query:t});case 20:e.next=24;break;case 22:if("count"===p||!d||!C(d,this.fieldsIndex)){e.next=24;break}throw new o.Z(X,"outStatistics contains non-numeric fields",{definition:f,query:t});case 24:e.next=13;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e["catch"](11),l.e(e.t0);case 31:return e.prev=31,l.f(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[11,28,31,34]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_getQueryEngineResultForStats",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,r,n,i,a=this,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},r=s.length>1?s[1]:void 0,n=s.length>2?s[2]:void 0,t=(0,c.d9)(t),e.prev=4,e.next=7,this._schedule((function(){return(0,q.Up)(t,a.definitionExpression,a.spatialReference)}),n);case 7:return t=e.sent,e.next=10,this._reschedule((function(){return a._checkStatisticsSupport(t,r)}),n);case 10:return t=e.sent,e.next=13,this._reschedule((function(){return a._executeGeometryQuery(t,n)}),n);case 13:return i=e.sent,e.next=16,this._reschedule((function(){return i.executeAggregateIdsQuery(t)}),n);case 16:return i=e.sent,e.next=19,this._reschedule((function(){return i.executeObjectIdsQuery(t)}),n);case 19:return i=e.sent,e.next=22,this._reschedule((function(){return i.executeTimeQuery(t)}),n);case 22:return i=e.sent,e.next=25,this._reschedule((function(){return i.executeAttributesQuery(t)}),n);case 25:i=e.sent,e.next=33;break;case 28:if(e.prev=28,e.t0=e["catch"](4),e.t0===q.vF){e.next=32;break}throw e.t0;case 32:i=new B([],null,this);case 33:return e.abrupt("return",i);case 34:case"end":return e.stop()}}),e,this,[[4,28]])})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),re=(0,d.Ue)(),ne=(0,d.Ue)()},24305:function(e,t,r){r.d(t,{g:function(){return n}});var n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}}]);