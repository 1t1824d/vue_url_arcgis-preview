"use strict";(self["webpackChunkvue_url_arcgis"]=self["webpackChunkvue_url_arcgis"]||[]).push([[3423],{98586:function(e,t,r){r.d(t,{c:function(){return i},f:function(){return a}});r(41539),r(44197),r(48675),r(92990),r(18927),r(33105),r(35035),r(74345),r(7174),r(32846),r(44731),r(77209),r(96319),r(58867),r(37789),r(33739),r(29368),r(14483),r(12056),r(3462),r(30678),r(27462),r(33824),r(55021),r(12974),r(15016),r(43371);function i(){return new Float32Array(3)}function n(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e,t,r){var i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function s(e,t){return new Float32Array(e,t,3)}function o(){return i()}function u(){return a(1,1,1)}function l(){return a(1,0,0)}function h(){return a(0,1,0)}function d(){return a(0,0,1)}var f=o(),c=u(),v=l(),y=h(),p=d();Object.freeze({__proto__:null,create:i,clone:n,fromValues:a,createView:s,zeros:o,ones:u,unitX:l,unitY:h,unitZ:d,ZEROS:f,ONES:c,UNIT_X:v,UNIT_Y:y,UNIT_Z:p})},97700:function(e,t,r){r.d(t,{Z:function(){return w}});var i=r(62032),n=r(76133),a=r(92751),s=r(50460),o=r(87349),u=r(99418),l=r(49161),h=r(94212),d=(r(41539),r(44197),r(48675),r(92990),r(18927),r(33105),r(35035),r(74345),r(7174),r(32846),r(44731),r(77209),r(96319),r(58867),r(37789),r(33739),r(29368),r(14483),r(12056),r(3462),r(30678),r(27462),r(33824),r(55021),r(12974),r(15016),r(29135),r(68491)),f=r(33482),c=r(38683),v=r(98586),y=r(61859),p=r(12794),m=(r(17115),r(76633)),g=(r(28383),r(29168),r(82595)),_=r(80188),x=r(11047),b=Math.PI/180,k=4,D=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e){var i;return(0,n.Z)(this,r),i=t.call(this),i._dvsMat3=(0,f.c)(),i._localOrigin={x:0,y:0},i._getBounds=e,i}return(0,a.Z)(r,[{key:"destroy",value:function(){this._vao&&(this._vao.dispose(!0),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program&&(this._program.dispose(),this._program=null)}},{key:"doRender",value:function(e){var t=e.context,r=this._getBounds();if(!(r.length<1)){this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(e),this._updateBufferData(t,r),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(1,771),t.setColorMask(!0,!0,!0,!0);var i=this._program;t.bindVAO(this._vao),t.useProgram(i),i.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),t.gl.lineWidth(1),t.drawElements(1,8*r.length,5125,0),t.bindVAO()}}},{key:"_createTransforms",value:function(){return{dvs:(0,f.c)()}}},{key:"_createShaderProgram",value:function(e){if(!this._program){var t="precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }",r="precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }";this._program=new m.$(e,t,r,C().attributes)}}},{key:"_updateMatricesAndLocalOrigin",value:function(e){var t=e.state,r=t.displayMat3,i=t.size,n=t.resolution,a=t.pixelRatio,s=t.rotation,o=t.viewpoint,u=b*s,l=o.targetGeometry,h=l.x,f=l.y,p=(0,y.or)(h,t.spatialReference);this._localOrigin.x=p,this._localOrigin.y=f;var m=a*i[0],g=a*i[1],_=n*m,x=n*g,k=(0,d.b)(this._dvsMat3);(0,d.m)(k,k,r),(0,d.c)(k,k,(0,c.f)(m/2,g/2)),(0,d.d)(k,k,(0,v.f)(i[0]/_,-g/x,1)),(0,d.r)(k,k,-u)}},{key:"_updateBufferData",value:function(e,t){var r,n=this._localOrigin,a=n.x,s=n.y,o=2*k*t.length,u=new Float32Array(o),l=new Uint32Array(8*t.length),h=0,d=0,f=(0,i.Z)(t);try{for(f.s();!(r=f.n()).done;){var c=r.value;c&&(u[2*h+0]=c[0]-a,u[2*h+1]=c[1]-s,u[2*h+2]=c[0]-a,u[2*h+3]=c[3]-s,u[2*h+4]=c[2]-a,u[2*h+5]=c[3]-s,u[2*h+6]=c[2]-a,u[2*h+7]=c[1]-s,l[d+0]=h+0,l[d+1]=h+3,l[d+2]=h+3,l[d+3]=h+2,l[d+4]=h+2,l[d+5]=h+1,l[d+6]=h+1,l[d+7]=h+0,h+=4,d+=8)}}catch(y){f.e(y)}finally{f.f()}if(this._vertexBuffer?this._vertexBuffer.setData(u.buffer):this._vertexBuffer=p.Z.createVertex(e,35048,u.buffer),this._indexBuffer?this._indexBuffer.setData(l):this._indexBuffer=p.Z.createIndex(e,35048,l),!this._vao){var v=C();this._vao=new g.Z(e,v.attributes,v.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}]),r}(_.s),C=function(){return(0,x.cM)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:5126}]})},w=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e){var i;return(0,n.Z)(this,r),i=t.call(this,e),i.hasHighlight=function(){return!0},i}return(0,a.Z)(r,[{key:"destroy",value:function(){(0,s.Z)((0,o.Z)(r.prototype),"destroy",this).call(this),this._boundsRenderer&&(this._boundsRenderer.destroy(),this._boundsRenderer=null)}},{key:"enableRenderingBounds",value:function(e){this._boundsRenderer=new D(e),this.requestRender()}},{key:"hasLabels",get:function(){return!1}},{key:"onTileData",value:function(e,t){e.patch(t),this.contains(e)||this.addChild(e),this.requestRender()}},{key:"onTileError",value:function(e){e.clear(),this.contains(e)||this.addChild(e)}},{key:"_renderChildren",value:function(e,t){var r,n=(0,i.Z)(this.children);try{for(n.s();!(r=n.n()).done;){var a=r.value;a.isReady&&a.hasData&&(a.commit(e),e.context.setStencilFunction(514,a.stencilRef,255),a._displayList.replay(e,a,t))}}catch(s){n.e(s)}finally{n.f()}}}]),r}(h.T)},41815:function(e,t,r){r.d(t,{Z:function(){return bt}});var i=r(2394),n=r(16198),a=r(1936),s=r(62032),o=r(76133),u=r(92751),l=r(43263),h=r(99418),d=r(49161),f=(r(78975),r(51532),r(41539),r(78783),r(33948),r(70189),r(91038),r(21249),r(92222),r(47941),r(57327),r(63825)),c=r(44171),v=r(49081),y=r(48595),p=r(35425),m=r(27092),g=r(24446),_=r(2553),x=(r(57787),r(90202),r(92236)),b=r(7730),k=r(49938),D=r(41177),C=r(64316),w=(r(83753),r(75012)),Z=r(80630),B=r(40294),T=r(71563);function F(e){if(!e)return null;var t=null,r=e.spatialReference,i=(0,T.C5)(r);if(!i)return"toJSON"in e?e.toJSON():e;var n,a=(0,T.sS)(r)?102100:4326,s=B.UZ[a].maxX,o=B.UZ[a].minX,u=B.UZ[a].plus180Line,l=B.UZ[a].minus180Line,h="toJSON"in e?e.toJSON():e;if((0,C.wp)(h))n=M(h,s,o);else if((0,C.aW)(h))h.points=h.points.map((function(e){return M(e,s,o)})),n=h;else if((0,C.YX)(h))n=R(h,i);else if((0,C.oU)(h)||(0,C.l9)(h)){var d=G;(0,w.$P)(d,h);var f={xmin:d[0],ymin:d[1],xmax:d[2],ymax:d[3]},c=(0,B.XZ)(f.xmin,o)*(2*s),v=0===c?h:I(h,c);f.xmin+=c,f.xmax+=c,(0,Z.jQ)(f,u)&&f.xmax!==s||(0,Z.jQ)(f,l)&&f.xmin!==o?t=v:n=v}else n=h;return null!==t?(new O).cut(t,s):n}function I(e,t){var r,i=(0,B.x3)(e),n=(0,s.Z)(i);try{for(n.s();!(r=n.n()).done;){var a,o=r.value,u=(0,s.Z)(o);try{for(u.s();!(a=u.n()).done;){var l=a.value;l[0]+=t}}catch(h){u.e(h)}finally{u.f()}}}catch(h){n.e(h)}finally{n.f()}return e}function R(e,t){if(!t)return e;var r=L(e,t).map((function(e){return e.extent}));return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}function M(e,t,r){if(Array.isArray(e)){var i=e[0];if(i>t){var n=(0,B.XZ)(i,t);e[0]=i+n*(-2*t)}else if(i<r){var a=(0,B.XZ)(i,r);e[0]=i+a*(-2*r)}}else{var s=e.x;if(s>t){var o=(0,B.XZ)(s,t);e.x+=o*(-2*t)}else if(s<r){var u=(0,B.XZ)(s,r);e.x+=u*(-2*r)}}return e}function L(e,t){var r,n=[],a=e.ymin,s=e.ymax,o=e.xmax-e.xmin,u=e.xmin,l=e.xmax,h=(0,i.Z)(t.valid,2),d=h[0],f=h[1];r=S(e.xmin,t);var c=r.x,v=r.frameId;r=S(e.xmax,t);var y=r.x,p=r.frameId,m=c===y&&o>0;if(o>2*f){var g={xmin:u<l?c:y,ymin:a,xmax:f,ymax:s},_={xmin:d,ymin:a,xmax:u<l?y:c,ymax:s},x={xmin:0,ymin:a,xmax:f,ymax:s},b={xmin:d,ymin:a,xmax:0,ymax:s},k=[],D=[];A(g,x)&&k.push(v),A(g,b)&&D.push(v),A(_,x)&&k.push(p),A(_,b)&&D.push(p);for(var C=v+1;C<p;C++)k.push(C),D.push(C);n.push({extent:g,frameIds:[v]},{extent:_,frameIds:[p]},{extent:x,frameIds:k},{extent:b,frameIds:D})}else c>y||m?n.push({extent:{xmin:c,ymin:a,xmax:f,ymax:s},frameIds:[v]},{extent:{xmin:d,ymin:a,xmax:y,ymax:s},frameIds:[p]}):n.push({extent:{xmin:c,ymin:a,xmax:y,ymax:s},frameIds:[v]});return n}function S(e,t){var r,n=(0,i.Z)(t.valid,2),a=n[0],s=n[1],o=2*s,u=0;return e>s?(r=Math.ceil(Math.abs(e-s)/o),e-=r*o,u=r):e<a&&(r=Math.ceil(Math.abs(e-a)/o),e+=r*o,u=-r),{x:e,frameId:u}}function A(e,t){var r=t.xmin,i=t.ymin,n=t.xmax,a=t.ymax;return z(e,r,i)&&z(e,r,a)&&z(e,n,a)&&z(e,n,i)}function z(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}var O=function(){function e(){(0,o.Z)(this,e)}return(0,u.Z)(e,[{key:"cut",value:function(e,t){var r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}for(var i=r.length,n=-2*t,a=0;a<i;a++){var o=r[a];if(o&&o.length>=this.minPts){var u,l=[],h=(0,s.Z)(o);try{for(h.s();!(u=h.n()).done;){var d=u.value;l.push([d[0]+n,d[1]])}}catch(f){h.e(f)}finally{h.f()}r.push(l)}}return this.closed?e.rings=r:e.paths=r,e}}]),e}(),G=(0,k.Ue)(),U=r(76400),V=r(32297),P=r(25036),j=r(92963),K=r(50460),E=r(87349),H=(r(47042),r(40561),-1),q=function(){function e(){(0,o.Z)(this,e),this._dirties=[{vertexFrom:H,vertexCount:H,indexFrom:H,indexCount:H,allDirty:!1},{vertexFrom:H,vertexCount:H,indexFrom:H,indexCount:H,allDirty:!1},{vertexFrom:H,vertexCount:H,indexFrom:H,indexCount:H,allDirty:!1},{vertexFrom:H,vertexCount:H,indexFrom:H,indexCount:H,allDirty:!1},{vertexFrom:H,vertexCount:H,indexFrom:H,indexCount:H,allDirty:!1}]}return(0,u.Z)(e,[{key:"hasDirty",value:function(){return this._dirties.some((function(e){return e.indexCount!==H||e.allDirty}))}},{key:"markAllClean",value:function(){var e,t=(0,s.Z)(this._dirties);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.indexFrom=H,r.indexCount=H,r.vertexFrom=H,r.vertexCount=H,r.allDirty=!1}}catch(i){t.e(i)}finally{t.f()}}},{key:"markAllDirty",value:function(){var e,t=(0,s.Z)(this._dirties);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.allDirty=!0}}catch(i){t.e(i)}finally{t.f()}}},{key:"forEach",value:function(e){for(var t=0;t<this._dirties.length;++t){var r=this._dirties[t],i=r.indexCount,n=r.indexFrom,a=r.vertexCount,s=r.vertexFrom,o=r.allDirty,u={},l=void 0,h=!1;(o||s!==H&&a>0)&&(u.geometry={count:a,from:s,allDirty:o},h=!0),(o||n!==H&&i>0)&&(l={count:i,from:n,allDirty:o},h=!0),h&&e({indices:l,vertices:u},t)}}},{key:"markDirtyIndices",value:function(e,t,r){var i=this._dirties[e],n=t,a=r;if(!i.allDirty)if(i.indexCount!==H){var s=Math.min(i.indexFrom,n),o=Math.max(i.indexFrom+i.indexCount,n+a)-s;i.indexFrom=s,i.indexCount=o}else i.indexFrom=n,i.indexCount=a}},{key:"markDirtyVertices",value:function(e,t,r,i){var n=this._dirties[e],a=r,s=i;if(!n.allDirty)if(n.vertexCount!==H){var o=Math.min(n.vertexFrom,a),u=Math.max(n.vertexFrom+n.vertexCount,a+s)-o;n.vertexFrom=o,n.vertexCount=u}else n.vertexFrom=a,n.vertexCount=s}}]),e}(),W=(r(29135),r(48675),r(92990),r(18927),r(33105),r(35035),r(74345),r(7174),r(32846),r(44731),r(77209),r(96319),r(58867),r(37789),r(33739),r(29368),r(14483),r(12056),r(3462),r(30678),r(27462),r(33824),r(55021),r(12974),r(15016),function(){function e(t){(0,o.Z)(this,e),this._largestRange=null,this._parent=t,this._updateLargestRange()}return(0,u.Z)(e,[{key:"largestRange",get:function(){return this._largestRange}},{key:"rangeCreated",value:function(e){(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}},{key:"rangeResized",value:function(e,t){e===this._largestRange?e.count<t&&this._updateLargestRange():(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}},{key:"findBestRange",value:function(e){for(var t=this._parent._freeHead,r=null;null!==t;)t.count>=e&&(!r||t.count-e<r.count-e)&&(r=t),t=t.next;return r}},{key:"findAdjacentRanges",value:function(e,t){for(var r=!0,i=!1,n=null,a=this._parent._freeHead;r&&!i;){var s=null!==n?n.from+n.count:0,o=null!==a?a.from:this._parent._size;e>=s&&e+t<=o?(r=!1,i=!0):null!==a?(n=a,a=a.next):r=!1}return[n,a]}},{key:"_updateLargestRange",value:function(){for(var e=null,t=this._parent._freeHead;null!==t;)(!e||t.count>e.count)&&(e=t),t=t.next;this._largestRange=e}}]),e}()),N=function(){function e(t,r){(0,o.Z)(this,e),this._allocated=0,this._size=t,this._freeHead=t>0?{from:0,count:t,prev:null,next:null}:null,this._bookKeeper=r||new W(this),this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}return(0,u.Z)(e,[{key:"allocate",value:function(t){var r=this._bookKeeper.findBestRange(t);if(null===r)return-1;var i=r.from,n=r.count;if(r.from+=t,r.count-=t,this._bookKeeper.rangeResized(r,i,n),this._allocated+=t,0===r.count){var a=null!==r.prev?this._freeHead:r.next;e._removeRange(r),this._freeHead=a}return i}},{key:"free",value:function(t,r){var n=this._bookKeeper.findAdjacentRanges(t,r),a=(0,i.Z)(n,2),s=a[0],o=a[1],u={from:t,count:r,prev:s,next:o};if(null!==s&&(s.next=u),null!==o&&(o.prev=u),this._bookKeeper.rangeCreated(u),this._allocated-=r,null!==o&&u.from+u.count===o.from){var l=u.from,h=u.count;e._fuse(u,o),e._removeRange(o),this._bookKeeper.rangeResized(u,l,h),this._bookKeeper.rangeResized(o,void 0,0)}if(null!==s&&s.from+s.count===u.from){var d=s.from,f=s.count;e._fuse(s,u),e._removeRange(u),this._bookKeeper.rangeResized(s,d,f),this._bookKeeper.rangeResized(u,void 0,0)}this._freeHead=null!==u.prev?this._freeHead:u}},{key:"fragmentation",get:function(){var e=this._size-this._allocated;return 0===e?0:1-this._bookKeeper.largestRange.count/e}}],[{key:"_removeRange",value:function(e){null!==e.prev?null!==e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.prev.next=null:null!==e.next&&(e.next.prev=null)}},{key:"_fuse",value:function(e,t){e.count+=t.count,e.next=t.next,t.from+=t.count,t.count=0,null!==t.next&&(t.next.prev=e)}}]),e}(),X=r(11047),Y=["FILL","LINE","MARKER","TEXT","LABEL"];function J(e){for(var t=e.getStrides(),r={},i=0;i<t.length;i++)r[Y[i]]=t[i];return r}var Q=.5,$=function(){function e(t,r,i,n){for(var a in(0,o.Z)(this,e),this._strides=t,this._displayList=r,this._freeListsAndStorage={},this._dirtyMap=null,this._dirtyMap=i,t)for(var s in this._freeListsAndStorage[a]={vtxFreeList:n?new N(n):null,idxFreeList:n?new N(n):null,vertexBuffers:{},indexBuffer:n?new Uint32Array(n):null},t[a])this._freeListsAndStorage[a].vertexBuffers[s]={data:n?(0,X.C$)(n,t[a][s]):null,stride:t[a][s]}}return(0,u.Z)(e,[{key:"delete",value:function(e){var t=Y[e.geometryType];this._freeVertices(t,e.vertexFrom,e.vertexCount),this._freeIndices(t,e.indexFrom,e.indexCount),this._displayList.removeFromList(e),e.vertexFrom=void 0,e.indexFrom=void 0}},{key:"setMeshData",value:function(e,t,r,i,n){var a,s,o=Y[e.geometryType];e.meshData=null,void 0===e.vertexFrom?(s=t.vertexCount,a=this._allocateVertices(o,s)):t.vertexCount>e.vertexCount?(this._freeVertices(o,e.vertexFrom,e.vertexCount),s=t.vertexCount,a=this._allocateVertices(o,s)):t.vertexCount===e.vertexCount?(a=e.vertexFrom,s=e.vertexCount):(this._freeVertices(o,e.vertexFrom+t.vertexCount,e.vertexCount-t.vertexCount),a=e.vertexFrom,s=t.vertexCount);var u,l,h,d=!0;if(void 0===e.indexFrom?(u=n,h=t.indexCount,l=this._allocateIndices(o,h)):t.indexCount>e.indexCount?(u=this._displayList.removeFromList(e),this._freeIndices(o,e.indexFrom,e.indexCount),h=t.indexCount,l=this._allocateIndices(o,h)):t.indexCount===e.indexCount?(d=!1,l=e.indexFrom,h=e.indexCount):(u=this._displayList.removeFromList(e),this._freeIndices(o,e.indexFrom+t.indexCount,e.indexCount-t.indexCount),l=e.indexFrom,h=t.indexCount),-1!==a&&-1!==l){var f=this._storageFor(o);if((0,X.wO)(a,l,f.vertexBuffers,f.indexBuffer,t,r,i),e.vertexFrom=a,e.indexFrom=l,e.vertexCount=t.vertexCount,e.indexCount=t.indexCount,this._dirtyMap)for(var c in this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount),r)this._dirtyMap.markDirtyVertices(e.geometryType,c,e.vertexFrom,e.vertexCount);return d&&this._displayList.addToList(e,u),!0}return-1!==a&&this._freeVertices(o,a,s),-1!==l&&this._freeIndices(o,l,h),e.setMeshDataFromBuffers(t,r,i),e.vertexFrom=void 0,e.vertexCount=0,e.indexFrom=void 0,e.indexCount=0,!1}},{key:"tryAddMeshData",value:function(e,t){var r=t.vertexBuffer,i=t.indexBuffer,n=Y[e.geometryType],a=this._allocateVertices(n,e.vertexCount);if(-1===a)return this._freeVertices(n,a,e.vertexCount),!1;var s=this._allocateIndices(n,e.indexCount);if(-1===s)return this._freeVertices(n,a,e.vertexCount),this._freeIndices(n,s,e.indexCount),!1;var o=this._storageFor(n);if((0,X.wO)(a,s,o.vertexBuffers,o.indexBuffer,e,r,i),e.vertexFrom=a,e.indexFrom=s,this._dirtyMap)for(var u in this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount),r)this._dirtyMap.markDirtyVertices(e.geometryType,u,a,e.vertexCount);return this._displayList.addToList(e),!0}},{key:"_allocateVertices",value:function(e,t){var r=this._storageFor(e),i=r.vtxFreeList.allocate(t);return-1===i||r.vtxFreeList.fragmentation>Q?-1:i}},{key:"_freeVertices",value:function(e,t,r){this._storageFor(e).vtxFreeList.free(t,r)}},{key:"_freeIndices",value:function(e,t,r){this._storageFor(e).idxFreeList.free(t,r)}},{key:"_allocateIndices",value:function(e,t){var r=this._storageFor(e),i=r.idxFreeList.allocate(t);return-1===i||r.idxFreeList.fragmentation>Q?-1:i}},{key:"_storageFor",value:function(e){return this._freeListsAndStorage[e]}},{key:"_stridesFor",value:function(e,t){return this._strides[e][t]}}],[{key:"fromTileData",value:function(t,r){var i,n=J(t),a=[0,0,0,0,0],o=[0,0,0,0,0],u=t.tileDisplayData.displayObjects,l=(0,s.Z)(u);try{for(l.s();!(i=l.n()).done;){var h,d=i.value,f=(0,s.Z)(d.displayRecords);try{for(f.s();!(h=f.n()).done;){var c=h.value;a[c.geometryType]=Math.max(a[c.geometryType],c.vertexFrom+c.vertexCount),o[c.geometryType]=Math.max(o[c.geometryType],c.indexFrom+c.indexCount)}}catch(B){f.e(B)}finally{f.f()}}}catch(B){l.e(B)}finally{l.f()}for(var v=new e(n,t.tileDisplayData.displayList,r,null),y=0;y<t.tileBufferData.geometries.length;++y){var p=a[y],m=o[y],g=t.tileBufferData.geometries[y],_=Y[y],x=v._storageFor(_),b=t.tileBufferData.geometries[y].indexBuffer,k=void 0;for(var D in x.indexBuffer=b,x.idxFreeList=new N(b.length),x.idxFreeList.allocate(m),g.vertexBuffer){var C=t.tileBufferData.geometries[y].vertexBuffer[D];x.vertexBuffers[D].data=C.data,x.vertexBuffers[D].stride=C.stride;var w=(0,X.Y8)(C.stride),Z=C.data.length*w/C.stride;k||(k=Z)}x.vtxFreeList=new N(k),x.vtxFreeList.allocate(p)}return v}}]),e}(),ee=(r(54747),r(12794)),te=(r(17115),r(56770),r(28383),r(15401),r(29168),r(82595)),re=function(){function e(t){(0,o.Z)(this,e),this.geometryMap=(0,X.Mk)((function(){return{indexBuffer:ee.Z.createIndex(t,35044),vao:null}}),(function(e,r){return{vertexBuffer:ee.Z.createVertex(t,X.mR[r])}}))}return(0,u.Z)(e,[{key:"dispose",value:function(){for(var e=0;e<5;e++){var t=this.geometryMap[e];if(t)for(var r in t.data.vao&&t.data.vao.dispose(!1),t.data.indexBuffer&&t.data.indexBuffer.dispose(),t.buffers)t.buffers[r]&&t.buffers[r].data.vertexBuffer.dispose()}}},{key:"get",value:function(e){var t=this.geometryMap[e];return{draw:function(e,r,i,n,a){if(!t.data.vao){var s={};for(var o in t.buffers)s[o]=t.buffers[o].data.vertexBuffer;t.data.vao=new te.Z(e,i,r,s,t.data.indexBuffer)}var u=t.data.vao;e.bindVAO(u),e.drawElements(4,a,5125,Uint32Array.BYTES_PER_ELEMENT*n),e.bindVAO(null)}}}},{key:"has",value:function(e){return null!=this.geometryMap[e]}},{key:"upload",value:function(e,t){var r=this;t.forEach((function(t,i){r._upload(t,i,e)}))}},{key:"_upload",value:function(e,t,r){if(e.indices&&(e.indices.allDirty?this._uploadIndices(r,t):null!=e.indices.from&&null!=e.indices.count&&this._uploadIndices(r,t,e.indices.from,e.indices.count)),e.vertices){var i=e.vertices;for(var n in i){var a=i[n];a.allDirty?this._uploadVertices(r,t,n):null!=a.from&&null!=a.count&&this._uploadVertices(r,t,n,a.from,a.count)}}}},{key:"_uploadVertices",value:function(e,t,r,i,n){var a=this.geometryMap[t];if(a){var s=e.geometries[t].vertexBuffer[r];if(s){var o=s.stride,u=s.data.buffer;a.buffers[r]&&u.byteLength>0&&(null!=i&&null!=n?a.buffers[r].data.vertexBuffer.setSubData(u,i*o,i*o,(i+n)*o):a.buffers[r].data.vertexBuffer.setData(u))}}}},{key:"_uploadIndices",value:function(e,t,r,i){var n=this.geometryMap[t];if(n){var a=4,s=e.geometries[t].indexBuffer.buffer;n.data.indexBuffer&&s.byteLength>0&&(null!=r&&null!=i?n.data.indexBuffer.setSubData(s,r*a,r*a,(r+i)*a):n.data.indexBuffer.setData(s))}}}]),e}(),ie=r(65007),ne=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,o.Z)(this,r),e=t.apply(this,arguments),e._data=null,e._displayList=null,e._lastCommitTime=0,e._hasData=!1,e._invalidated=!1,e._wglBuffers=null,e._dirtyMap=new q,e}return(0,u.Z)(r,[{key:"destroy",value:function(){(0,K.Z)((0,E.Z)(r.prototype),"destroy",this).call(this),this.clear()}},{key:"hasData",get:function(){return!!this._hasData}},{key:"displayObjects",get:function(){var e;return null!=(e=this._displayObjects)?e:[]}},{key:"getGeometry",value:function(e){return this._wglBuffers&&this._wglBuffers.has(e)?this._wglBuffers.get(e):null}},{key:"getDisplayList",value:function(){return this._displayList}},{key:"patch",value:function(e){if(!0===e.clear)return this.clear(),void(this._hasData=!1);var t=e.addOrUpdate,r=e.remove;!this._data&&t&&t.tileDisplayData.displayObjects.length?(t.tileDisplayData.computeDisplayList(),this._dirtyMap=new q,this._dispRecStore=$.fromTileData(t,this._dirtyMap),this._data=t,this._dirtyMap.markAllDirty(),this._hasData=!0,e.end&&this.ready()):this._data&&(t&&t.tileDisplayData.displayObjects.length||r.length)?this._doPatchData(e):e.end&&this.ready(),e.end&&!this._data&&this.clear(),this.requestRender(),this.emit("change")}},{key:"commit",value:function(e){e.time&&e.time===this._lastCommitTime||(this._lastCommitTime=e.time,this.visible&&this._data&&(this._wglBuffers||(this._wglBuffers=new re(e.context)),(this._dirtyMap.hasDirty()||this._invalidated)&&(this._invalidated=!1,this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._displayList=this._data.tileDisplayData.displayList.clone(),this._displayObjects=this._data.tileDisplayData.displayObjects.slice(),this._dirtyMap.markAllClean())))}},{key:"clear",value:function(){this._data=null,this._displayList=null,this._dispRecStore=null,this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)}},{key:"_doPatchData",value:function(e){this._invalidated=!0,this._patchData(e)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=$.fromTileData(this._data,this._dirtyMap)),this.requestRender()}},{key:"_patchData",value:function(e){var t,r=!0,i=e.addOrUpdate&&e.addOrUpdate.tileDisplayData&&e.addOrUpdate.tileDisplayData.displayObjects||[],n=(e.remove||[]).slice(),a=(0,s.Z)(i);try{for(a.s();!(t=a.n()).done;){var o=t.value;null!=o.insertAfter&&n.push(o.id)}}catch(H){a.e(H)}finally{a.f()}var u,l=(0,s.Z)(n);try{for(l.s();!(u=l.n()).done;){var h=u.value,d=this._data.tileDisplayData.displayObjectRegistry.get(h);if(d){this._data.tileDisplayData.displayList.removeFromList(d.displayRecords);var f,c=(0,s.Z)(d.displayRecords);try{for(c.s();!(f=c.n()).done;){var v=f.value;this._dispRecStore.delete(v)}}catch(H){c.e(H)}finally{c.f()}this._data.tileDisplayData.displayObjectRegistry.delete(h);var y=this._data.tileDisplayData.displayObjects.indexOf(d);this._data.tileDisplayData.displayObjects.splice(y,1)}}}catch(H){l.e(H)}finally{l.f()}var p,m=(0,s.Z)(i);try{for(m.s();!(p=m.n()).done;){var g=p.value,_=void 0,x=this._data.tileDisplayData.displayObjectRegistry.get(g.id);if(x){var b=x.displayRecords;x.set(g),x.displayRecords=b;for(var k=x.displayRecords.length,D=0;D<k;++D){var C=x.displayRecords[D],w=g.displayRecords[D];(D>=g.displayRecords.length||C.geometryType!==w.geometryType||C.symbolLevel!==w.symbolLevel||C.zOrder!==w.zOrder||C.materialKey!==w.materialKey)&&(this._dispRecStore.delete(x.displayRecords[D]),D<g.displayRecords.length&&(x.displayRecords[D]=void 0))}x.displayRecords.length=g.displayRecords.length}else{var Z=void 0;x=g.copy(),x.displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(g.id,x);var B=this._data.tileDisplayData.displayObjects;if(null!=x.insertAfter)if(_={},x.insertAfter>=0){var T=this._data.tileDisplayData.displayObjectRegistry.get(x.insertAfter);T?(Z=B.indexOf(T)+1,Z<B.length?B.splice(Z,0,x):(B.push(x),Z=B.length)):(B.push(x),Z=B.length)}else B.unshift(x),Z=0;else B.push(x),Z=B.length;if(_)for(var F=g.displayRecords.length>0?1:0,I=0,R=Z-1;R>=0&&I<F;--R)for(var M=B[R].displayRecords.length-1;M>=0&&I<F;--M){var L=B[R].displayRecords[M],S=this._data.tileDisplayData.displayList.getDPInfoType();_[S]||(_[S]=L,++I)}}for(var A=g.displayRecords.length,z=0;z<A;++z){var O=g.displayRecords[z],G=x.displayRecords[z];G?(G.meshData=O.meshData,G.materialKey=O.materialKey):(G=O.copy(),G.vertexFrom=void 0,G.indexFrom=void 0,x.displayRecords[z]=G);var U=O.geometryType,V=this._data.tileDisplayData.displayList.getDPInfoType(),P=e.addOrUpdate.tileBufferData.geometries[U],j=P.vertexBuffer,K=P.indexBuffer,E=void 0;_&&(E=_[V]?this._data.tileDisplayData.displayList.splitAfter(_[V]):-1),r=this._dispRecStore.setMeshData(G,O,j,K,E)&&r,_&&null!=G.indexFrom&&null!=G.indexFrom&&(_[V]=G)}}}catch(H){m.e(H)}finally{m.f()}return r}}]),r}(ie.o),ae=(r(43290),r(65125),function(){function e(){(0,o.Z)(this,e),this._byGeometryType=null}return(0,u.Z)(e,[{key:"satisfied",get:function(){return!this._byGeometryType}},{key:"reset",value:function(){this._byGeometryType=null}},{key:"verticesFor",value:function(e){return this._byGeometryType?this._byGeometryType[e].vertices:0}},{key:"indicesFor",value:function(e){return this._byGeometryType?this._byGeometryType[e].indices:0}},{key:"needMore",value:function(e,t,r){if(t||r){this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]);var i=this._byGeometryType[e];i.vertices+=t,i.indices+=r}}}]),e}()),se=5,oe=function(){function e(){(0,o.Z)(this,e),this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}return(0,u.Z)(e,[{key:"clone",value:function(){for(var t=new e,r=0;r<this.geometries.length;r++){var i=this.geometries[r],n=t.geometries[r];for(var a in n.indexBuffer=i.indexBuffer.slice(),n.vertexBuffer={},i.vertexBuffer){var s=i.vertexBuffer[a],o=s.data,u=s.stride;n.vertexBuffer[a]={data:o.slice(),stride:u}}}return t}},{key:"serialize",value:function(){for(var e={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},t=0;t<se;++t)for(var r in this.geometries[t].vertexBuffer)e.geometries[t].vertexBuffer[r]={data:this.geometries[t].vertexBuffer[r].data.buffer,stride:this.geometries[t].vertexBuffer[r].stride};return e}},{key:"getBuffers",value:function(){for(var e=[],t=0;t<se;++t)for(var r in e.push(this.geometries[t].indexBuffer.buffer),this.geometries[t].vertexBuffer)e.push(this.geometries[t].vertexBuffer[r].data.buffer);return e}}],[{key:"deserialize",value:function(t){for(var r=new e,i=0;i<se;++i)for(var n in r.geometries[i].indexBuffer=new Uint32Array(t.geometries[i].indexBuffer),r.geometries[i].vertexBuffer={},t.geometries[i].vertexBuffer)r.geometries[i].vertexBuffer[n]={data:(0,X.e2)(t.geometries[i].vertexBuffer[n].data,t.geometries[i].vertexBuffer[n].stride),stride:t.geometries[i].vertexBuffer[n].stride};return r}}]),e}(),ue=r(49026);function le(e,t,r){for(var i=arguments.length,n=new Array(i>3?i-3:0),a=3;a<i;a++)n[a-3]=arguments[a];t<e.length?e.splice.apply(e,[t,r].concat(n)):e.push.apply(e,n)}var he=new Map;he.set(ue.jx.MAP,[ue.LW.FILL,ue.LW.LINE,ue.LW.MARKER,ue.LW.TEXT]),he.set(ue.jx.LABEL,[ue.LW.LABEL]),he.set(ue.jx.LABEL_ALPHA,[ue.LW.LABEL]);var de=function(){function e(){(0,o.Z)(this,e),this.symbolLevels=[]}return(0,u.Z)(e,[{key:"replay",value:function(e,t,r){var i,n=(0,s.Z)(this.symbolLevels);try{for(n.s();!(i=n.n()).done;){var a,o=i.value,u=(0,s.Z)(o.zLevels);try{for(u.s();!(a=u.n()).done;){var l=a.value,h=l.geometryDPInfo.unified;if(h){var d,f=(0,s.Z)(h);try{var c=function(){var i=d.value,n=e.painter.getGeometryBrush(i.geometryType),a=t.getGeometry(i.geometryType),s={geometryType:i.geometryType,materialKey:i.materialKey,indexFrom:i.indexFrom,indexCount:i.indexCount,draw:function(e,t,r){a.draw(e,t,r,i.indexFrom,i.indexCount)}};n.prepareState(e,t),n.drawGeometry(e,t,s,r)};for(f.s();!(d=f.n()).done;)c()}catch(v){f.e(v)}finally{f.f()}}}}catch(v){u.e(v)}finally{u.f()}}}catch(v){n.e(v)}finally{n.f()}}},{key:"empty",get:function(){return!this.symbolLevels||0===this.symbolLevels.length}},{key:"clear",value:function(){this.symbolLevels.length=0}},{key:"addToList",value:function(e,t){if(Array.isArray(e)){var r,i=(0,s.Z)(e);try{for(i.s();!(r=i.n()).done;){var n=r.value;this._addToList(n,t)}}catch(a){i.e(a)}finally{i.f()}}else this._addToList(e,t)}},{key:"removeFromList",value:function(e){Array.isArray(e)||(e=[e]);var t,r=null,i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;r=this._removeFromList(n)}}catch(a){i.e(a)}finally{i.f()}return r}},{key:"clone",value:function(){var t,r=new e,i=(0,s.Z)(this.symbolLevels);try{for(i.s();!(t=i.n()).done;){var n=t.value;r.symbolLevels.push(n.clone())}}catch(a){i.e(a)}finally{i.f()}return r}},{key:"splitAfter",value:function(e){for(var t=this._getDisplayList(e.symbolLevel,e.zOrder),r=t.length,i=e.indexFrom+e.indexCount,n=0;n<r;++n){var a=t[n];if(a.geometryType===e.geometryType&&i>a.indexFrom&&i<=a.indexFrom+a.indexCount){if(i<a.indexFrom+a.indexCount){var s=new fe;s.geometryType=a.geometryType,s.materialKey=a.materialKey,s.indexFrom=i,s.indexCount=a.indexFrom+a.indexCount-i,t.splice(n+1,0,s),a.indexCount=i-a.indexFrom}return n}}}},{key:"_addToList",value:function(e,t){var r=e.symbolLevel,i=e.zOrder,n=this._getDisplayList(r,i),a=null!=t?t:n.length-1,s=a>=0&&a<n.length?n[a]:null;if(null!==s&&s.materialKey===e.materialKey&&s.indexFrom+s.indexCount===e.indexFrom&&s.geometryType===e.geometryType)s.indexCount+=e.indexCount;else{var o=new fe;o.indexFrom=e.indexFrom,o.indexCount=e.indexCount,o.materialKey=e.materialKey,o.geometryType=e.geometryType,le(n,a+1,0,o)}}},{key:"_removeFromList",value:function(e){for(var t,r=e.symbolLevel,i=e.zOrder,n=this._getDisplayList(r,i),a=n.length,s=0;s<a;++s){var o=n[s];if(e.indexFrom+e.indexCount>o.indexFrom&&e.indexFrom<o.indexFrom+o.indexCount&&o.geometryType===e.geometryType){t=s;break}}if(void 0!==t){var u=n[t];if(e.indexFrom===u.indexFrom)return u.indexCount-=e.indexCount,u.indexFrom+=e.indexCount,0===u.indexCount&&le(n,t,1),t-1;if(e.indexFrom+e.indexCount===u.indexFrom+u.indexCount)return u.indexCount-=e.indexCount,0===u.indexCount?(le(n,t,1),t-1):t;var l=u.indexFrom,h=e.indexFrom-u.indexFrom,d=e.indexCount,f=u.indexFrom+u.indexCount-(e.indexFrom+e.indexCount);u.indexCount=h;var c=new fe;return c.geometryType=u.geometryType,c.materialKey=u.materialKey,c.indexFrom=l+h+d,c.indexCount=f,le(n,t+1,0,c),t}return null}},{key:"_getDisplayList",value:function(e,t){for(var r,i,n=this.symbolLevels.length,a=0;a<n;a++)if(this.symbolLevels[a].symbolLevel===e){r=this.symbolLevels[a];break}r||(r=new ye,r.symbolLevel=e,this.symbolLevels.push(r));for(var s=r.zLevels.length,o=0;o<s;o++)if(r.zLevels[o].zLevel===t){i=r.zLevels[o];break}return i||(i=new ve,i.geometryDPInfo=new ce,i.zLevel=t,r.zLevels.push(i)),i.geometryDPInfo.unified||(i.geometryDPInfo.unified=[]),i.geometryDPInfo.unified}},{key:"getDPInfoType",value:function(){return"unified"}}]),e}(),fe=function(){function e(){(0,o.Z)(this,e),this.materialKey=null,this.indexFrom=0,this.indexCount=0}return(0,u.Z)(e,[{key:"clone",value:function(){var t=new e;return t.geometryType=this.geometryType,t.materialKey=this.materialKey,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t}}]),e}(),ce=function(){function e(){(0,o.Z)(this,e),this.fill=null,this.line=null,this.marker=null,this.text=null,this.label=null,this.unified=null}return(0,u.Z)(e,[{key:"clone",value:function(){var t=new e;return t.fill=this.fill&&this.fill.map((function(e){return e.clone()})),t.line=this.line&&this.line.map((function(e){return e.clone()})),t.marker=this.marker&&this.marker.map((function(e){return e.clone()})),t.text=this.text&&this.text.map((function(e){return e.clone()})),t.label=this.label&&this.label.map((function(e){return e.clone()})),t.unified=this.unified&&this.unified.map((function(e){return e.clone()})),t}}]),e}(),ve=function(){function e(){(0,o.Z)(this,e),this.geometryDPInfo=new ce}return(0,u.Z)(e,[{key:"clone",value:function(){var t=new e;return t.zLevel=this.zLevel,t.geometryDPInfo=this.geometryDPInfo.clone(),t}}]),e}(),ye=function(){function e(){(0,o.Z)(this,e),this.zLevels=[]}return(0,u.Z)(e,[{key:"clone",value:function(){var t=new e;t.symbolLevel=this.symbolLevel;var r,i=(0,s.Z)(this.zLevels);try{for(i.s();!(r=i.n()).done;){var n=r.value;t.zLevels.push(n.clone())}}catch(a){i.e(a)}finally{i.f()}return t}}]),e}(),pe=function(){function e(){(0,o.Z)(this,e),this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}return(0,u.Z)(e,[{key:"clear",value:function(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}},{key:"update",value:function(e,t,r){for(var i in e)this.vertexData.set(i,e[i]);for(var n in this.vertexData)null===e[n]&&this.vertexData.delete(n);this.vertexCount=t,this.indexData=r}}]),e}(),me=function(){function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;(0,o.Z)(this,e),this.id=t,this.geometryType=r,this.materialKey=i,this.minZoom=n,this.maxZoom=a,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0}return(0,u.Z)(e,[{key:"sortKey",get:function(){return void 0===this._sortKey&&this._computeSortKey(),this._sortKey}},{key:"clone",value:function(){return this.copy()}},{key:"copy",value:function(){var t=new e(this.id,this.geometryType,this.materialKey);return t.vertexFrom=this.vertexFrom,t.vertexCount=this.vertexCount,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t.zOrder=this.zOrder,t.symbolLevel=this.symbolLevel,t.meshData=this.meshData,t.minZoom=this.minZoom,t.maxZoom=this.maxZoom,t}},{key:"setMeshDataFromBuffers",value:function(e,t,r){var i=new pe;for(var n in t){for(var a=t[n].stride,s=t[n].data,o=[],u=(0,X.Y8)(a),l=0;l<a*e.vertexCount/u;++l)o[l]=s[l+a*e.vertexFrom/u];i.vertexData.set(n,o)}i.indexData.length=0;for(var h=0;h<e.indexCount;++h)i.indexData[h]=r[h+e.indexFrom]-e.vertexFrom;i.vertexCount=e.vertexCount,this.meshData=i}},{key:"readMeshDataFromBuffers",value:function(e,t){for(var r in this.meshData?this.meshData.clear():this.meshData=new pe,e){for(var i=e[r].stride,n=e[r].data,a=[],s=(0,X.Y8)(i),o=0;o<i*this.vertexCount/s;++o)a[o]=n[o+i*this.vertexFrom/s];this.meshData.vertexData.set(r,a)}this.meshData.indexData.length=0;for(var u=0;u<this.indexCount;++u)this.meshData.indexData[u]=t[u+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}},{key:"writeMeshDataToBuffers",value:function(e,t,r,i){for(var n in t)for(var a=t[n].stride,s=this.meshData.vertexData.get(n),o=t[n].data,u=(0,X.Y8)(a),l=0;l<a*this.meshData.vertexCount/u;++l)o[l+a*e/u]=s[l];for(var h=0;h<this.meshData.indexData.length;++h)i[h+r]=this.meshData.indexData[h]+e;this.vertexFrom=e,this.vertexCount=this.meshData.vertexCount,this.indexFrom=r,this.indexCount=this.meshData.indexData.length}},{key:"_computeSortKey",value:function(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}},{key:"serialize",value:function(e){return e.push(this.geometryType),e.push(this.materialKey),e.push(this.vertexFrom),e.push(this.vertexCount),e.push(this.indexFrom),e.push(this.indexCount),e.push(this.minZoom),e.push(this.maxZoom),e}}],[{key:"writeAllMeshDataToBuffers",value:function(e,t,r){var i,n=0,a=0,o=(0,s.Z)(e);try{for(o.s();!(i=o.n()).done;){var u=i.value;u.writeMeshDataToBuffers(n,t,a,r),n+=u.vertexCount,a+=u.indexCount}}catch(l){o.e(l)}finally{o.f()}}},{key:"deserialize",value:function(t,r){var i=t.readInt32(),n=t.readInt32(),a=new e(r.id,i,n);return a.vertexFrom=t.readInt32(),a.vertexCount=t.readInt32(),a.indexFrom=t.readInt32(),a.indexCount=t.readInt32(),a.minZoom=t.readInt32(),a.maxZoom=t.readInt32(),a}}]),e}();function ge(e,t){if(null!==t){e.push(t.length);var r,i=(0,s.Z)(t);try{for(i.s();!(r=i.n()).done;){var n=r.value;n.serialize(e)}}catch(a){i.e(a)}finally{i.f()}return e}e.push(0)}function _e(e,t,r){for(var i=e.readInt32(),n=new Array(i),a=0;a<n.length;a++)n[a]=t.deserialize(e,r);return n}var xe=function(){function e(t){(0,o.Z)(this,e),this.insertAfter=null,this.id=t,this.displayRecords=[]}return(0,u.Z)(e,[{key:"copy",value:function(){var t=new e(this.id);return t.set(this),t}},{key:"clone",value:function(){var t=new e(this.id);return t.displayRecords=this.displayRecords.map((function(e){return e.clone()})),t.insertAfter=this.insertAfter,t}},{key:"set",value:function(e){this.id=e.id,this.displayRecords=e.displayRecords,this.insertAfter=e.insertAfter}},{key:"serialize",value:function(e){return e.push(this.id),ge(e,this.displayRecords),e}}],[{key:"deserialize",value:function(t){var r=t.readInt32(),i=new e(r),n={id:r};return i.displayRecords=_e(t,me,n),i}}]),e}();function be(e){var t,r=[[],[],[],[],[]],i=e,n=(0,s.Z)(i);try{for(n.s();!(t=n.n()).done;){var a,o=t.value,u=(0,s.Z)(o.displayRecords);try{for(u.s();!(a=u.n()).done;){var l=a.value;r[l.geometryType].push(l)}}catch(h){u.e(h)}finally{u.f()}}}catch(h){n.e(h)}finally{n.f()}return r}var ke=function(){function e(){(0,o.Z)(this,e)}return(0,u.Z)(e,[{key:"displayObjectRegistry",get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;var e,t=(0,s.Z)(this.displayObjects);try{for(t.s();!(e=t.n()).done;){var r=e.value;this._displayObjectRegistry.set(r.id,r)}}catch(i){t.e(i)}finally{t.f()}}return this._displayObjectRegistry}},{key:"displayList",get:function(){return this._displayList}},{key:"computeDisplayList",value:function(){this._displayList=new de;var e,t=(0,s.Z)(this.displayObjects);try{for(t.s();!(e=t.n()).done;){var r,i=e.value,n=(0,s.Z)(i.displayRecords);try{for(n.s();!(r=n.n()).done;){var a=r.value;this._displayList.addToList(a)}}catch(o){n.e(o)}finally{n.f()}}}catch(o){t.e(o)}finally{t.f()}}},{key:"clone",value:function(){var t=new e;return this.displayObjects&&(t.displayObjects=this.displayObjects.map((function(e){return e.clone()}))),t}},{key:"serialize",value:function(e){return ge(e,this.displayObjects),e}},{key:"_deserializeObjects",value:function(e){for(var t=e.readInt32(),r=new Array(t),i=new Map,n=0;n<r.length;++n){var a=xe.deserialize(e);r[n]=a,i.set(a.id,a)}this.displayObjects=r,this._displayList=null,this._displayObjectRegistry=i}}],[{key:"deserialize",value:function(t){var r=new e;return r._deserializeObjects(t),r}}]),e}(),De=r(34229),Ce=function(){function e(t,r){(0,o.Z)(this,e),this.data=t,this.stride=r}return(0,u.Z)(e,null,[{key:"decode",value:function(t){var r=(0,X.e2)(t.data,t.stride),i=t.stride;return new e(r,i)}},{key:"fromVertexVector",value:function(t){var r=(0,X.e2)(t.data.buffer(),t.stride),i=t.stride;return new e(r,i)}}]),e}(),we=function(){function e(t,r,i){(0,o.Z)(this,e),this.geometryType=t,this.indexBuffer=new Uint32Array(r),this.namedBuffers=i}return(0,u.Z)(e,null,[{key:"decode",value:function(t){var r=t.geometryType,i=t.indexBuffer,n={};for(var a in t.namedBuffers)n[a]=Ce.decode(t.namedBuffers[a]);return new e(r,i,n)}},{key:"fromVertexData",value:function(t,r){var i=t.indices,n=(0,X.e2)(t.vertices,t.stride),a=t.stride,s={geometry:new Ce(n,a)};return new e(r,i,s)}},{key:"fromVertexVectors",value:function(t){var r=t.geometryType,i=t.indexVector.buffer(),n={};for(var a in t.namedVectors)n[a]=Ce.fromVertexVector(t.namedVectors[a]);return new e(r,i,n)}}]),e}(),Ze=(r(82472),r(73761)),Be=function(){function e(t,r){(0,o.Z)(this,e),this.data=t,this.stride=r}return(0,u.Z)(e,[{key:"vertexCount",get:function(){var e=this.stride/4,t=this.data.length/e;return t}},{key:"transfer",value:function(e,t){var r=this.data.buffer();e.vertexCount=this.vertexCount,e.data=r,e.stride=this.stride,t.push(r)}}]),e}(),Te=function(){function e(t,r,i){(0,o.Z)(this,e),this.geometryType=t,this.indexVector=new Ze.Z(Uint32Array,6*r),this.namedVectors={};var n=(0,X.$_)(t,i);for(var a in n){var s=n[a],u=void 0;switch(s%4){case 0:case 2:u=new Ze.Z(Uint32Array,s*r);break;case 1:case 3:u=new Ze.Z(Uint8Array,s*r)}this.namedVectors[a]=new Be(u,s)}}return(0,u.Z)(e,[{key:"get",value:function(e){return this.namedVectors[e].data}},{key:"getVector",value:function(e){return this.namedVectors[e]}},{key:"transfer",value:function(e,t){var r=this.indexVector.buffer(),i={};for(var n in t.push(r),this.namedVectors){var a=this.namedVectors[n];i[n]={},a.transfer(i[n],t)}e.geometryType=this.geometryType,e.indexBuffer=r,e.namedBuffers=i,this.destroy()}},{key:"intoBuffers",value:function(){var e=we.fromVertexVectors(this);return this.destroy(),e}},{key:"destroy",value:function(){this.indexVector=null,this.namedVectors=null}}]),e}(),Fe=new ae,Ie=new ae,Re=1.5,Me=5;function Le(e,t){var r={};for(var i in e){var n={data:(0,X.C$)(t,e[i]),stride:e[i]};r[i]=n}return r}function Se(e){return[e.fill||{},e.line||{},e.icon||{},e.text||{},e.label||{}]}var Ae=function(){function e(){(0,o.Z)(this,e),this.tileDisplayData=null,this.tileBufferData=null}return(0,u.Z)(e,[{key:"reshuffle",value:function(){Fe.reset();var t,r=be(this.tileDisplayData.displayObjects),i=(0,s.Z)(r);try{for(i.s();!(t=i.n()).done;){var n,a=t.value,o=(0,s.Z)(a);try{for(o.s();!(n=o.n()).done;){var u=n.value;u&&Fe.needMore(u.geometryType,u.meshData?u.meshData.vertexCount:u.vertexCount,u.meshData?u.meshData.indexData.length:u.indexCount)}}catch(L){o.e(L)}finally{o.f()}}}catch(L){i.e(L)}finally{i.f()}for(var l=r.length,h=new oe,d=0;d<l;++d){h.geometries[d].indexBuffer=new Uint32Array(Math.round(Re*Fe.indicesFor(d)));var f=[];for(var c in this.tileBufferData.geometries[d].vertexBuffer)f.push(this.tileBufferData.geometries[d].vertexBuffer[c].stride);var v=e._computeVertexAlignment(f),y=Math.round(Re*Fe.verticesFor(d)),p=e._align(y,v);for(var m in this.tileBufferData.geometries[d].vertexBuffer){var g=this.tileBufferData.geometries[d].vertexBuffer[m].stride;h.geometries[d].vertexBuffer[m]={stride:g,data:(0,X.C$)(p,g)}}}Ie.reset(),this.tileDisplayData.displayList.clear();for(var _=0;_<l;++_){var x,b=r[_],k=(0,s.Z)(b);try{for(k.s();!(x=k.n()).done;){var D=x.value;if(D.meshData)D.writeMeshDataToBuffers(Ie.verticesFor(_),h.geometries[_].vertexBuffer,Ie.indicesFor(_),h.geometries[_].indexBuffer),D.meshData=null;else{var C=this.tileBufferData.geometries[_].vertexBuffer,w=this.tileBufferData.geometries[_].indexBuffer,Z=h.geometries[_].vertexBuffer,B=h.geometries[_].indexBuffer,T=Ie.verticesFor(_),F=Ie.indicesFor(_);(0,X.wO)(T,F,Z,B,D,C,w),D.vertexFrom=T,D.indexFrom=F}Ie.needMore(_,D.vertexCount,D.indexCount)}}catch(L){k.e(L)}finally{k.f()}}var I,R=(0,s.Z)(this.tileDisplayData.displayObjects);try{for(R.s();!(I=R.n()).done;){var M=I.value;this.tileDisplayData.displayList.addToList(M.displayRecords)}}catch(L){R.e(L)}finally{R.f()}this.tileBufferData=h}},{key:"getStrides",value:function(){for(var e=[],t=0;t<this.tileBufferData.geometries.length;++t){var r=this.tileBufferData.geometries[t];for(var i in e[t]={},r.vertexBuffer)e[t][i]=r.vertexBuffer[i].stride}return e}},{key:"clone",value:function(){var t=new e;return t.tileBufferData=this.tileBufferData.clone(),t.tileDisplayData=this.tileDisplayData.clone(),t}},{key:"_guessSize",value:function(){for(var e=this.tileDisplayData.displayObjects,t=Math.min(e.length,4),r=12,i=40,n=0,a=0;a<t;a++)n=Math.max(n,e[a].displayRecords.length);return 2*(e.length*r+e.length*n*i)}},{key:"serialize",value:function(){var e=this.tileBufferData.serialize(),t=this.tileBufferData.getBuffers(),r=this.tileDisplayData.serialize(new Ze.Z(Int32Array,this._guessSize())).buffer();return t.push(r),{result:{displayData:r,bufferData:e},transferList:t}}}],[{key:"fromVertexData",value:function(t,r){var i,n={},a=new Map,o=(0,s.Z)(r);try{for(o.s();!(i=o.n()).done;){var u=i.value;a.set(u.id,u)}}catch(l){o.e(l)}finally{o.f()}return(0,X.Z_)((function(e){var r=t.data[e];if((0,m.pC)(r)){for(var i=De.$.from(r.records).getCursor();i.next();){var s=i.id,o=i.materialKey,u=i.indexFrom,l=i.indexCount,h=i.vertexFrom,d=i.vertexCount,f=a.get(s),c=new me(s,e,o);c.indexFrom=u,c.indexCount=l,c.vertexFrom=h,c.vertexCount=d,f.displayRecords.push(c)}n[e]=we.fromVertexData(r,e)}else n[e]=new Te(e,0,{fill:"default"}).intoBuffers()})),e.fromMeshData({displayObjects:r,vertexBuffersMap:n})}},{key:"fromMeshData",value:function(t){var r=new e,i=new ke,n=new oe;for(var a in i.displayObjects=t.displayObjects,t.vertexBuffersMap){var s=t.vertexBuffersMap[a];n.geometries[a].indexBuffer=s.indexBuffer,n.geometries[a].vertexBuffer=s.namedBuffers}return r.tileDisplayData=i,r.tileBufferData=n,r}},{key:"bind",value:function(t,r){var i=new e;return i.tileDisplayData=t,i.tileBufferData=r,i}},{key:"create",value:function(t,r){var i=new e;i.tileDisplayData=new ke,i.tileDisplayData.displayObjects=t;var n,a=[0,0,0,0,0],o=[0,0,0,0,0],u=[[],[],[],[],[]],l=(0,s.Z)(t);try{for(l.s();!(n=l.n()).done;){var h,d=n.value,f=(0,s.Z)(d.displayRecords);try{for(f.s();!(h=f.n()).done;){var c=h.value;u[c.geometryType].push(c),a[c.geometryType]+=c.meshData.vertexCount,o[c.geometryType]+=c.meshData.indexData.length}}catch(_){f.e(_)}finally{f.f()}}}catch(_){l.e(_)}finally{l.f()}for(var v=new oe,y=Se(r),p=0;p<Me;p++){var m=new Uint32Array(o[p]),g=Le(y[p],a[p]);me.writeAllMeshDataToBuffers(u[p],g,m),v.geometries[p]={indexBuffer:m,vertexBuffer:g}}return i.tileBufferData=v,i}},{key:"_align",value:function(e,t){var r=e%t;return 0===r?e:e+(t-r)}},{key:"_computeVertexAlignment",value:function(e){var t,r=!1,i=!1,n=(0,s.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;a%4==2?r=!0:a%4!=0&&(i=!0)}}catch(o){n.e(o)}finally{n.f()}return i?4:r?2:1}}]),e}(),ze=r(34898),Oe=r(76883),Ge=r(16466),Ue=r(40304),Ve=r(61112),Pe=r(81205),je=r(62200),Ke=r(32503),Ee=r(20477),He=r(30920),qe=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,i){return(0,o.Z)(this,r),t.call(this,e,i,null)}return(0,u.Z)(r,[{key:"geometryType",get:function(){var e=this._current;return e?e.geometryType:null}},{key:"insertAfter",get:function(){return this._current.insertAfter}},{key:"readGraphic",value:function(){return this._current}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var e=new r(this.instance,this._features);return this.copyInto(e),e}}],[{key:"from",value:function(e){var t,i=Ee.s.createInstance(),n=[],a=e.filter((function(e){return!!e.geometry})),o=(0,s.Z)(a);try{for(o.s();!(t=o.n()).done;){var u=t.value,l=(0,C.Ji)(u.geometry);(0,Ke.E7)(n,[u],l,!1,!1,"uid")}}catch(h){o.e(h)}finally{o.f()}return new r(i,n)}}]),r}(He.i),We=r(4367),Ne=(r(74916),r(64765),r(2707),r(597)),Xe=r(90407),Ye=r(61859),Je=r(75158),Qe=r(45560),$e=r(58798),et=r(82409),tt=r(51559),rt=new et.Z,it=new et.Z,nt="esriGeometryPolyline";function at(e){e.coords.length=0,e.lengths.length=0}var st=function(){function e(){(0,o.Z)(this,e),this.bounds=(0,k.Ue)(),this.graphic=null}return(0,u.Z)(e,[{key:"acquire",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;e&&this.set(e,t,r,i,n)}},{key:"release",value:function(){this.graphic=null,this.symbolResource=null,this.geometry=null}},{key:"symbol",get:function(){return this.symbolResource.symbol}},{key:"set",value:function(e,t,r,i,n){this.graphic=e,this.geometry=r,this.symbolResource=t,this.bounds=i,n&&(this.size=n)}},{key:"getGeometryQuantized",value:function(e,t,r,n){var s=this.geometry;if((0,C.oU)(s)){var o=s.rings;if(1===o.length&&2===o[0].length)return(0,$e.ym)(e,{paths:[[o[0][0],o[0][1]]]})}else{if((0,C.l9)(s))return at(rt),at(it),(0,Ke.u0)(rt,s),(0,Ke.zj)(it,rt,s.hasZ,s.hasM,nt,e.scale[0]),(0,Ke.Nh)(rt,it,s.hasZ,s.hasM,nt,e),(0,Ke.J6)(rt,s.hasZ,s.hasM);if((0,C.aW)(s)){var u=.5*n*Math.max(Math.abs(this.size[0])+this.size[2]-this.size[0],Math.abs(this.size[1])+this.size[3]-this.size[1]),l=(0,B.uS)(r),h=(0,i.Z)(l,2),d=h[0],f=h[1],c=f-d,v=s.points.filter((function(e){if(e[0]+u>f||e[0]-u<d){var r=(0,a.Z)(e);return e[0]+u>f?r[0]-=c:r[0]+=c,(0,k.Zm)(t,e,u)||(0,k.Zm)(t,r,u)}return(0,k.Zm)(t,e,u)}));return 0===v.length?{points:v}:(0,$e.ym)(e,{points:v})}}return(0,$e.ym)(e,this.geometry)}}],[{key:"acquire",value:function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return 0===e._pool.length?t=new e:(t=e._pool.pop(),this._set.delete(t)),t.acquire(r,i,n,a,s),t}},{key:"release",value:function(e){e&&!this._set.has(e)&&(e.release(),this._pool.push(e),this._set.add(e))}},{key:"getCentroidQuantized",value:function(e,t){if((0,C.oU)(e.geometry)){var r=e.symbol;if((0,m.Wi)(r))return null;if((0,tt.yA)(r.type)||(0,tt.ab)(r.type)){var i=(0,Qe.tO)(e.geometry);return(0,$e.RF)(t,{},{x:i[0],y:i[1]},!1,!1)}}return null}}]),e}();st._pool=[],st._set=new Set;var ot={minX:0,minY:0,maxX:0,maxY:0},ut=(0,k.Ue)(),lt=1e-5;function ht(e,t,r,i,n){return ot.minX=t,ot.minY=r,ot.maxX=i,ot.maxY=n,e.search(ot)}function dt(e){return{minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}}var ft=function(){function e(t,r,i,n,a,s,u){(0,o.Z)(this,e),this._graphics=n,this._onAdd=a,this._onRemove=s,this._hashToCIM=u,this._index=(0,Xe.r)(9,dt),this._itemByGraphic=new Map,this._inflatedSizeHelper=new V.IV,this._tileInfoView=t,this._uidFieldName=i;var l=t.getClosestInfoForScale(r);l&&(this._resolution=this._tileInfoView.getTileResolution(l.level))}return(0,u.Z)(e,[{key:"setResourceManager",value:function(e){this._cimResourceManager=e,this._hittestDrawHelper=new Je.Tu(e)}},{key:"hitTest",value:function(e,t,r,i,n){e=(0,Ye.or)(e,this._tileInfoView.spatialReference);var a=.5*i*window.devicePixelRatio*r;ut[0]=e-a,ut[1]=t-a,ut[2]=e+a,ut[3]=t+a;var o=.5*i*(r+tt.y1),u=ht(this._index,e-o,t-o,e+o,t+o);if(!u||0===u.length)return[];var l,h=[],d=(0,k.Ue)(),f=(0,k.Ue)(),c=(0,s.Z)(u);try{for(c.s();!(l=c.n()).done;){var v=l.value,y=v.geometry,p=v.symbolResource;this._getSymbolBounds(d,p,y,f,n),f[3]=f[2]=f[1]=f[0]=0,(0,k.kK)(d,ut)&&v.graphic.visible&&h.push(v)}}catch(T){c.e(T)}finally{c.f()}if(0===h.length)return[];for(var m=this._hittestDrawHelper,g=[],_=0,x=h;_<x.length;_++){var b=x[_],D=b.geometry,C=b.symbolResource,w=C.hash,Z=C.textInfo,B=this._hashToCIM.get(w);B&&m.hitTest(ut,B.symbol,D,Z,n,i)&&g.push(b)}return g.sort(ct),g.map((function(e){return e.graphic}))}},{key:"getGraphicsData",value:function(e,t,r){var i=this._searchForItems(t);if(0===i.length||0===r.length)return[];i.sort((function(e,t){return e.zorder-t.zorder})),i[0].insertAfter=-1;for(var n=1;n<i.length;n++)i[n].insertAfter=i[n-1].graphic.uid;i.sort((function(e,t){return e.graphic.uid-t.graphic.uid})),r.sort((function(e,t){return e.uid-t.uid}));var a,o,u=0,l=0,h=t.resolution,d=[],f={originPosition:"upperLeft",scale:[h,h],translate:[t.bounds[0],t.bounds[3]]},c=(0,s.Z)(r);try{for(c.s();!(o=c.n()).done;){var v=o.value;for(l=-2;u<i.length;)if(a=i[u],u++,v.uid===a.graphic.uid){l=a.insertAfter;break}if(a.geometry&&-2!==l){var y=a.getGeometryQuantized(f,t.bounds,this._tileInfoView.spatialReference,h),p=(0,We.Z)({},a.graphic.attributes);p[this._uidFieldName]=v.uid,null==a.groupId&&(a.groupId=e.createTemplateGroup(a.symbol,null)),d.push({centroid:st.getCentroidQuantized(a,f),geometry:y,attributes:p,symbol:a.symbol,groupId:a.groupId,insertAfter:l,zorder:a.zorder})}}}catch(m){c.e(m)}finally{c.f()}return d.sort((function(e,t){return e.zorder-t.zorder})),d}},{key:"queryTileData",value:function(e,t){if(0===this._graphics.length)return[];var r=t.bounds,i=t.resolution,n=this._searchForItems(t),a=[];return 0===n.length||this._createTileGraphics(a,e,n,{originPosition:"upperLeft",scale:[i,i],translate:[r[0],r[3]]},t),a}},{key:"has",value:function(e){return this._itemByGraphic.has(e)}},{key:"getBounds",value:function(e){var t=this._itemByGraphic.get(e);return t?t.bounds:null}},{key:"getAllBounds",value:function(){return Array.from(this._itemByGraphic.values()).filter((function(e){return e.graphic.visible})).map((function(e){return e.bounds}))}},{key:"addOrModify",value:function(e,t,r){if(e&&!(0,m.Wi)(t)){this.has(e)&&this.remove(e),this._onAdd(e);var i=[0,0,0,0],n=this._getSymbolBounds(null,t,r,i,0),a=st.acquire(e,t,r,(0,m.pC)(n)?n:null,i);return this._itemByGraphic.set(e,a),r&&this._index.insert(a),a.bounds}}},{key:"remove",value:function(e){if(this._itemByGraphic.has(e)){this._onRemove(e);var t=this._itemByGraphic.get(e);t.bounds&&this._index.remove(t),this._itemByGraphic.delete(e)}}},{key:"updateZ",value:function(){for(var e,t,r=this._graphics.items,i=0;i<r.length;i++)t=r[i],e=this._itemByGraphic.get(t),e&&(e.zorder=i)}},{key:"update",value:function(e,t,r){var i=this._itemByGraphic.get(e);i.groupId=null;var n=(0,k.d9)(i.bounds);this._index.remove(i);var a=this._getSymbolBounds(i.bounds,t,r,i.size,0);return(0,m.pC)(a)&&i.set(e,t,r,a,i.size),r&&this._index.insert(i),{oldBounds:n,newBounds:i.bounds}}},{key:"updateLevel",value:function(e){if(this._resolution!==e){this._resolution=e,this._index.clear();var t,r=this._itemByGraphic,n=[],a=(0,s.Z)(r);try{for(a.s();!(t=a.n()).done;){var o=(0,i.Z)(t.value,2),u=(o[0],o[1]),l=this._getSymbolBounds(u.bounds,u.symbolResource,u.geometry,u.size,0);u.geometry&&(0,m.pC)(l)&&(u.bounds=l,n.push(u))}}catch(h){a.e(h)}finally{a.f()}this._index.load(n)}}},{key:"clear",value:function(){this._itemByGraphic.clear(),this._index.clear()}},{key:"_createTileGraphics",value:function(e,t,r,i,n){var a,s,o,u,l=this._uidFieldName,h=this._tileInfoView.spatialReference,d=n.bounds,f=n.resolution;r.sort((function(e,t){return e.zorder-t.zorder}));for(var c=0;c<r.length;c++){o=r[c],a=o.graphic,s=o.getGeometryQuantized(i,d,h,f),u=0===c?-1:r[c-1].graphic.uid;var v=(0,We.Z)({},o.graphic.attributes);v[l]=a.uid,null==o.groupId&&(o.groupId=t.createTemplateGroup(o.symbol,null)),e.push({centroid:st.getCentroidQuantized(o,i),geometry:s,attributes:v,symbol:o.symbol,groupId:o.groupId,insertAfter:u,zorder:o.zorder})}}},{key:"_searchForItems",value:function(e){var t=this._tileInfoView.spatialReference,r=e.bounds;if(t.isWrappable){var n=(0,B.uS)(t),s=(0,i.Z)(n,2),o=s[0],u=s[1],l=Math.abs(r[2]-u)<lt,h=Math.abs(r[0]-o)<lt;if((!l||!h)&&(l||h)){var d,f=e.resolution;d=(0,k.Ue)(l?[o,r[1],o+f*tt.y1,r[3]]:[u-f*tt.y1,r[1],u,r[3]]);var c=ht(this._index,r[0],r[1],r[2],r[3]),v=ht(this._index,d[0],d[1],d[2],d[3]);return(0,a.Z)(new Set([].concat((0,a.Z)(c),(0,a.Z)(v))))}}return ht(this._index,r[0],r[1],r[2],r[3])}},{key:"_getSymbolBounds",value:function(e,t,r,i,n){if(!t||!t.symbol||!r)return null;if(e||(e=(0,k.Ue)()),(0,w.$P)(e,r),!i||0===i[0]&&0===i[1]&&0===i[2]&&0===i[3]){var a=t.hash,s=t.textInfo,o=this._hashToCIM.get(a);if(!o)return null;i||(i=[0,0,0,0]);var u=this._inflatedSizeHelper.getSymbolInflateSize(i,o.symbol,this._cimResourceManager,n,s);i[0]=(0,Ne.F2)(u[0]),i[1]=(0,Ne.F2)(u[1]),i[2]=(0,Ne.F2)(u[2]),i[3]=(0,Ne.F2)(u[3])}var l=this._resolution,h=V.IV.SafeSize(i);return e[0]-=h*l,e[1]-=h*l,e[2]+=h*l,e[3]+=h*l,e}}]),e}(),ct=function(e,t){var r=(0,tt.eT)(e.graphic),i=(0,tt.eT)(t.graphic);return r===i?t.zorder-e.zorder:r-i},vt=r(31567),yt=r(7054),pt=function(e){var t=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,o.Z)(this,r),e=t.apply(this,arguments),e.graphics=null,e.renderer=null,e}return(0,u.Z)(r)}((0,yt.I)(e));return(0,f._)([(0,_.Cb)()],t.prototype,"graphics",void 0),(0,f._)([(0,_.Cb)()],t.prototype,"renderer",void 0),(0,f._)([(0,_.Cb)()],t.prototype,"updating",void 0),(0,f._)([(0,_.Cb)()],t.prototype,"view",void 0),t=(0,f._)([(0,x.j)("esri.views.layers.GraphicsView")],t),t},mt=r(11277),gt=(0,p.Z)("esri-2d-graphic-debug");function _t(e,t,r){if(r.has(e))return r.get(e);var i={tile:t,addedOrModified:[],removed:[]};return r.set(e,i),i}var xt=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var i;return(0,o.Z)(this,r),i=t.call(this,e),i._storage=new je.O,i._displayIds=new Map,i._controller=new AbortController,i._tiles=new Map,i._graphicStoreUpdate=!1,i._graphicsSet=new Set,i._matcher=Promise.resolve(null),i._tileUpdateSet=new Set,i._tilesToUpdate=new Map,i._graphicIdToAbortController=new Map,i._attached=!1,i._highlightIds=new Map,i._updatingGraphicsTimer=null,i._hashToExpandedSymbol=new Map,i._hashToExpandedSymbolPromise=new Map,i._hashToCIMSymbolPromise=new Map,i._hashToCIM=new Map,i._processing=!1,i._needsProcessing=!1,i._pendingUpdate={added:new Set,updated:new Set,removed:new Set},i.lastUpdateId=-1,i.updateRequested=!1,i.graphicUpdateHandler=i.graphicUpdateHandler.bind((0,l.Z)(i)),i}return(0,u.Z)(r,[{key:"_createMatcher",value:function(e,t,r){if(e){var i=(0,Ve.createMatcherSchema)({indexCount:0,fields:{}},"feature",e);this._matcher=(0,Ue.fL)(i,t,null,r)}}},{key:"_createDisplayId",value:function(e){return this._displayIds.has(e)||this._displayIds.set(e,this._storage.createDisplayId()),this._displayIds.get(e)}},{key:"initialize",value:function(){var e=this;this._attributeStore=new Pe.Z({type:"local",initialize:function(t){return Promise.resolve(e.container.attributeView.initialize(t))},update:function(t){return e.container.attributeView.requestUpdate(t)},render:function(){return e.container.requestRender()}},(0,mt.Z)()),this.container.hasHighlight=function(){return!!e._highlightIds.size};var t=function(t){e._createDisplayId(t.uid),e._setFilterState(t.uid,t.visible)},r=function(t){var r=e._displayIds.get(t.uid);e._displayIds.delete(t.uid),e._storage.releaseDisplayId(r)},i=new Ge.Wr(this.container.getMaterialItems.bind(this.container),this.view.featuresTilingScheme.tileInfo);this._graphicStore=new ft(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,t,r,this._hashToCIM),this._meshFactory=new Oe.j(null,this.uid,i),this._templateStore=i,this.handles.add([this.watch("renderer",(function(t){e._createMatcher(t,i,e.container.stage.resourceManager);var r,n=(0,s.Z)(e.graphics);try{for(n.s();!(r=n.n()).done;){var a=r.value;e._pendingUpdate.updated.add(a)}}catch(o){n.e(o)}finally{n.f()}e.requestUpdate()})),this.view.graphicsTileStore.on("update",(function(t){return e._onTileUpdate(t)})),this.container.on("attach",(function(){gt&&e.container.enableRenderingBounds((function(){return e._graphicStore.getAllBounds()})),e.graphics.items.length>0&&e._graphicsChangeHandler({target:e.graphics,added:e.graphics.items,removed:[],moved:[]}),e.handles.add(e.graphics.on("change",(function(t){return e._graphicsChangeHandler(t)})),"graphics");var t=e.container.stage.resourceManager;e._createMatcher(e.renderer,i,t),e._graphicStore.setResourceManager(t),e._attached=!0,e.notifyChange("updating")}))]);var n=this.view.graphicsTileStore.tiles;this._onTileUpdate({added:n,removed:[]})}},{key:"destroy",value:function(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange("updating")),this._controller.abort(),this.container.destroy(),this._set("graphics",null),this._graphicStore.clear(),this._attributeStore=null,this._hashToExpandedSymbol.clear(),this.view=null,this.renderer=null,this._hashToCIM.clear(),this._hashToCIMSymbolPromise.clear(),this._hashToExpandedSymbolPromise.clear()}},{key:"updating",get:function(){return!this._attached||null!==this._updatingGraphicsTimer||this._tileUpdateSet.size>0||this._tilesToUpdate.size>0}},{key:"hitTest",value:function(e){if(!this.view||!this.view.position)return null;var t=this.view.state,r=t.resolution,i=t.rotation;return this._graphicStore.hitTest(e.x,e.y,2,r,i)}},{key:"update",value:function(e){(0,g.k_)(this._controller.signal);var t=e.state,r=t.resolution;if(this._graphicStore.updateLevel(r),this._graphicStoreUpdate=!0,this.updateRequested=!1,this._pendingUpdate.updated.size>0){if(!this._processing)return void this._updateGraphics();this._needsProcessing=!0}}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback())}},{key:"processUpdate",value:function(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))}},{key:"graphicUpdateHandler",value:function(e){var t=e.graphic,r=e.property,i=e.newValue;switch(r){case"attributes":break;case"geometry":case"symbol":this._pendingUpdate.updated.add(t),this.requestUpdate();break;case"visible":this._setFilterState(t.uid,i),this._attributeStore.sendUpdates()}}},{key:"addHighlight",value:function(e){var t,r=(0,s.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(this._highlightIds.has(i)){var n=this._highlightIds.get(i);this._highlightIds.set(i,n+1)}else this._highlightIds.set(i,1)}}catch(a){r.e(a)}finally{r.f()}this._updateHighlight()}},{key:"removeHighlight",value:function(e){var t,r=(0,s.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(this._highlightIds.has(i)){var n=this._highlightIds.get(i)-1;0===n?this._highlightIds.delete(i):this._highlightIds.set(i,n)}}}catch(a){r.e(a)}finally{r.f()}this._updateHighlight()}},{key:"_updateHighlight",value:function(){var e=this,t=Array.from(this._highlightIds.keys()),r=t.map((function(t){return e._displayIds.get(t)}));this._attributeStore.setHighlight(t,r)}},{key:"_getIntersectingTiles",value:function(e){var t=this._graphicStore.getBounds(e);if(!t||0===(0,k.bf)(t)||0===(0,k.Cb)(t))return[];var r=(0,tt.Zu)(t,this.view.spatialReference);return(0,m.pC)(r)?(0,a.Z)(new Set([].concat((0,a.Z)(this.view.graphicsTileStore.boundsIntersections(r[0])),(0,a.Z)(this.view.graphicsTileStore.boundsIntersections(r[1]))))):this.view.graphicsTileStore.boundsIntersections(t)}},{key:"_updateTile",value:function(){var e=(0,n.Z)(regeneratorRuntime.mark((function e(t){var r,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return(0,g.k_)(this._controller.signal),r=t.tile,i=this._getGraphicsData(this._templateStore,r,t.addedOrModified),e.next=5,this._processGraphics(r,i);case 5:return n=e.sent,e.abrupt("return",((0,g.k_)(this._controller.signal),this._patchTile(r.key,{type:"update",addOrUpdate:n,remove:t.removed,end:!0,clear:!1,sort:!1}),n));case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_patchTile",value:function(e,t){if(this._tiles.has(e)){var r=this._tiles.get(e);this.container.onTileData(r,t),this.container.requestRender()}}},{key:"_graphicsChangeHandler",value:function(e){var t,r=this._pendingUpdate,i=(0,s.Z)(e.added);try{for(i.s();!(t=i.n()).done;){var n=t.value;r.added.add(n)}}catch(f){i.e(f)}finally{i.f()}var a,o=(0,s.Z)(e.moved);try{for(o.s();!(a=o.n()).done;){var u=a.value;r.updated.add(u)}}catch(f){o.e(f)}finally{o.f()}var l,h=(0,s.Z)(e.removed);try{for(h.s();!(l=h.n()).done;){var d=l.value;this._pendingUpdate.added.has(d)?r.added.delete(d):r.removed.add(d)}}catch(f){h.e(f)}finally{h.f()}this._processing?this._needsProcessing=!0:this._updateGraphics()}},{key:"_getGraphicsToUpdate",value:function(){var e={added:[],removed:[],updated:[]};if(!this.graphics)return e;var t,r=this._pendingUpdate,i=(0,s.Z)(this.graphics.items);try{for(i.s();!(t=i.n()).done;){var n=t.value;r.added.has(n)?e.added.push(n):r.updated.has(n)&&e.updated.push(n)}}catch(l){i.e(l)}finally{i.f()}var a,o=(0,s.Z)(r.removed);try{for(o.s();!(a=o.n()).done;){var u=a.value;this._graphicStore.has(u)&&e.removed.push(u)}}catch(l){o.e(l)}finally{o.f()}return r.added.clear(),r.removed.clear(),r.updated.clear(),e}},{key:"_updateGraphics",value:function(){var e=(0,n.Z)(regeneratorRuntime.mark((function e(){var t,r,n,a,o,u,l,h,d,f,c,v,y,p,m,_,x,b,k,D,C,w,Z,B,T,F,I,R,M,L,S,A,z,O,G,U,V,P,j,K,E,H;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(this._processing=!0,t=this._getGraphicsToUpdate(),r=t.added,n=t.removed,a=t.updated,o=this._tilesToUpdate,e.prev=2,this._graphicStoreUpdate||(l=this.view.state,h=l.resolution,this._graphicStore.updateLevel(h)),d=[],f=new Array(r.length+n.length),c=0;c<a.length;c++){v=a[c],y=this._getIntersectingTiles(v),p=(0,s.Z)(y);try{for(p.s();!(m=p.n()).done;)_=m.value,u=_.id,_t(u,_,o).removed.push(this._displayIds.get(v.uid))}catch(q){p.e(q)}finally{p.f()}d.push(this._updateGraphic(v,null)),f[c]=v}for(x=a.length,b=0;b<r.length;b++)k=r[b],f[x+b]=k,this._graphicsSet.add(k),d.push(this._addGraphic(k));D=(0,s.Z)(n);try{for(D.s();!(C=D.n()).done;){w=C.value,this._abortProcessingGraphic(w.uid),Z=this._getIntersectingTiles(w),B=(0,s.Z)(Z);try{for(B.s();!(T=B.n()).done;)F=T.value,u=F.id,_t(u,F,o).removed.push(this._displayIds.get(w.uid))}catch(q){B.e(q)}finally{B.f()}this._graphicsSet.delete(w),this._graphicStore.remove(w)}}catch(q){D.e(q)}finally{D.f()}return this._flipUpdatingGraphics(),e.next=13,Promise.all(d);case 13:for(R=0;R<f.length;R++){I=f[R],M=this._getIntersectingTiles(I),L=(0,s.Z)(M);try{for(L.s();!(S=L.n()).done;)A=S.value,u=A.id,_t(u,A,o).addedOrModified.push(I)}catch(q){L.e(q)}finally{L.f()}}this._graphicStore.updateZ(),z=[],O=(0,s.Z)(o);try{for(O.s();!(G=O.n()).done;)U=(0,i.Z)(G.value,2),U[0],V=U[1],z.push(this._updateTile(V))}catch(q){O.e(q)}finally{O.f()}return e.next=20,Promise.all(z);case 20:e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](2),(0,g.D_)(e.t0);case 25:P=(0,s.Z)(n),e.prev=26,P.s();case 28:if((j=P.n()).done){e.next=42;break}return K=j.value,e.prev=30,e.next=33,this._getSymbolForGraphic(K,{});case 33:E=e.sent,E&&(H=E.hash(),this._hashToExpandedSymbol.delete(H)),e.next=40;break;case 37:e.prev=37,e.t1=e["catch"](30),(0,g.D_)(e.t1);case 40:e.next=28;break;case 42:e.next=47;break;case 44:e.prev=44,e.t2=e["catch"](26),P.e(e.t2);case 47:return e.prev=47,P.f(),e.finish(47);case 50:o.clear(),this.notifyChange("updating"),this._processing=!1,this._needsProcessing&&(this._needsProcessing=!1,this._updateGraphics());case 51:case"end":return e.stop()}}),e,this,[[2,22],[26,44,47,50],[30,37]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"_getArcadeInfo",value:function(e){var t=(e.attributes?Object.keys(e.attributes):[]).map((function(t){return{name:t,alias:t,type:"string"==typeof e.attributes[t]?"esriFieldTypeString":"esriFieldTypeDouble"}}));return(0,m.Wi)(e.geometry)?null:{geometryType:(0,C.Ji)(e.geometry),spatialReference:b.Z.fromJSON(e.geometry.spatialReference),fields:t}}},{key:"_getSymbolForGraphic",value:function(e,t){return(0,g.k_)(this._controller.signal),(0,m.pC)(e.symbol)?Promise.resolve(e.symbol):(0,m.pC)(this.renderer)?this.renderer.getSymbolAsync(e,{scale:this.view.scale,abortOptions:t}):Promise.resolve(this._getNullSymbol(e))}},{key:"_getCIMSymbol",value:function(e,t,r){var i=this,n=this._hashToCIM.get(t);if(n)return Promise.resolve(n);var a=(0,V.rW)(e);if((0,m.pC)(a)){if("CIMSymbolReference"===a.type)return n=a,this._hashToCIM.set(t,n),Promise.resolve(n);var s=this._hashToCIMSymbolPromise.get(t);return s||(s=a.fetchCIMSymbol(r).then((function(e){return i._hashToCIM.set(t,e.data),i._hashToCIMSymbolPromise.delete(t),e})).catch((function(e){return i._hashToCIMSymbolPromise.delete(t),(0,g.r9)(e),null})),this._hashToCIMSymbolPromise.set(t,s),s)}return Promise.resolve(null)}},{key:"_expandCIMSymbol",value:function(e,t,r,i){var n=this,a=this._hashToExpandedSymbol.get(r);if(a)return Promise.resolve(a);var s=this._hashToExpandedSymbolPromise.get(r);if(s)return s;var o=this.container.stage,u=this._getArcadeInfo(t),l=(0,Ve.createSymbolSchema)(e);return s=(0,vt.B3)(l,u,o.resourceManager,i),this._hashToExpandedSymbolPromise.set(r,s),s.then((function(e){return n._hashToExpandedSymbol.set(r,e),n._hashToExpandedSymbolPromise.delete(r),e})),s}},{key:"_getSymbolResources",value:function(){var e=(0,n.Z)(regeneratorRuntime.mark((function e(t,r){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return(0,g.k_)(this._controller.signal),e.abrupt("return",this.container.stage?this._getSymbolForGraphic(t,r).then((function(e){var a=e.hash();return n._getCIMSymbol(e,a,r).then((function(e){return(0,m.Wi)(e)?null:n._expandCIMSymbol(e,t,a,r).then((function(e){var t=e.layers.filter((function(e){return"text"===e.type&&"string"==typeof e.text}));if(t&&t.length>0){for(var r=new Array(t.length),s=0;s<t.length;s++){for(var o=t[s],u=[],l=(0,v.E)(o.text),h=(0,i.Z)(l,1),d=h[0],f=0;f<d.length;f++)u.push(d.charCodeAt(f));r[s]={symbol:o,id:s,glyphIds:u}}var c=new Map;return n.container.getMaterialItems(r).then((function(r){for(var i=0;i<t.length;i++){var n=t[i];c.set(n.cim,{text:n.text,mosaicItem:r[i].mosaicItem})}return{symbol:e,textInfo:c,hash:a}}))}return{symbol:e,hash:a}}))}))})).catch((function(e){return(0,g.r9)(e),null})):null);case 2:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_projectAndNormalizeGeometry",value:function(){var e=(0,n.Z)(regeneratorRuntime.mark((function e(t,r){var i,n,a,s,o,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if((0,g.k_)(this._controller.signal),!(0,m.Wi)(t.geometry)&&"mesh"!==t.geometry.type){e.next=2;break}return e.abrupt("return",null);case 2:if(i=t.geometry,!(0,C.oU)(i)){e.next=8;break}n=i.rings,i.rings=n,e.next=18;break;case 8:if(!(0,C.l9)(i)){e.next=13;break}a=i.paths,i.paths=a,e.next=18;break;case 13:if(!(0,C.YX)(i)){e.next=18;break}return e.next=16,this._getSymbolForGraphic(t,r);case 16:s=e.sent,(0,g.k_)(this._controller.signal),i=(0,tt.yA)(s.type)||(0,tt.ab)(s.type)?i.center:(0,tt.XA)(i);case 18:return e.next=20,(0,U._W)(i.spatialReference,this.view.spatialReference);case 20:return o=F(i),u=(0,U.iV)(o,i.spatialReference,this.view.spatialReference),e.abrupt("return",((0,D.pW)(u),u));case 22:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_onTileUpdate",value:function(e){var t=(0,T.C5)(this.view.spatialReference);if(e.added&&e.added.length>0){var r,i=(0,s.Z)(e.added);try{for(i.s();!(r=i.n()).done;){var n=r.value;this._addNewTile(n,t)}}catch(l){i.e(l)}finally{i.f()}}if(e.removed&&e.removed.length>0){var a,o=(0,s.Z)(e.removed);try{for(o.s();!(a=o.n()).done;){var u=a.value;this._removeTile(u.key)}}catch(l){o.e(l)}finally{o.f()}}}},{key:"_addGraphic",value:function(){var e=(0,n.Z)(regeneratorRuntime.mark((function e(t){var r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this._abortProcessingGraphic(t.uid),(0,g.k_)(this._controller.signal),r=new AbortController,this._graphicIdToAbortController.set(t.uid,r),i={signal:r.signal},e.prev=4,e.next=7,this._addOrUpdateGraphic(t,i);case 7:(0,g.k_)(this._controller.signal),this._graphicIdToAbortController.delete(t.uid),e.next=15;break;case 11:if(e.prev=11,e.t0=e["catch"](4),this._graphicIdToAbortController.delete(t.uid),(0,g.D_)(e.t0)){e.next=15;break}throw e.t0;case 15:case"end":return e.stop()}}),e,this,[[4,11]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_updateGraphic",value:function(e,t){var r=this;(0,g.k_)(this._controller.signal);var n=this._projectAndNormalizeGeometry(e,t),a=this._getSymbolResources(e,t);return Promise.all([n,a]).then((function(t){var n=(0,i.Z)(t,2),a=n[0],s=n[1];(0,g.k_)(r._controller.signal),r._graphicStore.addOrModify(e,s,a)}))}},{key:"_addOrUpdateGraphic",value:function(e,t){var r=this;(0,g.k_)(this._controller.signal);var n=this._projectAndNormalizeGeometry(e,t),a=this._getSymbolResources(e,t);return Promise.all([n,a]).then((function(t){var n=(0,i.Z)(t,2),a=n[0],s=n[1];(0,g.k_)(r._controller.signal),r._graphicsSet.has(e)&&r._graphicStore.addOrModify(e,s,a)}))}},{key:"_addTile",value:function(e){var t=this.view.featuresTilingScheme.getTileBounds((0,k.Ue)(),e),r=new ne(e,t[0],t[3]);return this._tiles.set(e,r),this.container.addChild(r),r}},{key:"_addNewTile",value:function(){var e=(0,n.Z)(regeneratorRuntime.mark((function e(t,r){var i,n,a,o,u,l,h,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=this._addTile(t.key),n=this._graphicStore.queryTileData(this._templateStore,t),0!==n.length){e.next=3;break}return e.abrupt("return");case 3:if(r){a=Math.round((r.valid[1]-r.valid[0])/t.resolution),o=(0,s.Z)(n);try{for(o.s();!(u=o.n()).done;)l=u.value,l.geometry&&((0,C.wp)(l.geometry)||(0,C.aW)(l.geometry))&&this._wrapPoints(l,a)}catch(f){o.e(f)}finally{o.f()}}return h=t.key,this._tileUpdateSet.add(t.key),this.notifyChange("updating"),e.prev=6,e.t0=!1,e.next=10,this._processGraphics(t,n);case 10:e.t1=e.sent,e.t2=[],e.t3=!0,e.t4=!1,d={type:"update",clear:e.t0,addOrUpdate:e.t1,remove:e.t2,end:e.t3,sort:e.t4},i.patch(d),this._tileUpdateSet.delete(h),this.notifyChange("updating"),e.next=22;break;case 18:if(e.prev=18,e.t5=e["catch"](6),this._tileUpdateSet.delete(h),this.notifyChange("updating"),(0,g.D_)(e.t5)){e.next=22;break}throw e.t5;case 22:case"end":return e.stop()}}),e,this,[[6,18]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_removeTile",value:function(e){if(this._tiles.has(e)){var t=this._tiles.get(e);this.container.removeChild(t),t.destroy(),this._tiles.delete(e)}}},{key:"_setFilterState",value:function(e,t){var r=this._displayIds.get(e),i=this._attributeStore.getHighlightFlag(e);this._attributeStore.setData(r,0,0,i|(t?j.Zd:0))}},{key:"_getGraphicsData",value:function(e,t,r){var i=this.view,n=(0,T.C5)(i.spatialReference),a=this._graphicStore.getGraphicsData(e,t,r);if(n){var o,u=Math.round((n.valid[1]-n.valid[0])/t.resolution),l=(0,s.Z)(a);try{for(l.s();!(o=l.n()).done;){var h=o.value;h.geometry&&((0,C.wp)(h.geometry)||(0,C.aW)(h.geometry))&&this._wrapPoints(h,u)}}catch(d){l.e(d)}finally{l.f()}}return a}},{key:"_wrapPoints",value:function(e,t){var r=e.geometry;(0,C.aW)(r)?this._wrapMultipoint(r,t):this._wrapPoint(e,t)}},{key:"_wrapMultipoint",value:function(e,t){var r,n=e.points,a=[],o=0,u=0,l=(0,s.Z)(n);try{for(l.s();!(r=l.n()).done;){var h=(0,i.Z)(r.value,2),d=h[0],f=h[1];if(a.push([d+o,f]),o=0,t===tt.I_){var c=5*tt.y1;d+u<c?(a.push([t,0]),o=-t):d+u>tt.I_-c&&(a.push([-t,0]),o=t)}else d+u<-tt.y1?(a.push([t,0]),o=-t):d+u>tt.I_+tt.y1&&(a.push([-t,0]),o=t);u+=d}}catch(v){l.e(v)}finally{l.f()}e.points=a}},{key:"_wrapPoint",value:function(e,t){var r=e.geometry;if(t===tt.I_){var i=5*tt.y1;r.x<i?e.geometry={points:[[r.x,r.y],[t,0]]}:r.x>tt.I_-i&&(e.geometry={points:[[r.x,r.y],[-t,0]]})}else r.x<-tt.y1?e.geometry={points:[[r.x,r.y],[t,0]]}:r.x>tt.I_+tt.y1&&(e.geometry={points:[[r.x,r.y],[-t,0]]})}},{key:"_processGraphics",value:function(e,t,r){var i=this;if(!t||!t.length||!this._meshFactory)return null;var n=qe.from(t),a=this._meshFactory;return this._matcher.then((function(t){return a.analyzeGraphics(n,i.container.stage.resourceManager,t,null,null,r).then((function(){return i._attributeStore.sendUpdates(),i._processAnalyzedGraphics(e,n)}))}))}},{key:"_processAnalyzedGraphics",value:function(e,t){for(var r=this._meshFactory,i=t.getSize(),n=t.getCursor(),a={features:i,records:i,metrics:0},s=new ze._(e.key.id,a,{fill:"default"},!1,!1),o=[];n.next();){var u=n.readGraphic();u.insertAfter=-1===u.insertAfter?-1:this._displayIds.get(u.insertAfter),u.displayId=this._displayIds.get(u.attributes[this.uid]);var l=new xe(u.displayId);l.insertAfter=u.insertAfter,o.push(l),r.writeGraphic(s,n,e.level)}var h=e.tileInfoView.tileInfo.isWrappable,d=s.serialize(h);if(1!==d.length)return new Ae;var f=d[0].message;return Ae.fromVertexData(f,o)}},{key:"_abortProcessingGraphic",value:function(e){this._graphicIdToAbortController.has(e)&&this._graphicIdToAbortController.get(e).abort()}},{key:"_getNullSymbol",value:function(e){var t=e.geometry;return(0,C.l9)(t)?P.mW:(0,C.oU)(t)||(0,C.YX)(t)?P.kD:P.G}},{key:"_flipUpdatingGraphics",value:function(){var e=this;this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=setTimeout((function(){e._updatingGraphicsTimer=null,e.notifyChange("updating")}),160),this.notifyChange("updating")}}]),r}(pt((0,y.p)(c.Z)));(0,f._)([(0,_.Cb)({constructOnly:!0})],xt.prototype,"requestUpdateCallback",void 0),(0,f._)([(0,_.Cb)()],xt.prototype,"container",void 0),(0,f._)([(0,_.Cb)({constructOnly:!0})],xt.prototype,"graphics",void 0),(0,f._)([(0,_.Cb)()],xt.prototype,"updating",null),(0,f._)([(0,_.Cb)()],xt.prototype,"view",void 0),(0,f._)([(0,_.Cb)()],xt.prototype,"updateRequested",void 0),xt=(0,f._)([(0,x.j)("esri.views.2d.layers.support.GraphicsView2D")],xt);var bt=xt}}]);