"use strict";(self["webpackChunkvue_url_arcgis"]=self["webpackChunkvue_url_arcgis"]||[]).push([[696],{89748:function(e,t,i){i.d(t,{eY:function(){return x}});var r=i(2394),n=i(76133),a=i(92751),s=i(43263),l=i(50460),o=i(87349),u=i(99418),h=i(49161),c=i(27092),y=i(68491),d=i(33482),f=i(38683),v=i(80188),p=i(70306),_=i(29168);function g(e){return e&&"render"in e}function m(e){return e&&!("render"in e)}function b(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.render(t.getContext("2d")),t}function w(e,t,i){var r={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return t&&i&&(r.width=t,r.height=i),new _.Z(e,r)}var x=function(e){(0,u.Z)(i,e);var t=(0,h.Z)(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0,l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,n.Z)(this,i),e=t.call(this),e.requestRenderOnSourceChangedEnabled=l,e._textureInvalidated=!0,e.stencilRef=0,e.coordScale=[1,1],e._height=void 0,e.pixelRatio=1,e.resolution=0,e.rotation=0,e._source=null,e._width=void 0,e.x=0,e.y=0,e.blendFunction=a,e.source=r,e.requestRender=e.requestRender.bind((0,s.Z)(e)),e}return(0,a.Z)(i,[{key:"destroy",value:function(){this._texture&&(this._texture.dispose(),this._texture=null)}},{key:"isSourceScaled",get:function(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}},{key:"height",get:function(){return void 0!==this._height?this._height:this.sourceHeight},set:function(e){this._height=e}},{key:"source",get:function(){return this._source},set:function(e){this._source=e,this.invalidateTexture()}},{key:"sourceHeight",get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}},{key:"sourceWidth",get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}},{key:"width",get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(e){this._width=e}},{key:"beforeRender",value:function(e){(0,l.Z)((0,o.Z)(i.prototype),"beforeRender",this).call(this,e),this.updateTexture(e.context)}},{key:"invalidateTexture",value:function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}},{key:"_createTransforms",value:function(){return{dvs:(0,d.c)()}}},{key:"setTransform",value:function(e){var t=(0,y.b)(this.transforms.dvs),i=e.toScreenNoRotation([0,0],[this.x,this.y]),n=(0,r.Z)(i,2),a=n[0],s=n[1],l=this.resolution/this.pixelRatio/e.resolution,o=l*this.width,u=l*this.height,h=Math.PI*this.rotation/180;(0,y.c)(t,t,(0,f.f)(a,s)),(0,y.c)(t,t,(0,f.f)(o/2,u/2)),(0,y.r)(t,t,-h),(0,y.c)(t,t,(0,f.f)(-o/2,-u/2)),(0,y.j)(t,t,(0,f.f)(o,u)),(0,y.m)(this.transforms.dvs,e.displayViewMat3,t)}},{key:"setSamplingProfile",value:function(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}},{key:"bind",value:function(e,t){this._texture&&e.bindTexture(this._texture,t)}},{key:"updateTexture",value:function(e){var t;if(!this.stage)return null==(t=this._texture)||t.dispose(),void(this._texture=null);if(this._textureInvalidated){this._textureInvalidated=!1,this._texture||(this.source?this._texture=w(e,this.sourceWidth,this.sourceHeight):this._texture=w(e));var i=this.source;if(i){if(this._texture.resize(this.sourceWidth,this.sourceHeight),g(i))if(i instanceof p.Z){var r=i.getRenderedRasterPixels();this._texture.setData((0,c.pC)(r)?r.renderedRasterPixels:null)}else this._texture.setData(b(i));else m(i)&&this._texture.setData(i);this.ready()}else this._texture.setData(null)}}},{key:"onAttach",value:function(){this.invalidateTexture()}},{key:"onDetach",value:function(){this.invalidateTexture()}}]),i}(v.s)},26797:function(e,t,i){i.d(t,{c:function(){return d}});var r=i(1936),n=i(76133),a=i(92751),s=i(50460),l=i(87349),o=i(99418),u=i(49161),h=(i(41539),i(92222),i(94947)),c=i(49026),y=i(47303),d=function(e){(0,o.Z)(i,e);var t=(0,u.Z)(i);function i(){return(0,n.Z)(this,i),t.apply(this,arguments)}return(0,a.Z)(i,[{key:"requiresDedicatedFBO",get:function(){return this.children.some((function(e){return"additive"===e.blendFunction}))}},{key:"prepareRenderPasses",value:function(e){var t=this,n=e.registerRenderPass({name:"bitmap",brushes:[h.U.bitmap],target:function(){return t.children},drawPhase:c.jx.MAP});return[].concat((0,r.Z)((0,s.Z)((0,l.Z)(i.prototype),"prepareRenderPasses",this).call(this,e)),[n])}}]),i}(y.Z)},70306:function(e,t,i){i.d(t,{Z:function(){return s}});var r=i(76133),n=i(92751),a=(i(57327),i(41539),i(82472),i(48675),i(92990),i(18927),i(33105),i(35035),i(74345),i(7174),i(32846),i(44731),i(77209),i(96319),i(58867),i(37789),i(33739),i(29368),i(14483),i(12056),i(3462),i(30678),i(27462),i(33824),i(55021),i(12974),i(15016),i(27092)),s=function(){function e(t,i,n){(0,r.Z)(this,e),this.pixelBlock=t,this.extent=i,this.originalPixelBlock=n}return(0,n.Z)(e,[{key:"width",get:function(){return(0,a.pC)(this.pixelBlock)?this.pixelBlock.width:0}},{key:"height",get:function(){return(0,a.pC)(this.pixelBlock)?this.pixelBlock.height:0}},{key:"render",value:function(e){var t=this.pixelBlock;if(!(0,a.Wi)(t)){var i=this.filter({pixelBlock:t});if(!(0,a.Wi)(i.pixelBlock)){var r=i.pixelBlock.getAsRGBA(),n=e.createImageData(i.pixelBlock.width,i.pixelBlock.height);n.data.set(r),e.putImageData(n,0,0)}}}},{key:"getRenderedRasterPixels",value:function(){var e=this.filter({pixelBlock:this.pixelBlock});return(0,a.Wi)(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}]),e}()},28082:function(e,t,i){i.d(t,{Z:function(){return p}});var r=i(62032),n=i(76133),a=i(92751),s=i(50460),l=i(87349),o=i(99418),u=i(49161),h=i(35425),c=i(49026),y=i(47303),d=i(51847),f=i(70466),v=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},p=function(e){(0,o.Z)(i,e);var t=(0,u.Z)(i);function i(e){var r;return(0,n.Z)(this,i),r=t.call(this),r._tileInfoView=e,r}return(0,a.Z)(i,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(v),this.setStencilReference(),(0,s.Z)((0,l.Z)(i.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,r=(0,s.Z)((0,l.Z)(i.prototype),"createRenderParams",this).call(this,e);return r.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,r.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),r}},{key:"prepareRenderPasses",value:function(e){var t=this,r=(0,s.Z)((0,l.Z)(i.prototype),"prepareRenderPasses",this).call(this,e);return r.push(e.registerRenderPass({name:"stencil",brushes:[f.Z],drawPhase:c.jx.DEBUG|c.jx.MAP|c.jx.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),(0,h.Z)("esri-tiles-debug")&&r.push(e.registerRenderPass({name:"tileInfo",brushes:[d.Z],drawPhase:c.jx.DEBUG,target:function(){return t.children}})),r}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t,i=(0,r.Z)(this.children);try{for(i.s();!(t=i.n()).done;){var n=t.value,a=this._tileInfoView.getTileResolution(n.key);n.setTransform(e,a)}}catch(s){i.e(s)}finally{i.f()}}},{key:"setStencilReference",value:function(){var e,t=1,i=(0,r.Z)(this.children);try{for(i.s();!(e=i.n()).done;){var n=e.value;n.stencilRef=t++}}catch(a){i.e(a)}finally{i.f()}}}]),i}(y.Z)},35819:function(e,t,i){i.d(t,{I:function(){return c}});var r=i(2394),n=i(76133),a=i(92751),s=i(99418),l=i(49161),o=i(68491),u=i(80188),h=i(12744),c=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(e,r,a,s,l){var o,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:s,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l;return(0,n.Z)(this,i),o=t.call(this),o.triangleCountReportedInDebug=0,o.triangleCount=0,o.texture=null,o.key=new h.Z(e),o.x=r,o.y=a,o.width=s,o.height=l,o.rangeX=u,o.rangeY=c,o}return(0,a.Z)(i,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"setTransform",value:function(e,t){var i=t/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,a=e.toScreenNoRotation([0,0],[this.x,this.y]),s=(0,r.Z)(a,2),l=s[0],u=s[1],h=this.width/this.rangeX*i,c=this.height/this.rangeY*i;(0,o.s)(n,h,0,0,0,c,0,l,u,1),(0,o.m)(this.transforms.dvs,e.displayViewMat3,n)}}]),i}(u.s)},21211:function(e,t,i){i.d(t,{y:function(){return B}});var r=i(76133),n=i(92751),a=i(50460),s=i(87349),l=i(99418),o=i(49161),u=(i(41539),i(63825)),h=i(54643),c=i(80218),y=i(44621),d=i(2553),f=(i(57787),i(35425),i(90202),i(92236)),v=i(38430),p=i(71741),_=(i(87441),i(61726),function(e){(0,l.Z)(i,e);var t=(0,o.Z)(i);function i(){return(0,r.Z)(this,i),t.apply(this,arguments)}return(0,n.Z)(i)}(p.wq));_=(0,u._)([(0,f.j)("esri.views.layers.support.ClipArea")],_);var g,m=_,b=(i(9653),g=function(e){(0,l.Z)(i,e);var t=(0,o.Z)(i);function i(){var e;return(0,r.Z)(this,i),e=t.apply(this,arguments),e.type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}return(0,n.Z)(i,[{key:"clone",value:function(){return new g({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}},{key:"version",get:function(){return(this._get("version")||0)+1}}]),i}(m));(0,u._)([(0,d.Cb)({type:[Number,String],json:{write:!0}})],b.prototype,"left",void 0),(0,u._)([(0,d.Cb)({type:[Number,String],json:{write:!0}})],b.prototype,"right",void 0),(0,u._)([(0,d.Cb)({type:[Number,String],json:{write:!0}})],b.prototype,"top",void 0),(0,u._)([(0,d.Cb)({type:[Number,String],json:{write:!0}})],b.prototype,"bottom",void 0),(0,u._)([(0,d.Cb)({readOnly:!0})],b.prototype,"version",null),b=g=(0,u._)([(0,f.j)("esri.views.layers.support.ClipRect")],b);var w,x=b,k=(i(75065),i(22779)),Z=i(64316),S=i(7230),C=i(72110),I={base:k.Z,key:"type",typeMap:{extent:S.Z,polygon:C.Z}},R=w=function(e){(0,l.Z)(i,e);var t=(0,o.Z)(i);function i(){var e;return(0,r.Z)(this,i),e=t.apply(this,arguments),e.type="geometry",e.geometry=null,e}return(0,n.Z)(i,[{key:"version",get:function(){return(this._get("version")||0)+1}},{key:"clone",value:function(){return new w({geometry:this.geometry.clone()})}}]),i}(m);(0,u._)([(0,d.Cb)({types:I,json:{read:Z.im,write:!0}})],R.prototype,"geometry",void 0),(0,u._)([(0,d.Cb)({readOnly:!0})],R.prototype,"version",null),R=w=(0,u._)([(0,f.j)("esri.views.layers.support.Geometry")],R);var T=R,P=function(e){(0,l.Z)(i,e);var t=(0,o.Z)(i);function i(){var e;return(0,r.Z)(this,i),e=t.apply(this,arguments),e.type="path",e.path=[],e}return(0,n.Z)(i,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),i}(m);(0,u._)([(0,d.Cb)({type:[[[Number]]],json:{write:!0}})],P.prototype,"path",void 0),(0,u._)([(0,d.Cb)({readOnly:!0})],P.prototype,"version",null),P=(0,u._)([(0,f.j)("esri.views.layers.support.Path")],P);var D=P,M=h.Z.ofType({key:"type",base:m,typeMap:{rect:x,path:D,geometry:T}}),B=function(e){var t=function(e){(0,l.Z)(i,e);var t=(0,o.Z)(i);function i(){var e;return(0,r.Z)(this,i),e=t.apply(this,arguments),e.clips=new M,e.moving=!1,e.attached=!1,e.lastUpdateId=-1,e.updateRequested=!1,e}return(0,n.Z)(i,[{key:"initialize",value:function(){var e,t=this;this.container||(this.container=new v.W),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([(0,y.S1)(this,"suspended",(function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestUpdate()}),!0),(0,y.S1)(this,["layer.opacity","container"],(function(){var e,i;t.container&&(t.container.opacity=null!=(e=null==(i=t.layer)?void 0:i.opacity)?e:1)}),!0),(0,y.S1)(this,["layer.blendMode"],(function(e){t.container&&(t.container.blendMode=e)}),!0),(0,y.S1)(this,["layer.effect"],(function(e){t.container&&(t.container.effect=e)}),!0),this.clips.on("change",(function(){t.container.clips=t.clips,t.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e!==t||t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){})):this.when().then((function(){t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){}))}},{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(!this.updatingHandles||!this.updatingHandles.updating)}},{key:"isVisibleAtScale",value:function(e){var t=!0,i=this.layer,r=i.minScale,n=i.maxScale;if(null!=r&&null!=n){var a=!r,s=!n;!a&&e<=r&&(a=!0),!s&&e>=n&&(s=!0),t=a&&s}return t}},{key:"requestUpdate",value:function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"hitTest",value:function(e,t){return Promise.resolve(null)}},{key:"isUpdating",value:function(){return!1}},{key:"isRendering",value:function(){return!1}},{key:"canResume",value:function(){return!!(0,a.Z)((0,s.Z)(i.prototype),"canResume",this).call(this)&&this.isVisibleAtScale(this.view.scale)}}]),i}(e);return(0,u._)([(0,d.Cb)({type:M,set:function(e){var t=(0,c.Z)(e,this._get("clips"),M);this._set("clips",t)}})],t.prototype,"clips",void 0),(0,u._)([(0,d.Cb)()],t.prototype,"moving",void 0),(0,u._)([(0,d.Cb)()],t.prototype,"attached",void 0),(0,u._)([(0,d.Cb)()],t.prototype,"container",void 0),(0,u._)([(0,d.Cb)()],t.prototype,"suspended",void 0),(0,u._)([(0,d.Cb)({readOnly:!0})],t.prototype,"updateParameters",void 0),(0,u._)([(0,d.Cb)()],t.prototype,"updateRequested",void 0),(0,u._)([(0,d.Cb)()],t.prototype,"updating",null),(0,u._)([(0,d.Cb)()],t.prototype,"view",void 0),t=(0,u._)([(0,f.j)("esri.views.2d.layers.LayerView2D")],t),t}},80696:function(e,t,i){i.r(t),i.d(t,{default:function(){return et}});var r=i(1936),n=i(2394),a=i(62032),s=i(16198),l=i(76133),o=i(92751),u=i(50460),h=i(87349),c=i(99418),y=i(49161),d=(i(78975),i(41539),i(57327),i(54747),i(78783),i(33948),i(47941),i(63825)),f=i(7380),v=i(25585),p=i(40199),_=i(87441),g=i(27092),m=i(24446),b=i(44621),w=i(2553),x=(i(90202),i(92236)),k=i(93400),Z=i(49938),S=i(4367),C=i(35680),I=i(35425),R=i(58476),T=i(17044),P=(i(51532),i(82472),i(48675),i(92990),i(18927),i(33105),i(35035),i(74345),i(7174),i(32846),i(44731),i(77209),i(96319),i(58867),i(37789),i(33739),i(29368),i(14483),i(12056),i(3462),i(30678),i(27462),i(33824),i(55021),i(12974),i(15016),i(70189),i(12794)),D=(i(17115),i(56770),i(28383),i(15401),i(29168)),M=i(82595),B=(i(40561),i(72087)),A=function(){function e(t,i){(0,l.Z)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new B.Z(0,0,t,i))}return(0,o.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new B.Z;for(var i=null,r=-1,n=0;n<this._free.length;++n){var a=this._free[n];e<=a.width&&t<=a.height&&(null===i||a.y<=i.y&&a.x<=i.x)&&(i=a,r=n)}return null===i?new B.Z:(this._free.splice(r,1),i.width<i.height?(i.width>e&&this._free.push(new B.Z(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new B.Z(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new B.Z(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new B.Z(i.x,i.y+t,e,i.height-t))),new B.Z(i.x,i.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}(),L=function(){function e(t,i,r){(0,l.Z)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=r,this._binPack=new A(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(void 0)}return(0,o.Z)(e,[{key:"getGlyphItems",value:function(e,t){var i,r=this,n=[],s=this._glyphSource,l=new Set,o=1/256,u=(0,a.Z)(t);try{for(u.s();!(i=u.n()).done;){var h=i.value,c=Math.floor(h*o);l.add(c)}}catch(d){u.e(d)}finally{u.f()}var y=[];return l.forEach((function(t){if(t<=256){var i=e+t;if(r._rangePromises.has(i))y.push(r._rangePromises.get(i));else{var n=s.getRange(e,t).then((function(){r._rangePromises.delete(i)}),(function(){r._rangePromises.delete(i)}));r._rangePromises.set(i,n),y.push(n)}}})),Promise.all(y).then((function(){var i=r._glyphIndex[e];i||(i={},r._glyphIndex[e]=i);var l,o=(0,a.Z)(t);try{for(o.s();!(l=o.n()).done;){var u=l.value,h=i[u];if(h)n[u]={sdf:!0,rect:h.rect,metrics:h.metrics,page:h.page,code:u};else{var c=s.getGlyph(e,u);if(c&&c.metrics){var y=c.metrics,f=void 0;if(0===y.width)f=new B.Z(0,0,0,0);else{var v=3,p=y.width+2*v,_=y.height+2*v,g=p%4?4-p%4:4,m=_%4?4-_%4:4;1===g&&(g=5),1===m&&(m=5),f=r._binPack.allocate(p+g,_+m),f.isEmpty&&(r._dirties[r._currentPage]||(r._glyphData[r._currentPage]=null),r._currentPage=r._glyphData.length,r._glyphData.push(new Uint8Array(r.width*r.height)),r._dirties.push(!0),r._textures.push(void 0),r._binPack=new A(r.width-4,r.height-4),f=r._binPack.allocate(p+g,_+m));var b=r._glyphData[r._currentPage],w=c.bitmap,x=void 0,k=void 0;if(w)for(var Z=0;Z<_;Z++){x=p*Z,k=r.width*(f.y+Z+1)+f.x;for(var S=0;S<p;S++)b[k+S+1]=w[x+S]}}i[u]={rect:f,metrics:y,tileIDs:null,page:r._currentPage},n[u]={sdf:!0,rect:f,metrics:y,page:r._currentPage,code:u},r._dirties[r._currentPage]=!0}}}}catch(d){o.e(d)}finally{o.f()}return n}))}},{key:"removeGlyphs",value:function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var r=void 0;for(var n in i)if(r=i[n],r.tileIDs.delete(e),0===r.tileIDs.size){for(var a=this._glyphData[r.page],s=r.rect,l=void 0,o=void 0,u=0;u<s.height;u++)for(l=this.width*(s.y+u)+s.x,o=0;o<s.width;o++)a[l+o]=0;delete i[n],this._dirties[r.page]=!0}}}}},{key:"bind",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new D.Z(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var n=this._textures[i];n.setSamplingMode(t),this._dirties[i]&&n.setData(this._glyphData[i]),e.bindTexture(n,r),this._dirties[i]=!1}},{key:"dispose",value:function(){this._binPack=null;var e,t=(0,a.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0}}]),e}(),V=(i(74916),i(15306),i(71182)),O=function(){function e(t){if((0,l.Z)(this,e),this._metrics=[],this._bitmaps=[],t)for(;t.next();)switch(t.tag()){case 1:for(var i=t.getMessage();i.next();)switch(i.tag()){case 3:for(var r=i.getMessage(),n=void 0,a=void 0,s=void 0,o=void 0,u=void 0,h=void 0,c=void 0;r.next();)switch(r.tag()){case 1:n=r.getUInt32();break;case 2:a=r.getBytes();break;case 3:s=r.getUInt32();break;case 4:o=r.getUInt32();break;case 5:u=r.getSInt32();break;case 6:h=r.getSInt32();break;case 7:c=r.getUInt32();break;default:r.skip()}r.release(),n&&(this._metrics[n]={width:s,height:o,left:u,top:h,advance:c},this._bitmaps[n]=a);break;default:i.skip()}i.release();break;default:t.skip()}}return(0,o.Z)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),U=function(){function e(){(0,l.Z)(this,e),this._ranges=[]}return(0,o.Z)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),q=function(){function e(t){(0,l.Z)(this,e),this._glyphInfo={},this._baseURL=t}return(0,o.Z)(e,[{key:"getRange",value:function(e,t){var i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();var r=256*t,n=r+255,a=this._baseURL.replace("{fontstack}",e).replace("{range}",r+"-"+n);return(0,C["default"])(a,{responseType:"array-buffer"}).then((function(e){i.addRange(t,new O(new V.Z(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){i.addRange(t,new O)}))}},{key:"getGlyph",value:function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256);if(!(r>256)){var n=i.getRange(r);return n?{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new U),t}}]),e}(),z=(i(29135),i(23157),i(68309),i(82481),i(4723),i(21249),i(23123),i(9653),i(47042),i(32297)),H="dasharray-",F=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,l.Z)(this,e),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,this._pageWidth=t,this._pageHeight=i,r>0&&(this._maxItemSize=r),this._binPack=new A(t-4,i-4)}return(0,o.Z)(e,[{key:"dispose",value:function(){this._binPack=null,this._mosaicRects={};var e,t=(0,a.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0}},{key:"getWidth",value:function(e){return e>=this._size.length?-1:this._size[e][0]}},{key:"getHeight",value:function(e){return e>=this._size.length?-1:this._size[e][1]}},{key:"getPageSize",value:function(e){return e>=this._size.length?null:this._size[e]}},{key:"setSpriteSource",value:function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new A(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),r=new Uint32Array(t*i);this._mosaicsData[0]=r,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}},{key:"getSpriteItem",value:function(e){var t,i,r,a,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=this._mosaicRects[e];if(l)return l;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith(H)?(t=this._rasterizeDash(e),i=(0,n.Z)(t,2),r=i[0],a=i[1],s=!0):r=this._sprites.getSpriteInfo(e),!r||!r.width||!r.height||r.width<0||r.height<0)return null;var o=r.width,u=r.height,h=this._allocateImage(o,u),c=(0,n.Z)(h,3),y=c[0],d=c[1],f=c[2];return y.width<=0?null:(this._copy(y,r,d,f,s,a),l={rect:y,width:o,height:u,sdf:r.sdf,simplePattern:!1,pixelRatio:r.pixelRatio,page:d},this._mosaicRects[e]=l,l)}},{key:"getSpriteItems",value:function(e){var t,i={},r=(0,a.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;i[n.name]=this.getSpriteItem(n.name,n.repeat)}}catch(s){r.e(s)}finally{r.f()}return i}},{key:"getMosaicItemPosition",value:function(e,t){var i=this.getSpriteItem(e,t),r=i&&i.rect;if(!r)return null;r.width=i.width,r.height=i.height;var n=i.width,a=i.height,s=2;return{tl:[r.x+s,r.y+s],br:[r.x+s+n,r.y+s+a],page:i.page}}},{key:"bind",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new D.Z(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[i][0],height:this._size[i][1]},new Uint8Array(this._mosaicsData[i].buffer)));var n=this._textures[i];n.setSamplingMode(t),this._dirties[i]&&n.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(n,r),this._dirties[i]=!1}},{key:"_copy",value:function(t,i,r,n,a,s){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var l=new Uint32Array(s?s.buffer:this._sprites.image.buffer),o=this._mosaicsData[r],u=2,h=s?i.width:this._sprites.width;e._copyBits(l,h,i.x,i.y,o,n[0],t.x+u,t.y+u,i.width,i.height,a),this._dirties[r]=!0}}},{key:"_allocateImage",value:function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var r=new B.Z(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[r,this._mosaicsData.length-1,[e,t]]}var n=e%4?4-e%4:4,a=t%4?4-t%4:4;1===n&&(n=5),1===a&&(a=5);var s=this._binPack.allocate(e+n,t+a);return s.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new A(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[s,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"_rasterizeDash",value:function(e){var t=/\[(.*?)\]/,i=e.match(t);if(!i)return null;var r=i[1].split(",").map(Number),a=e.slice(e.lastIndexOf("-")+1),s=z.fN.rasterizeDash(r,a),l=(0,n.Z)(s,3),o=l[0],u=l[1],h=l[2];return[{x:0,y:0,width:u,height:h,sdf:!0,pixelRatio:1},new Uint8Array(o.buffer)]}}],[{key:"_copyBits",value:function(e,t,i,r,n,a,s,l,o,u,h){var c=r*t+i,y=l*a+s;if(h){y-=a;for(var d=-1;d<=u;d++,c=((d+u)%u+r)*t+i,y+=a)for(var f=-1;f<=o;f++)n[y+f]=e[c+(f+o)%o]}else for(var v=0;v<u;v++){for(var p=0;p<o;p++)n[y+p]=e[c+p];c+=t,y+=a}}}]),e}();i(92222),i(2707);function j(e,t,i,r,n,a){e.fillStyle=t,e.fillRect(i,r,n,a)}function E(e,t,i,r,n,a){e.strokeStyle=t,e.strokeRect(i,r,n,a)}function W(e,t){for(var i=window.COLLISION_XRAY,r=0;r<t.length;++r){var n=!t[r].unique.show;if(i||!n){var s,l=(0,a.Z)(t[r].colliders);try{for(l.s();!(s=l.n()).done;){var o=s.value;if(o.enabled){var u=!t[r].unique.parts[o.partIndex].show;if(i||!u){var h=o.xScreen,c=o.yScreen,y=o.dxScreen,d=o.dyScreen;e.globalAlpha=n||u?.2:1,j(e,"green",h-1,c-1,3,3),E(e,"red",h+y,c+d,o.width,o.height),j(e,"blue",h+y-1,c+d-1,3,3),e.globalAlpha=1}}}}catch(f){l.e(f)}finally{l.f()}}}}function Q(e,t,i){if(window.PERFORMANCE_RECORDING_STORAGE){var r=window.PERFORMANCE_RECORDING_STORAGE;r.perf=r.perf||{};var n=r.perf;n[e]=n[e]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:i},n[e].time+=t,n[e].samples.push(t),(null==n[e].min||t<n[e].min)&&(n[e].min=t),(null==n[e].max||t>n[e].max)&&(n[e].max=t)}}var N=i(12744),J=function(){function e(t,i,r){(0,l.Z)(this,e),this._layer=t,this._styleRepository=i,this.devicePixelRatio=r,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}return(0,o.Z)(e,[{key:"destroy",value:function(){this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._layer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}},{key:"spriteMosaic",get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}},{key:"start",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var i,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then((function(e){r._spriteMosaic=new F(1024,1024,250),r._spriteMosaic.setSpriteSource(e)})),i=new q(this._layer.currentStyleInfo.glyphsUrl?(0,R.fl)(this._layer.currentStyleInfo.glyphsUrl,(0,S.Z)((0,S.Z)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),this._glyphMosaic=new L(1024,1024,i),this._broadcastPromise=(0,T.bA)("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then((function(e){return r._connection=e,Promise.all(r._connection.broadcast("setStyle",{style:r._layer.currentStyleInfo.style,vectorTileLayerMaxBuffers:(0,I.Z)("vectortilelayer-max-buffers")},t))}));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateStyle",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",t)),e.abrupt("return",this._broadcastPromise);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"setStyle",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t,i){var r,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._styleRepository=t,this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,null),this._spriteSourcePromise.then((function(e){n._spriteMosaic=new F(1024,1024,250),n._spriteMosaic.setSpriteSource(e)})),r=new q(this._layer.currentStyleInfo.glyphsUrl?(0,R.fl)(this._layer.currentStyleInfo.glyphsUrl,(0,S.Z)((0,S.Z)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),e.abrupt("return",(this._glyphMosaic=new L(1024,1024,r),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:i,vectorTileLayerMaxBuffers:(0,I.Z)("vectortilelayer-max-buffers")})),this._broadcastPromise));case 7:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"fetchTileData",value:function(e,t){var i=this;return this._getRefKeys(e,t).then((function(e){var r=i._layer.sourceNameToSource,n=[];for(var a in r)n.push(a);return i._getSourcesData(n,e,t)}))}},{key:"parseTileData",value:function(e,t){var i=this,r=e&&e.data;if(!r)return Promise.resolve(null);var n=r.sourceName2DataAndRefKey,a=r.transferList;return 0===Object.keys(n).length?Promise.resolve(null):this._broadcastPromise.then((function(){return i._connection.getAvailableClient().then((function(i){return i.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:n,styleLayerUIDs:e.styleLayerUIDs},(0,S.Z)((0,S.Z)({},t),{},{transferList:a}))}))}))}},{key:"getSprites",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._spriteSourcePromise;case 2:return e.abrupt("return",this._spriteMosaic.getSpriteItems(t));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getGlyphs",value:function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}},{key:"perfReport",value:function(e){var t=e.key,i=e.milliseconds;Q(t,i,"ms")}},{key:"_getTilePayload",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t,i,r){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=N.Z.pool.acquire(t.id),a=this._layer.sourceNameToSource[i].getSourceTileUrl(n.level,n.row,n.col),N.Z.pool.release(n),e.prev=2,e.next=5,this.request(a,r);case 5:return e.t0=e.sent,e.t1=i,e.abrupt("return",{protobuff:e.t0,sourceName:e.t1});case 10:if(e.prev=10,e.t2=e["catch"](2),!(0,m.D_)(e.t2)){e.next=14;break}throw e.t2;case 14:return e.abrupt("return",{protobuff:null,sourceName:i});case 15:case"end":return e.stop()}}),e,this,[[2,10]])})));function t(t,i,r){return e.apply(this,arguments)}return t}()},{key:"request",value:function(e,t){return(0,C["default"])(e,(0,S.Z)({responseType:"array-buffer"},t)).then((function(e){var t=e.data;return t}))}},{key:"_getRefKeys",value:function(e,t){var i=this._layer.sourceNameToSource,r=new Array;for(var n in i){var a=i[n].getRefKey(e,t);r.push(a)}return(0,m.as)(r)}},{key:"_getSourcesData",value:function(e,t,i){for(var r=[],n=0;n<t.length;n++)if(null==t[n].value||null==e[n])r.push(null);else{var a=this._getTilePayload(t[n].value,e[n],i);r.push(a)}return(0,m.as)(r).then((function(e){for(var i={},r=[],n=0;n<e.length;n++)if(e[n].value&&e[n].value&&e[n].value.protobuff&&e[n].value.protobuff.byteLength>0){var a=t[n].value.id;i[e[n].value.sourceName]={refKey:a,protobuff:e[n].value.protobuff},r.push(e[n].value.protobuff)}return{sourceName2DataAndRefKey:i,transferList:r}}))}}]),e}(),G=i(26847),K=i(80427),Y=512,X=1e-6,$=function(e,t){return e+1/(1<<2*t)},ee=function(){function e(t,i){(0,l.Z)(this,e),this._tiles=new Map,this._tileCache=new G.Z(40,(function(e){return e.dispose()})),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this._container=i}return(0,o.Z)(e,[{key:"destroy",value:function(){var e,t=(0,a.Z)(this._tiles);try{for(t.s();!(e=t.n()).done;){var i=(0,n.Z)(e.value,2),r=(i[0],i[1]);r.dispose()}}catch(s){t.e(s)}finally{t.f()}this._tiles=null,this._tileCache.clear(),this._tileCache=null}},{key:"update",value:function(e){this._updateCacheSize(e);var t,i=this.tileInfoView,r=i.getTileCoverage(e.state,0,"smallest"),s=r.spans,l=r.lodInfo,o=l.level,u=this._tiles,h=new Set,c=new Set,y=(0,a.Z)(s);try{for(y.s();!(t=y.n()).done;)for(var d=t.value,f=d.row,v=d.colFrom,p=d.colTo,_=v;_<=p;_++){var g=N.Z.getId(o,f,l.normalizeCol(_),l.getWorldForColumn(_)),m=this._getOrAcquireTile(g);h.add(g),m.processed()?this._addToContainer(m):c.add(new N.Z(g))}}catch(U){y.e(U)}finally{y.f()}var b,w=(0,a.Z)(u);try{for(w.s();!(b=w.n()).done;){var x=(0,n.Z)(b.value,2),k=x[0],Z=x[1];Z.isCoverage=h.has(k)}}catch(U){w.e(U)}finally{w.f()}var S,C=(0,a.Z)(c);try{for(C.s();!(S=C.n()).done;){var I=S.value;this._findPlaceholdersForMissingTiles(I,h)}}catch(U){C.e(U)}finally{C.f()}var R,T=!1,P=(0,a.Z)(u);try{for(P.s();!(R=P.n()).done;){var D=(0,n.Z)(R.value,2),M=D[0],B=D[1];B.neededForCoverage=h.has(M),B.neededForCoverage||B.isHoldingForFade&&i.intersects(r,B.key)&&h.add(M),B.isFading&&(T=!0)}}catch(U){P.e(U)}finally{P.f()}var A,L=(0,a.Z)(this._tiles);try{for(L.s();!(A=L.n()).done;){var V=(0,n.Z)(A.value,2),O=V[0];V[1];h.has(O)||this._releaseTile(O)}}catch(U){L.e(U)}finally{L.f()}return K.Z.pool.release(r),!T}},{key:"clear",value:function(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}},{key:"clearCache",value:function(){this._tileCache.clear()}},{key:"_findPlaceholdersForMissingTiles",value:function(e,t){var i,r=[],s=(0,a.Z)(this._tiles);try{for(s.s();!(i=s.n()).done;){var l=(0,n.Z)(i.value,2),o=(l[0],l[1]);this._addPlaceholderChild(r,o,e,t)}}catch(h){s.e(h)}finally{s.f()}var u=r.reduce($,0);Math.abs(1-u)<X||this._addPlaceholderParent(e.id,t)}},{key:"_addPlaceholderChild",value:function(e,t,i,r){t.key.level<=i.level||!t.hasData()||ie(i,t.key)&&(this._addToContainer(t),r.add(t.id),e.push(t.key.level-i.level))}},{key:"_addPlaceholderParent",value:function(e,t){for(var i=this._tiles,r=e;;){if(r=te(r),!r||t.has(r))return;var n=i.get(r);if(n&&n.hasData())return this._addToContainer(n),void t.add(n.id)}}},{key:"_getOrAcquireTile",value:function(e){var t=this._tiles.get(e);return t||(t=this._tileCache.pop(e),t||(t=this.acquireTile(new N.Z(e))),this._tiles.set(e,t),t)}},{key:"_releaseTile",value:function(e){var t=this._tiles.get(e);this.releaseTile(t),this._removeFromContainer(t),this._tiles.delete(e),t.hasData()?this._tileCache.put(e,t,1):t.dispose()}},{key:"_addToContainer",value:function(e){var t,i=[],r=this._container;if(!r.contains(e)){var s,l=this._visibleTiles,o=(0,a.Z)(l);try{for(o.s();!(s=o.n()).done;){var u=(0,n.Z)(s.value,2),h=(u[0],u[1]);this._canConnectDirectly(e,h)&&i.push(h),(0,g.Wi)(t)&&this._canConnectDirectly(h,e)&&(t=h)}}catch(_){o.e(_)}finally{o.f()}if((0,g.pC)(t)){var c,y=(0,a.Z)(i);try{for(y.s();!(c=y.n()).done;){var d=c.value;t.childrenTiles.delete(d),e.childrenTiles.add(d),d.parentTile=e}}catch(_){y.e(_)}finally{y.f()}t.childrenTiles.add(e),e.parentTile=t}else{var f,v=(0,a.Z)(i);try{for(v.s();!(f=v.n()).done;){var p=f.value;e.childrenTiles.add(p),p.parentTile=e}}catch(_){v.e(_)}finally{v.f()}}l.set(e.id,e),r.addChild(e)}}},{key:"_removeFromContainer",value:function(e){if(this._visibleTiles.delete(e.id),this._container.removeChild(e),(0,g.pC)(e.parentTile)){e.parentTile.childrenTiles.delete(e);var t,i=(0,a.Z)(e.childrenTiles);try{for(i.s();!(t=i.n()).done;){var r=t.value;(0,g.pC)(e.parentTile)&&e.parentTile.childrenTiles.add(r)}}catch(o){i.e(o)}finally{i.f()}}var n,s=(0,a.Z)(e.childrenTiles);try{for(s.s();!(n=s.n()).done;){var l=n.value;l.parentTile=e.parentTile}}catch(o){s.e(o)}finally{s.f()}e.parentTile=null,e.childrenTiles.clear()}},{key:"_canConnectDirectly",value:function(e,t){for(var i=e.key,r=t.key,n=r.level,a=r.row,s=r.col,l=r.world,o=this._visibleTiles;n>0;){if(n--,a>>=1,s>>=1,i.level===n&&i.row===a&&i.col===s&&i.world===l)return!0;if(o.has("".concat(n,"/").concat(a,"/").concat(s,"/").concat(l)))return!1}return!1}},{key:"_updateCacheSize",value:function(e){var t=e.state.size;if(t[0]!==this._viewSize[0]||t[1]!==this._viewSize[1]){var i=Math.ceil(t[0]/Y)+1,r=Math.ceil(t[1]/Y)+1;this._viewSize[0]=t[0],this._viewSize[1]=t[1],this._tileCache.maxSize=5*i*r}}}]),e}();function te(e){var t=e.split("/"),i=(0,n.Z)(t,4),r=i[0],a=i[1],s=i[2],l=i[3],o=parseInt(r,10);return 0===o?null:"".concat(o-1,"/").concat(parseInt(a,10)>>1,"/").concat(parseInt(s,10)>>1,"/").concat(parseInt(l,10))}function ie(e,t){var i=t.level-e.level;return e.row===t.row>>i&&e.col===t.col>>i&&e.world===t.world}var re=i(68491),ne=i(33482),ae=(i(65125),i(44197),(0,o.Z)((function e(t){(0,l.Z)(this,e),this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}))),se=(0,o.Z)((function e(){(0,l.Z)(this,e),this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}));function le(e,t,i,r,n,a){var s=i-n;if(s>=0)return(t>>s)+(r-(a<<s))*(e>>s);var l=-s;return t-(a-(r<<l))*(e>>l)<<l}var oe=function(){function e(t,i,r){(0,l.Z)(this,e),this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(var n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(var a=0;a<this._columns;a++)this.cells[n][a]=[]}}return(0,o.Z)(e,[{key:"getCell",value:function(e,t){var i=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),r=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][r]||null}},{key:"getCellSpan",value:function(e,t,i,r){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1)]}},{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]),e}();function ue(e,t,i,r,n,a){for(var s=t[r++],l=0;l<s;l++){var o=new ae(a);o.xTile=t[r++],o.yTile=t[r++],o.hash=t[r++],o.priority=t[r++];for(var u=t[r++],h=0;h<u;h++){var c=t[r++],y=t[r++],d=t[r++],f=t[r++],v=!!t[r++],p=t[r++],_=i[r++],g=i[r++],m=t[r++],b=t[r++];o.colliders.push({xTile:c,yTile:y,dxPixels:d,dyPixels:f,hard:v,partIndex:p,width:m,height:b,minLod:_,maxLod:g})}for(var w=e[r++],x=0;x<w;x++)o.textVertexRanges.push([e[r++],e[r++]]);for(var k=e[r++],Z=0;Z<k;Z++)o.iconVertexRanges.push([e[r++],e[r++]]);n.push(o)}return r}function he(e,t,i){var r,s=(0,a.Z)(e.symbols);try{for(s.s();!(r=s.n()).done;){var l=(0,n.Z)(r.value,2),o=l[0],u=l[1];ce(e,t,i,u,o)}}catch(h){s.e(h)}finally{s.f()}}function ce(e,t,i,r,s){var l=e.layerData.get(s);if(3===l.type){var o,u=(0,a.Z)(r);try{for(u.s();!(o=u.n()).done;){var h=o.value,c=h.unique,y=void 0;if(h.selectedForRendering){var d=c.parts[0],f=d.startOpacity,v=d.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===v;var p=i?Math.floor(127*f)|v<<7:v?255:0;y=p<<24|p<<16|p<<8|p}else y=0;var _,g=(0,a.Z)(h.iconVertexRanges);try{for(g.s();!(_=g.n()).done;)for(var m=(0,n.Z)(_.value,2),b=m[0],w=m[1],x=b;x<b+w;x+=4)l.iconOpacity[x/4]=y}catch(B){g.e(B)}finally{g.f()}if(h.selectedForRendering){var k=c.parts[1],Z=k.startOpacity,S=k.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===S;var C=i?Math.floor(127*Z)|S<<7:S?255:0;y=C<<24|C<<16|C<<8|C}else y=0;var I,R=(0,a.Z)(h.textVertexRanges);try{for(R.s();!(I=R.n()).done;)for(var T=(0,n.Z)(I.value,2),P=T[0],D=T[1],M=P;M<P+D;M+=4)l.textOpacity[M/4]=y}catch(B){R.e(B)}finally{R.f()}}}catch(B){u.e(B)}finally{u.f()}l.lastOpacityUpdate=t,l.opacityChanged=!0}}var ye=function(){function e(t,i){(0,l.Z)(this,e),this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;var r=1,n=new Uint32Array(t);this.layerUIDs=[];for(var a=n[r++],s=0;s<a;s++)this.layerUIDs[s]=n[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}return(0,o.Z)(e,[{key:"isPreparedForRendering",get:function(){return(0,g.Wi)(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}},{key:"destroy",value:function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}},{key:"prepareForRendering",value:function(e){(0,g.Wi)(this.data)||(this.doPrepareForRendering(e,this.data,this.bufferDataOffset),this.data=null)}}]),e}(),de=function(e){(0,c.Z)(i,e);var t=(0,y.Z)(i);function i(e,r){var n;(0,l.Z)(this,i),n=t.call(this,e,r),n.type=2,n.lineIndexStart=0,n.lineIndexCount=0;var a=new Uint32Array(e),s=n.bufferDataOffset;n.lineIndexStart=a[s++],n.lineIndexCount=a[s++];var o=a[s++];if(o>0){for(var u=new Map,h=0;h<o;h++){var c=a[s++],y=a[s++],d=a[s++];u.set(c,[y,d])}n.patternMap=u}return n.bufferDataOffset=s,n}return(0,o.Z)(i,[{key:"hasData",value:function(){return this.lineIndexCount>0}},{key:"triangleCount",value:function(){return this.lineIndexCount/3}},{key:"doDestroy",value:function(){(0,g.pC)(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),(0,g.pC)(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),(0,g.pC)(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),n=new Int32Array(r.buffer),a=r[i++];this.lineVertexBuffer=P.Z.createVertex(e,35044,new Int32Array(n.buffer,4*i,a)),i+=a;var s=r[i++];this.lineIndexBuffer=P.Z.createIndex(e,35044,new Uint32Array(r.buffer,4*i,s)),i+=s;var l=this.layer.lineMaterial;this.lineVertexArrayObject=new M.Z(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}]),i}(ye),fe=function(e){(0,c.Z)(i,e);var t=(0,y.Z)(i);function i(e,r){var n;(0,l.Z)(this,i),n=t.call(this,e,r),n.type=1,n.fillIndexStart=0,n.fillIndexCount=0,n.outlineIndexStart=0,n.outlineIndexCount=0;var a=new Uint32Array(e),s=n.bufferDataOffset;n.fillIndexStart=a[s++],n.fillIndexCount=a[s++],n.outlineIndexStart=a[s++],n.outlineIndexCount=a[s++];var o=a[s++];if(o>0){for(var u=new Map,h=0;h<o;h++){var c=a[s++],y=a[s++],d=a[s++];u.set(c,[y,d])}n.patternMap=u}return n.bufferDataOffset=s,n}return(0,o.Z)(i,[{key:"hasData",value:function(){return this.fillIndexCount>0||this.outlineIndexCount>0}},{key:"triangleCount",value:function(){return(this.fillIndexCount+this.outlineIndexCount)/3}},{key:"doDestroy",value:function(){(0,g.pC)(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),(0,g.pC)(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),(0,g.pC)(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,(0,g.pC)(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),(0,g.pC)(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),(0,g.pC)(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),n=new Int32Array(r.buffer),a=r[i++];this.fillVertexBuffer=P.Z.createVertex(e,35044,new Int32Array(n.buffer,4*i,a)),i+=a;var s=r[i++];this.fillIndexBuffer=P.Z.createIndex(e,35044,new Uint32Array(r.buffer,4*i,s)),i+=s;var l=r[i++];this.outlineVertexBuffer=P.Z.createVertex(e,35044,new Int32Array(n.buffer,4*i,l)),i+=l;var o=r[i++];this.outlineIndexBuffer=P.Z.createIndex(e,35044,new Uint32Array(r.buffer,4*i,o)),i+=o;var u=this.layer,h=u.fillMaterial,c=u.outlineMaterial;this.fillVertexArrayObject=new M.Z(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new M.Z(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}]),i}(ye),ve=function(e){(0,c.Z)(i,e);var t=(0,y.Z)(i);function i(e,r,n){var a;(0,l.Z)(this,i),a=t.call(this,e,r),a.type=3,a.iconPerPageElementsMap=new Map,a.glyphPerPageElementsMap=new Map,a.symbolInstances=[],a.isIconSDF=!1,a.opacityChanged=!1,a.lastOpacityUpdate=0,a.symbols=[];var s=new Uint32Array(e),o=new Int32Array(e),u=new Float32Array(e),h=a.bufferDataOffset;a.isIconSDF=!!s[h++];for(var c=s[h++],y=0;y<c;y++){var d=s[h++],f=s[h++],v=s[h++];a.iconPerPageElementsMap.set(d,[f,v])}for(var p=s[h++],_=0;_<p;_++){var g=s[h++],m=s[h++],b=s[h++];a.glyphPerPageElementsMap.set(g,[m,b])}var w=s[h++],x=s[h++];return a.iconOpacity=new Int32Array(w),a.textOpacity=new Int32Array(x),h=ue(s,o,u,h,a.symbols,n),a.bufferDataOffset=h,a}return(0,o.Z)(i,[{key:"hasData",value:function(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}},{key:"triangleCount",value:function(){var e,t=0,i=(0,a.Z)(this.iconPerPageElementsMap);try{for(i.s();!(e=i.n()).done;){var r=(0,n.Z)(e.value,2),s=(r[0],r[1]);t+=s[1]}}catch(c){i.e(c)}finally{i.f()}var l,o=(0,a.Z)(this.glyphPerPageElementsMap);try{for(o.s();!(l=o.n()).done;){var u=(0,n.Z)(l.value,2),h=(u[0],u[1]);t+=h[1]}}catch(c){o.e(c)}finally{o.f()}return t/3}},{key:"doDestroy",value:function(){(0,g.pC)(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),(0,g.pC)(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),(0,g.pC)(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),(0,g.pC)(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,(0,g.pC)(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),(0,g.pC)(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),(0,g.pC)(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),(0,g.pC)(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}},{key:"updateOpacityInfo",value:function(){if(this.opacityChanged){this.opacityChanged=!1;var e=(0,g.Wg)(this.iconOpacity),t=(0,g.Wg)(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e);var i=(0,g.Wg)(this.textOpacity),r=(0,g.Wg)(this.textOpacityBuffer);i.length>0&&i.byteLength===r.size&&r.setSubData(i)}}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),n=new Int32Array(r.buffer),a=r[i++];this.iconVertexBuffer=P.Z.createVertex(e,35044,new Int32Array(n.buffer,4*i,a)),i+=a;var s=r[i++];this.iconIndexBuffer=P.Z.createIndex(e,35044,new Uint32Array(r.buffer,4*i,s)),i+=s;var l=r[i++];this.textVertexBuffer=P.Z.createVertex(e,35044,new Int32Array(n.buffer,4*i,l)),i+=l;var o=r[i++];this.textIndexBuffer=P.Z.createIndex(e,35044,new Uint32Array(r.buffer,4*i,o)),i+=o,this.iconOpacityBuffer=P.Z.createVertex(e,35044,(0,g.Wg)(this.iconOpacity).buffer),this.textOpacityBuffer=P.Z.createVertex(e,35044,(0,g.Wg)(this.textOpacity).buffer);var u=this.layer,h=u.iconMaterial,c=u.textMaterial;this.iconVertexArrayObject=new M.Z(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new M.Z(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}]),i}(ye),pe=function(e){(0,c.Z)(i,e);var t=(0,y.Z)(i);function i(e,r){var n;(0,l.Z)(this,i),n=t.call(this,e,r),n.type=4,n.circleIndexStart=0,n.circleIndexCount=0;var a=new Uint32Array(e),s=n.bufferDataOffset;return n.circleIndexStart=a[s++],n.circleIndexCount=a[s++],n.bufferDataOffset=s,n}return(0,o.Z)(i,[{key:"hasData",value:function(){return this.circleIndexCount>0}},{key:"triangleCount",value:function(){return this.circleIndexCount/3}},{key:"doDestroy",value:function(){(0,g.pC)(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),(0,g.pC)(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),(0,g.pC)(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),n=new Int32Array(r.buffer),a=r[i++];this.circleVertexBuffer=P.Z.createVertex(e,35044,new Int32Array(n.buffer,4*i,a)),i+=a;var s=r[i++];this.circleIndexBuffer=P.Z.createIndex(e,35044,new Uint32Array(r.buffer,4*i,s)),i+=s;var l=this.layer.circleMaterial;this.circleVertexArrayObject=new M.Z(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}]),i}(ye),_e=i(40941),ge=i(35819),me=function(e){(0,c.Z)(i,e);var t=(0,y.Z)(i);function i(e,r,n,a,s,o){var u,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return(0,l.Z)(this,i),u=t.call(this,e,r,n,a,s,4096,4096),u._memCache=h,u.type="vector-tile",u._referenced=0,u._hasSymbolBuckets=!1,u._memoryUsedByLayerData=0,u.layerData=new Map,u.layerCount=0,u.status="loading",u.allSymbolsFadingOut=!1,u.lastOpacityUpdate=0,u.symbols=new Map,u.isCoverage=!1,u.neededForCoverage=!1,u.decluttered=!1,u.invalidating=!1,u.parentTile=null,u.childrenTiles=new Set,u._processed=!1,u._referenced=1,u.styleRepository=o,u.id=e.id,u}return(0,o.Z)(i,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<_e.nN}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<_e.nN)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"setData",value:function(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}},{key:"deleteLayerData",value:function(e){var t,i=!1,r=(0,a.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this.layerData.has(n)){var s=this.layerData.get(n);this._memoryUsedByLayerData-=s.memoryUsed,3===s.type&&this.symbols.has(n)&&(this.symbols.delete(n),i=!0),s.destroy(),this.layerData.delete(n),this.layerCount--}}}catch(l){r.e(l)}finally{r.f()}(0,g.pC)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}},{key:"processed",value:function(){return this._processed}},{key:"hasData",value:function(){return this.layerCount>0}},{key:"dispose",value:function(){"unloaded"!==this.status&&(be.delete(this),i._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}},{key:"release",value:function(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}},{key:"retain",value:function(){++this._referenced}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}},{key:"changeDataImpl",value:function(e){var t=!1;if(e){var i,r=this._createRenderBuckets(e),s=(0,a.Z)(r);try{for(s.s();!(i=s.n()).done;){var l=(0,n.Z)(i.value,2),o=l[0],u=l[1];if(this.layerData.has(o)){var h=this.layerData.get(o);this._memoryUsedByLayerData-=u.memoryUsed,h.destroy(),this.layerData.delete(o),this.layerCount--}3===u.type&&(this.symbols.set(o,u.symbols),t=!0),this._memoryUsedByLayerData+=u.memoryUsed,this.layerData.set(o,u),this.layerCount++}}catch(v){s.e(v)}finally{s.f()}(0,g.pC)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;var c,y=(0,a.Z)(this.layerData);try{for(y.s();!(c=y.n()).done;){var d=(0,n.Z)(c.value,2),f=(d[0],d[1]);3===f.type&&(this._hasSymbolBuckets=!0)}}catch(v){y.e(v)}finally{y.f()}t&&this.emit("symbols-changed")}},{key:"attachWithContext",value:function(e){this.stage={context:e,trashDisplayObject:function(e){e.processDetach()},untrashDisplayObject:function(){return!1}}}},{key:"setTransform",value:function(e,t){(0,u.Z)((0,h.Z)(i.prototype),"setTransform",this).call(this,e,t);var r=t/(e.resolution*e.pixelRatio),n=this.width/this.rangeX*r,a=this.height/this.rangeY*r,s=[0,0];e.toScreen(s,[this.x,this.y]);var l=this.transforms.tileUnitsToPixels;(0,re.b)(l),(0,re.c)(l,l,s),(0,re.r)(l,l,Math.PI*e.rotation/180),(0,re.d)(l,l,[n,a,1])}},{key:"_createTransforms",value:function(){return{dvs:(0,ne.c)(),tileMat3:(0,ne.c)(),tileUnitsToPixels:(0,ne.c)()}}},{key:"_createRenderBuckets",value:function(e){var t,i=new Map,r=new Map,n=(0,a.Z)(e);try{for(n.s();!(t=n.n()).done;){var s,l=t.value,o=this._deserializeBucket(l,r),u=(0,a.Z)(o.layerUIDs);try{for(u.s();!(s=u.n()).done;){var h=s.value;i.set(h,o)}}catch(c){u.e(c)}finally{u.f()}}}catch(c){n.e(c)}finally{n.f()}return i}},{key:"_deserializeBucket",value:function(e,t){var i=t.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case 1:i=new fe(e,this.styleRepository);break;case 2:i=new de(e,this.styleRepository);break;case 3:i=new ve(e,this.styleRepository,this);break;case 4:i=new pe(e,this.styleRepository)}return t.set(e,i),i}}],[{key:"_destroyRenderBuckets",value:function(e){if(e){var t=new Set;e.forEach((function(e){t.has(e)||(e.destroy(),t.add(e))})),e.clear()}}}]),i}(ge.I),be=new Map;var we=i(78534);function xe(e,t,i,r,s,l){var o,u=r.iconRotationAlignment,h=r.textRotationAlignment,c=r.iconTranslate,y=r.iconTranslateAnchor,d=r.textTranslate,f=r.textTranslateAnchor,v=0,p=(0,a.Z)(e.colliders);try{for(p.s();!(o=p.n()).done;){var _=o.value,g=0===_.partIndex?c:d,m=(0,n.Z)(g,2),b=m[0],w=m[1],x=0===_.partIndex?y:f,k=_.minLod<=l&&l<=_.maxLod;v+=k?0:1,_.enabled=k,_.xScreen=_.xTile*s[0]+_.yTile*s[3]+s[6],_.yScreen=_.xTile*s[1]+_.yTile*s[4]+s[7],0===x?(_.xScreen+=i*b-t*w,_.yScreen+=t*b+i*w):(_.xScreen+=b,_.yScreen+=w),1===(0===_.partIndex?u:h)?(_.dxScreen=_.dxPixels,_.dyScreen=_.dyPixels):(_.dxScreen=i*(_.dxPixels+_.width/2)-t*(_.dyPixels+_.height/2)-_.width/2,_.dyScreen=t*(_.dxPixels+_.width/2)+i*(_.dyPixels+_.height/2)-_.height/2)}}catch(Z){p.e(Z)}finally{p.f()}e.colliders.length>0&&v===e.colliders.length&&(e.unique.show=!1)}var ke=function(){function e(t,i,r,n,s,o){(0,l.Z)(this,e),this._symbols=t,this._styleRepository=n,this._zoom=s,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new oe(i,r,_e.PF),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);var u,h=(0,a.Z)(t);try{for(h.s();!(u=h.n()).done;){var c,y=u.value,d=(0,a.Z)(y.symbols);try{for(d.s();!(c=d.n()).done;){var f=c.value;this._allNeededMatrices.has(f.tile)||this._allNeededMatrices.set(f.tile,(0,ne.a)(f.tile.transforms.tileUnitsToPixels))}}catch(v){d.e(v)}finally{d.f()}}}catch(v){h.e(v)}finally{h.f()}}return(0,o.Z)(e,[{key:"work",value:function(e){var t=this._gridIndex;function i(e){for(var i=e.xScreen+e.dxScreen,r=e.yScreen+e.dyScreen,s=i+e.width,l=r+e.height,o=t.getCellSpan(i,r,s,l),u=(0,n.Z)(o,4),h=u[0],c=u[1],y=u[2],d=u[3],f=c;f<=d;f++)for(var v=h;v<=y;v++){var p,_=t.cells[f][v],g=(0,a.Z)(_);try{for(g.s();!(p=g.n()).done;){var m=p.value,b=m.xScreen+m.dxScreen,w=m.yScreen+m.dyScreen,x=b+m.width,k=w+m.height;if(!(s<b||i>x||l<w||r>k))return!0}}catch(Z){g.e(Z)}finally{g.f()}}return!1}for(var r=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0)for(var s=this._symbols[this._currentLayerCursor],l=this._getProperties(s.styleLayerUID);this._currentSymbolCursor<s.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-r>e)return!1;var o=s.symbols[this._currentSymbolCursor];if(o.unique.show){xe(o,this._si,this._co,l,this._allNeededMatrices.get(o.tile),this._zoom);var u=o.unique;if(u.show){var h,c=l.iconAllowOverlap,y=l.iconIgnorePlacement,d=l.textAllowOverlap,f=l.textIgnorePlacement,v=(0,a.Z)(o.colliders);try{for(v.s();!(h=v.n()).done;){var p=h.value;if(p.enabled){var _=u.parts[p.partIndex];_.show&&!(p.partIndex?d:c)&&i(p)&&(p.hard?u.show=!1:_.show=!1)}}}catch(B){v.e(B)}finally{v.f()}if(u.show){var g,m=(0,a.Z)(o.colliders);try{for(m.s();!(g=m.n()).done;){var b=g.value;if(b.enabled&&(!(b.partIndex?f:y)&&u.parts[b.partIndex].show))for(var w=b.xScreen+b.dxScreen,x=b.yScreen+b.dyScreen,k=w+b.width,Z=x+b.height,S=this._gridIndex.getCellSpan(w,x,k,Z),C=(0,n.Z)(S,4),I=C[0],R=C[1],T=C[2],P=C[3],D=R;D<=P;D++)for(var M=I;M<=T;M++)this._gridIndex.cells[D][M].push(b)}}catch(B){m.e(B)}finally{m.f()}}}}}return!0}},{key:"_getProperties",value:function(e){var t=this._styleProps.get(e);if(t)return t;var i=this._zoom,r=this._styleRepository.getStyleLayerByUID(e),n=0!==r.getLayoutValue("symbol-placement",i),a=r.getLayoutValue("icon-rotation-alignment",i);2===a&&(a=n?0:1);var s=r.getLayoutValue("text-rotation-alignment",i);2===s&&(s=n?0:1);var l=r.getPaintValue("icon-translate",i),o=r.getPaintValue("icon-translate-anchor",i),u=r.getPaintValue("text-translate",i),h=r.getPaintValue("text-translate-anchor",i),c={iconAllowOverlap:r.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:r.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:r.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:r.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:a,textRotationAlignment:s,iconTranslateAnchor:o,iconTranslate:l,textTranslateAnchor:h,textTranslate:u};return this._styleProps.set(e,c),c}}]),e}();function Ze(e,t){if(e.priority-t.priority)return e.priority-t.priority;var i=e.tile.key,r=t.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}var Se=function(){function e(t,i,r,n,a,s){(0,l.Z)(this,e),this._visibleTiles=t,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=n,this._symbolLayerSorter=a,this._isLayerVisible=s,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}return(0,o.Z)(e,[{key:"running",get:function(){return this._running}},{key:"setScreenSize",value:function(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}},{key:"restart",value:function(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}},{key:"continue",value:function(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){var t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){var i=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-i))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){var r=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-r))))return!1}return this._running=!1,!0}},{key:"_createSelectionJob",value:function(){for(var e=this._symbolRepository.uniqueSymbols,t=0;t<e.length;t++)for(var i=e[t],r=0;r<i.uniqueSymbols.length;r++){var n,s=i.uniqueSymbols[r],l=(0,a.Z)(s.tileSymbols);try{for(l.s();!(n=l.n()).done;){var o=n.value;o.selectedForRendering=!1}}catch(v){l.e(v)}finally{l.f()}}var u=[],h=0,c=0,y=this._isLayerVisible;function d(t){for(var i,r=performance.now();c<e.length;c++,h=0){var n=e[c],s=n.styleLayerUID;if(y(s)){u[c]=u[c]||{styleLayerUID:s,symbols:[]};for(var l=u[c];h<n.uniqueSymbols.length;h++){if(i=n.uniqueSymbols[h],h%100==99&&performance.now()-r>t)return!1;var o,d=null,f=!1,p=!1,_=(0,a.Z)(i.tileSymbols);try{for(_.s();!(o=_.n()).done;){var g=o.value;if(!p||!f){var m=g.tile;(!d||m.isCoverage||m.neededForCoverage&&!f)&&(d=g,(m.neededForCoverage||m.isCoverage)&&(p=!0),m.isCoverage&&(f=!0))}}}catch(v){_.e(v)}finally{_.f()}if(d.selectedForRendering=!0,p){l.symbols.push(d),i.show=!0;var b,w=(0,a.Z)(i.parts);try{for(w.s();!(b=w.n()).done;){var x=b.value;x.show=!0}}catch(v){w.e(v)}finally{w.f()}}else i.show=!1}}else u[c]||(u[c]={styleLayerUID:s,symbols:[]})}var k,Z=(0,a.Z)(u);try{for(Z.s();!(k=Z.n()).done;){var S=k.value;S.symbols.sort(Ze)}}catch(v){Z.e(v)}finally{Z.f()}return!0}var f=this._symbolLayerSorter;return{work:d,get sortedSymbols(){return u.sort(f)}}}},{key:"_createOpacityJob",value:function(){var e=this._assignTileSymbolsOpacity,t=this._visibleTiles,i=0;function r(t,i){var s,l=t.symbols,o=(0,a.Z)(l);try{for(o.s();!(s=o.n()).done;){var u=(0,n.Z)(s.value,2),h=(u[0],u[1]);Ce(h,i)}}catch(f){o.e(f)}finally{o.f()}e(t,i);var c,y=(0,a.Z)(t.childrenTiles);try{for(y.s();!(c=y.n()).done;){var d=c.value;r(d,i)}}catch(f){y.e(f)}finally{y.f()}}return{work:function(e){for(var n=performance.now();i<t.length;i++){if(performance.now()-n>e)return!1;var a=t[i];(0,g.pC)(a.parentTile)||r(a,performance.now())}return!0}}}}]),e}();function Ce(e,t){var i,r=(0,a.Z)(e);try{for(r.s();!(i=r.n()).done;){var n,s=i.value,l=s.unique,o=(0,a.Z)(l.parts);try{for(o.s();!(n=o.n()).done;){var u=n.value,h=u.targetOpacity>.5?1:-1;u.startOpacity+=h*((t-u.startTime)/_e.nN),u.startOpacity=Math.min(Math.max(u.startOpacity,0),1),u.startTime=t,u.targetOpacity=l.show&&u.show?1:0}}catch(c){o.e(c)}finally{o.f()}}}catch(c){r.e(c)}finally{r.f()}}i(84944),i(33792);var Ie=32,Re=8,Te=64,Pe=function(){function e(t,i,r){(0,l.Z)(this,e),this.tileCoordRange=t,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}return(0,o.Z)(e,[{key:"uniqueSymbols",get:function(){return(0,g.Wi)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}},{key:"add",value:function(e,t){this._uniqueSymbolLayerArray=null;var i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));var r=new Map;if(t){var s,l=(0,a.Z)(t);try{for(l.s();!(s=l.n()).done;){var o=s.value;i.symbols.has(o)&&(r.set(o,i.symbols.get(o)),i.symbols.delete(o))}}catch(C){l.e(C)}finally{l.f()}}else{var u,h=(0,a.Z)(e.layerData);try{for(h.s();!(u=h.n()).done;){var c=(0,n.Z)(u.value,2),y=c[0];c[1];i.symbols.has(y)&&(r.set(y,i.symbols.get(y)),i.symbols.delete(y))}}catch(C){h.e(C)}finally{h.f()}}this._removeSymbols(r);var d,f=e.symbols,v=new Map,p=(0,a.Z)(f);try{for(p.s();!(d=p.n()).done;){var _=(0,n.Z)(d.value,2),g=_[0],m=_[1],b=m.length;if(b>=Ie){var w=this.tileCoordRange;do{w/=2,b/=4}while(b>Re&&w>Te);var x=new oe(this.tileCoordRange,this.tileCoordRange,w);v.set(g,{flat:m,index:x}),i.symbols.set(g,{flat:m,index:x});var k,Z=(0,a.Z)(m);try{for(Z.s();!(k=Z.n()).done;){var S=k.value;x.getCell(S.xTile,S.yTile).push(S)}}catch(C){Z.e(C)}finally{Z.f()}}else v.set(g,{flat:m}),i.symbols.set(g,{flat:m})}}catch(C){p.e(C)}finally{p.f()}this._addSymbols(e.key,f)}},{key:"deleteStyleLayers",value:function(e){this._uniqueSymbolLayerArray=null;var t,i=(0,a.Z)(this._tiles);try{for(i.s();!(t=i.n()).done;){var r,s=(0,n.Z)(t.value,2),l=s[0],o=s[1],u=new Map,h=(0,a.Z)(e);try{for(h.s();!(r=h.n()).done;){var c=r.value;o.symbols.has(c)&&(u.set(c,o.symbols.get(c)),o.symbols.delete(c))}}catch(y){h.e(y)}finally{h.f()}this._removeSymbols(u),0===o.symbols.size&&this._tiles.delete(l)}}catch(y){i.e(y)}finally{i.f()}}},{key:"removeTile",value:function(e){this._uniqueSymbolLayerArray=null;var t=this._tiles.get(e.id);if(t){var i,r=new Map,s=(0,a.Z)(e.symbols);try{for(s.s();!(i=s.n()).done;){var l=(0,n.Z)(i.value,2),o=l[0];l[1];t.symbols.has(o)&&(r.set(o,t.symbols.get(o)),t.symbols.delete(o))}}catch(u){s.e(u)}finally{s.f()}this._removeSymbols(r),0===t.symbols.size&&this._tiles.delete(e.id)}}},{key:"_removeSymbols",value:function(e){var t,i=(0,a.Z)(e);try{for(i.s();!(t=i.n()).done;){var r,s=(0,n.Z)(t.value,2),l=s[0],o=s[1].flat,u=(0,a.Z)(o);try{for(u.s();!(r=u.n()).done;){for(var h=r.value,c=h.unique,y=c.tileSymbols,d=y.length-1,f=0;f<d;f++)if(y[f]===h){y[f]=y[d];break}if(y.length=d,0===d){var v=this._uniqueSymbolsReferences.get(l);v.delete(c),0===v.size&&this._uniqueSymbolsReferences.delete(l)}h.unique=null}}catch(p){u.e(p)}finally{u.f()}}}catch(p){i.e(p)}finally{i.f()}}},{key:"_addSymbols",value:function(e,t){if(0!==t.size){var i,r=this._visibleTiles,s=(0,a.Z)(r);try{for(s.s();!(i=s.n()).done;){var l=i.value;l.parentTile||l.key.world!==e.world||l.key.level===e.level&&!l.key.equals(e)||this._matchSymbols(l,e,t)}}catch(m){s.e(m)}finally{s.f()}var o,u=(0,a.Z)(t);try{for(u.s();!(o=u.n()).done;){var h,c=(0,n.Z)(o.value,2),y=c[0],d=c[1],f=(0,a.Z)(d);try{for(f.s();!(h=f.n()).done;){var v=h.value;if((0,g.Wi)(v.unique)){var p=this._createUnique();v.unique=p,p.tileSymbols.push(v);var _=this._uniqueSymbolsReferences.get(y);_||(_=new Set,this._uniqueSymbolsReferences.set(y,_)),_.add(p)}}}catch(m){f.e(m)}finally{f.f()}}}catch(m){u.e(m)}finally{u.f()}}}},{key:"_matchSymbols",value:function(e,t,i){if(e.key.level>t.level){var r=e.key.level-t.level;if(e.key.row>>r!==t.row||e.key.col>>r!==t.col)return}if(t.level>e.key.level){var s=t.level-e.key.level;if(t.row>>s!==e.key.row||t.col>>s!==e.key.col)return}if(t.equals(e.key)){var l,o=(0,a.Z)(e.childrenTiles);try{for(o.s();!(l=o.n()).done;){var u=l.value;this._matchSymbols(u,t,i)}}catch(j){o.e(j)}finally{o.f()}}else{var h,c=new Map,y=(0,a.Z)(i);try{for(y.s();!(h=y.n()).done;){var d,f=(0,n.Z)(h.value,2),v=f[0],p=f[1],_=[],m=(0,a.Z)(p);try{for(m.s();!(d=m.n()).done;){var b=d.value,w=le(this.tileCoordRange,b.xTile,t.level,t.col,e.key.level,e.key.col),x=le(this.tileCoordRange,b.yTile,t.level,t.row,e.key.level,e.key.row);w>=0&&w<this.tileCoordRange&&x>=0&&x<this.tileCoordRange&&_.push({symbol:b,xTransformed:w,yTransformed:x})}}catch(j){m.e(j)}finally{m.f()}var k=[],Z=e.key.level<t.level?1:1<<e.key.level-t.level,S=this._tiles.get(e.id).symbols.get(v);if(S){var C,I=S.flat,R=(0,a.Z)(_);try{for(R.s();!(C=R.n()).done;){var T=C.value,P=void 0,D=!1,M=T.xTransformed,B=T.yTransformed;P=(0,g.pC)(S.index)?S.index.getCell(M,B):I;var A,L=T.symbol,V=L.hash,O=(0,a.Z)(P);try{for(O.s();!(A=O.n()).done;){var U=A.value;if(V===U.hash&&Math.abs(M-U.xTile)<=Z&&Math.abs(B-U.yTile)<=Z){var q=U.unique;L.unique=q,q.tileSymbols.push(L),D=!0;break}}}catch(j){O.e(j)}finally{O.f()}D||k.push(L)}}catch(j){R.e(j)}finally{R.f()}}k.length>0&&c.set(v,k)}}catch(j){y.e(j)}finally{y.f()}var z,H=(0,a.Z)(e.childrenTiles);try{for(H.s();!(z=H.n()).done;){var F=z.value;this._matchSymbols(F,t,c)}}catch(j){H.e(j)}finally{H.f()}}}},{key:"_createUniqueSymbolLayerArray",value:function(){var e,t,i=this._uniqueSymbolsReferences,r=new Array(i.size),s=0,l=(0,a.Z)(i);try{for(l.s();!(t=l.n()).done;){var o=(0,n.Z)(t.value,2),u=o[0],h=o[1],c=new Array(h.size);e=0;var y,d=(0,a.Z)(h);try{for(d.s();!(y=d.n()).done;){var f=y.value;c[e++]=f}}catch(v){d.e(v)}finally{d.f()}r[s]={styleLayerUID:u,uniqueSymbols:c},s++}}catch(v){l.e(v)}finally{l.f()}return r}}]),e}(),De=.5,Me=1e-6,Be=function(e){(0,c.Z)(i,e);var t=(0,y.Z)(i);function i(e,r){var n;return(0,l.Z)(this,i),n=t.call(this),n.styleRepository=e,n._tileToHandle=new Map,n._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},n._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},n._completed=!1,n._symbolRepository=new Pe(4096,r,(function(){return new se})),n._symbolDeclutterer=new Se(r,n._symbolRepository,(function(e,t,i){return new ke(e,t,i,n.styleRepository,n._zoom,n._viewState.rotation)}),(function(e,t){e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=t,he(e,t,!0),e.decluttered=!0,e.requestRender()}),(function(e,t){return n.styleRepository.getStyleLayerByUID(e.styleLayerUID).z-n.styleRepository.getStyleLayerByUID(t.styleLayerUID).z}),(function(e){var t=n.styleRepository.getStyleLayerByUID(e);if(n._zoom+Me<t.minzoom||n._zoom-Me>=t.maxzoom)return!1;var i=t.getLayoutProperty("visibility");return!i||1!==i.getValue()})),n}return(0,o.Z)(i,[{key:"addTile",value:function(e){var t=this;e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",(function(){t._symbolRepository.add(e),t.restartDeclutter()}))),this._symbolRepository.add(e),this.restartDeclutter()}},{key:"removeTile",value:function(e){var t=this._tileToHandle.get(e);t&&(this._symbolRepository.removeTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}},{key:"update",value:function(e,t){return this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]},this._continueDeclutter(),this._completed}},{key:"restartDeclutter",value:function(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}},{key:"clear",value:function(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach((function(e){return e.remove()})),this._tileToHandle.clear()}},{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}},{key:"deleteStyleLayers",value:function(e){this._symbolRepository.deleteStyleLayers(e)}},{key:"_continueDeclutter",value:function(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(_e.Ts),this._completed&&this._scheduleNotifyStable())}},{key:"_scheduleNotifyStable",value:function(){var e=this;(0,g.pC)(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout((function(){e._stableNotificationHandle=null,e.emit("fade-complete")}),(1+De)*_e.nN)}},{key:"_notifyUnstable",value:function(){(0,g.pC)(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this.emit("fade-start")}}]),i}(we.Z),Ae=i(49026),Le=function(e){(0,c.Z)(i,e);var t=(0,y.Z)(i);function i(){return(0,l.Z)(this,i),t.apply(this,arguments)}return(0,o.Z)(i,[{key:"_createTransforms",value:function(){return{dvs:(0,ne.c)(),tileMat3:(0,ne.c)()}}}]),i}(ge.I),Ve=i(28082),Oe=1e-6;function Ue(e,t){if(e){var i=e.getLayoutProperty("visibility");if(!i||1!==i.getValue()&&(void 0===e.minzoom||e.minzoom<t+Oe)&&(void 0===e.maxzoom||e.maxzoom>=t-Oe))return!0}return!1}var qe=function(e){(0,c.Z)(i,e);var t=(0,y.Z)(i);function i(e){var r;return(0,l.Z)(this,i),r=t.call(this,e),r._backgroundTiles=[],r._pointToCallbacks=new Map,r}return(0,o.Z)(i,[{key:"destroy",value:function(){this.removeAllChildren(),this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null),(0,g.pC)(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[],this._pointToCallbacks.clear()}},{key:"setStyleResources",value:function(e,t,i){var r=this;if(this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=i,(0,g.Wi)(this._symbolFader)){var n=new Be(this._styleRepository,this.children);n.on("fade-start",(function(){r.emit("fade-start"),r.requestRender()})),n.on("fade-complete",(function(){r.emit("fade-complete"),r.requestRender()})),this._symbolFader=n}(0,g.Wg)(this._symbolFader).styleRepository=i}},{key:"deleteStyleLayers",value:function(e){(0,g.pC)(this._symbolFader)&&this._symbolFader.deleteStyleLayers(e)}},{key:"hitTest",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=(0,m.hh)(),e.abrupt("return",(this._pointToCallbacks.set(t,i),this.requestRender(),i.promise));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"enterTileInvalidation",value:function(){var e,t=(0,a.Z)(this.children);try{for(t.s();!(e=t.n()).done;){var i=e.value;i.invalidating=!0}}catch(r){t.e(r)}finally{t.f()}}},{key:"createRenderParams",value:function(e){return(0,S.Z)((0,S.Z)({},(0,u.Z)((0,h.Z)(i.prototype),"createRenderParams",this).call(this,e)),{},{renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos})}},{key:"doRender",value:function(e){!this.visible||e.drawPhase!==Ae.jx.MAP&&e.drawPhase!==Ae.jx.DEBUG||void 0===this._spriteMosaic||(0,u.Z)((0,h.Z)(i.prototype),"doRender",this).call(this,e)}},{key:"addChild",value:function(e){return(0,u.Z)((0,h.Z)(i.prototype),"addChild",this).call(this,e),(0,g.pC)(this._symbolFader)?this._symbolFader.addTile(e):e.decluttered=!0,this.requestRender(),e}},{key:"removeChild",value:function(e){return(0,g.pC)(this._symbolFader)&&this._symbolFader.removeTile(e),this.requestRender(),(0,u.Z)((0,h.Z)(i.prototype),"removeChild",this).call(this,e)}},{key:"renderChildren",value:function(e){var t=e.drawPhase;if(t!==Ae.jx.DEBUG){if(this._doRender(e),this._pointToCallbacks.size>0){e.drawPhase=Ae.jx.HITTEST;var r=e.painter.effects.hittest;r.bind(e),this._doRender(e),r.draw(e,this._pointToCallbacks),r.unbind(e),e.drawPhase=t}}else(0,u.Z)((0,h.Z)(i.prototype),"renderChildren",this).call(this,e)}},{key:"removeAllChildren",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];(0,g.pC)(this._symbolFader)&&this._symbolFader.removeTile(t),t.dispose()}(0,u.Z)((0,h.Z)(i.prototype),"removeAllChildren",this).call(this)}},{key:"getStencilTarget",value:function(){return this.children.filter((function(e){return e.neededForCoverage&&e.hasData()}))}},{key:"restartDeclutter",value:function(){(0,g.pC)(this._symbolFader)&&this._symbolFader.restartDeclutter()}},{key:"_doRender",value:function(e){var t=e.context,r=this._styleRepository;if(r){var n=r.layers,s=!0;e.drawPhase===Ae.jx.HITTEST&&(s=!1),r.backgroundBucketIds.length>0&&(e.renderPass="background",this._renderBackgroundLayers(e,r.backgroundBucketIds)),(0,u.Z)((0,h.Z)(i.prototype),"renderChildren",this).call(this,e),e.drawPhase===Ae.jx.MAP&&this._fade(e.displayLevel,e.state);var l=this.children.filter((function(e){return e.visible&&e.hasData()}));if(!l||0===l.length)return t.bindVAO(),t.setStencilTestEnabled(!0),void t.setBlendingEnabled(!0);var o,c=(0,a.Z)(l);try{for(c.s();!(o=c.n()).done;){var y=o.value;y.triangleCount=0}}catch(p){c.e(p)}finally{c.f()}t.setStencilWriteMask(0),t.setColorMask(!0,!0,!0,!0),t.setStencilOp(7680,7680,7681),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setDepthTestEnabled(!0),t.setDepthWriteEnabled(!0),t.setDepthFunction(515),t.setClearDepth(1),t.clear(t.gl.DEPTH_BUFFER_BIT),e.renderPass="opaque";for(var d=n.length-1;d>=0;d--)this._renderStyleLayer(n[d],e,l);t.setDepthWriteEnabled(!1),t.setBlendingEnabled(s),t.setBlendFunctionSeparate(1,771,1,771),e.renderPass="translucent";for(var f=0;f<n.length;f++)this._renderStyleLayer(n[f],e,l);t.setDepthTestEnabled(!1),e.renderPass="symbol";for(var v=0;v<n.length;v++)this._renderStyleLayer(n[v],e,l);t.bindVAO(),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!0)}}},{key:"_fade",value:function(e,t){(0,g.pC)(this._symbolFader)&&(this._symbolFader.update(e,t)||this.requestRender())}},{key:"_renderStyleLayer",value:function(e,t,i){var r=t.painter,n=t.renderPass;if(void 0!==e){var s=e.getLayoutProperty("visibility");if(!s||1!==s.getValue()){var l;switch(e.type){case 0:return;case 1:if("opaque"!==n&&"translucent"!==t.renderPass)return;l="vtlFill";break;case 2:if("translucent"!==n)return;l="vtlLine";break;case 4:if("symbol"!==n)return;l="vtlCircle";break;case 3:if("symbol"!==n)return;l="vtlSymbol"}if(i=3===e.type?i.filter((function(e){return e.decluttered})):i.filter((function(e){return e.neededForCoverage})),"vtlSymbol"!==l){var o=t.displayLevel;if(0===i.length||void 0!==e.minzoom&&e.minzoom>=o+Oe||void 0!==e.maxzoom&&e.maxzoom<o-Oe)return}var u=e.uid;t.styleLayerUID=u,t.styleLayer=e;var h,c=(0,a.Z)(i);try{for(c.s();!(h=c.n()).done;){var y=h.value;if(y.layerData.has(u)){r.renderObjects(t,i,l);break}}}catch(d){c.e(d)}finally{c.f()}}}}},{key:"_renderBackgroundLayers",value:function(e,t){var i,r=e.context,n=e.displayLevel,s=e.painter,l=e.state,o=this._styleRepository,u=!1,h=(0,a.Z)(t);try{for(h.s();!(i=h.n()).done;){var c=i.value;if(0===o.getLayerById(c).type&&Ue(o.getLayerById(c),n)){u=!0;break}}}catch(U){h.e(U)}finally{h.f()}if(u){var y=this._tileInfoView.getTileCoverage(e.state,0,"smallest"),d=y.spans,f=y.lodInfo,v=f.level,p=(0,Z.Ue)(),_=[];if(this._renderPasses){var m=this._renderPasses[0];(0,g.pC)(this._clippingInfos)&&(m.brushes[0].prepareState(e,this._clippingInfos[0]),m.brushes[0].drawMany(e,this._clippingInfos))}var b,w,x=this._backgroundTiles,k=0,S=(0,a.Z)(d);try{for(S.s();!(w=S.n()).done;)for(var C=w.value,I=C.row,R=C.colFrom,T=C.colTo,P=R;P<=T;P++){if(k<x.length)b=x[k],b.key.set(v,I,f.normalizeCol(P),f.getWorldForColumn(P)),this._tileInfoView.getTileBounds(p,b.key,!1),b.x=p[0],b.y=p[3];else{var D=new N.Z(v,I,f.normalizeCol(P),f.getWorldForColumn(P)),M=this._tileInfoView.getTileBounds((0,Z.Ue)(),D);b=new Le(D,M[0],M[3],512,512,4096,4096),x.push(b)}b.setTransform(l,this._tileInfoView.getTileResolution(b.key)),_.push(b),k++}}catch(U){S.e(U)}finally{S.f()}r.setStencilWriteMask(0),r.setColorMask(!0,!0,!0,!0),r.setStencilOp(7680,7680,7681),r.setStencilFunction(514,0,255);var B=!0;e.drawPhase===Ae.jx.HITTEST&&(B=!1),r.setStencilTestEnabled(B);var A,L=(0,a.Z)(t);try{for(L.s();!(A=L.n()).done;){var V=A.value,O=o.getLayerById(V);0===O.type&&Ue(O,n)&&(e.styleLayerUID=O.uid,e.styleLayer=O,s.renderObjects(e,_,"vtlBackground"))}}catch(U){L.e(U)}finally{L.f()}K.Z.pool.release(y)}}}]),i}(Ve.Z),ze=i(91633),He=i(21211),Fe=i(43263),je=i(89748),Ee=i(26797),We=function(e){(0,c.Z)(i,e);var t=(0,y.Z)(i);function i(e){var r;return(0,l.Z)(this,i),r=t.call(this),r.requestRender=r.requestRender.bind((0,Fe.Z)(r)),r._layerView=e,r._canvas=document.createElement("canvas"),r._context=r._canvas.getContext("2d"),r._bitmap=new je.eY(null,"standard",!1),r.addChild(r._bitmap),r}return(0,o.Z)(i,[{key:"doRender",value:function(e){var t=e.state,r=this._createCustomRenderParams(e),n=this._canvas,a=this._bitmap,s=window.devicePixelRatio;n.width=t.size[0]*s,n.height=t.size[1]*s,a.resolution=t.resolution;var l=t.clone();l.pixelRatio=s,a.pixelRatio=s,r.state=l,a.x=t.viewpoint.targetGeometry.x-Math.abs(t.extent.xmax-t.extent.xmin)/2,a.y=t.viewpoint.targetGeometry.y+Math.abs(t.extent.ymax-t.extent.ymin)/2,this._layerView.render(r),a.source=n,a.rotation=t.rotation,(0,u.Z)((0,h.Z)(i.prototype),"doRender",this).call(this,(0,S.Z)((0,S.Z)({},e),{},{state:l}))}},{key:"_createCustomRenderParams",value:function(e){return{globalOpacity:e.globalOpacity,state:e.state,stationary:e.stationary,pixelRatio:window.devicePixelRatio,context:this._context}}}]),i}(Ee.c),Qe=i(96090),Ne=i(7014),Je=function(e){(0,c.Z)(i,e);var t=(0,y.Z)(i);function i(){var e;return(0,l.Z)(this,i),e=t.apply(this,arguments),e._fullCacheLodInfos=null,e._levelByScale={},e}return(0,o.Z)(i,[{key:"getTileParentId",value:function(e){var t=N.Z.pool.acquire(e),i=0===t.level?null:N.Z.getId(t.level-1,t.row>>1,t.col>>1,t.world);return N.Z.pool.release(t),i}},{key:"getTileCoverage",value:function(e,t,r){var n=(0,u.Z)((0,h.Z)(i.prototype),"getTileCoverage",this).call(this,e,t,r);if(!n)return n;var a=1<<n.lodInfo.level;return n.spans=n.spans.filter((function(e){return e.row>=0&&e.row<a})),n}},{key:"scaleToLevel",value:function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t,i,r=this._fullCacheLodInfos;if(e>r[0].scale)return r[0].level;for(var n=0;n<r.length-1;n++)if(i=r[n+1],e>i.scale)return t=r[n],t.level+(t.scale-e)/(t.scale-i.scale);return r[r.length-1].level}},{key:"_initializeFullCacheLODs",value:function(e){var t;if(0===e[0].level)t=e.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}));else{var i=this.tileInfo.size[0],r=this.tileInfo.spatialReference;t=Qe.Z.create({size:i,spatialReference:r}).lods.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}))}for(var n=0;n<t.length;n++)this._levelByScale[t[n].scale]=t[n].level;this._fullCacheLodInfos=t}}]),i}(Ne.Z),Ge=i(75046),Ke=i(74139),Ye=_.Z.getLogger("esri.views.2d.layers.VectorTileLayerView2D"),Xe=function(e){(0,c.Z)(i,e);var t=(0,y.Z)(i);function i(){var e;return(0,l.Z)(this,i),e=t.apply(this,arguments),e._styleChanges=[],e._fetchQueue=null,e._parseQueue=null,e._isTileHandlerReady=!1,e.fading=!1,e}return(0,o.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.layer.tileInfo;if((t&&t.spatialReference).equals(this.view.spatialReference)){var i=this.layer.currentStyleInfo.style;this._styleRepository=new ze.Z(i),this._tileInfoView=new Je(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new qe(this._tileInfoView),this._tileHandler=new J(this.layer,this._styleRepository,window.devicePixelRatio||1),this.container.addChild(this._vectorTileContainer),this.handles.add([this._vectorTileContainer.on("fade-start",(function(){e.fading=!0,e.notifyChange("updating"),e.requestUpdate()})),this._vectorTileContainer.on("fade-complete",(function(){e._collisionBoxesDisplay&&e._collisionBoxesDisplay.requestRender(),e.fading=!1,e.notifyChange("updating"),e.requestUpdate()})),(0,b.S1)(this.layer,"symbolCollisionBoxesVisible",(function(t){t?(e._collisionBoxesDisplay=new We({render:function(t){return e._renderCollisionBoxes(t.context)}}),e.container.addChild(e._collisionBoxesDisplay)):(e.container.removeChild(e._collisionBoxesDisplay),e._collisionBoxesDisplay=null)}))])}else this.addResolvingPromise(Promise.reject(new v.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))}},{key:"destroy",value:function(){var e;this._stop(),this.container.removeAllChildren(),this._vectorTileContainer&&(this._vectorTileContainer.destroy(),this._vectorTileContainer=null),null==(e=this._tileHandler)||e.destroy(),this._tileHandler=null}},{key:"hitTest",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t,i){var r,n,a,s,l,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this._tileHandlerPromise){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this._tileHandlerPromise;case 4:return e.next=6,this._vectorTileContainer.hitTest(i);case 6:if(r=e.sent,r&&0!==r.length){e.next=9;break}return e.abrupt("return",null);case 9:if(n=r[0]-1,a=this._styleRepository,s=a.getStyleLayerByUID(n),s){e.next=12;break}return e.abrupt("return",null);case 12:return l=a.getStyleLayerIndex(s.id),o=new f.Z({attributes:{layerId:l,layerName:s.id,layerUID:n}}),e.abrupt("return",(o.layer=this.layer,o.sourceLayer=this.layer,[o]));case 14:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"update",value:function(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=e.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}},{key:"attach",value:function(){var e=this;this._start(),this.handles.add([this.layer.on("paint-change",(function(t){if(t.isDataDriven)e._styleChanges.push({type:0,data:t}),e.notifyChange("updating"),e.requestUpdate();else{var i=e._styleRepository,r=i.getLayerById(t.layer);if(!r)return;var n=3===r.type;i.setPaintProperties(t.layer,t.paint),n&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender()}})),this.layer.on("layout-change",(function(t){var i=e._styleRepository,r=i.getLayerById(t.layer);if(r){var n=(0,k.Hg)(r.layout,t.layout);if(!(0,g.Wi)(n)){if((0,k.uD)(n,"visibility")&&1===$e(n))return i.setLayoutProperties(t.layer,t.layout),3===r.type&&e._vectorTileContainer.restartDeclutter(),void e._vectorTileContainer.requestRender();e._styleChanges.push({type:1,data:t}),e.notifyChange("updating"),e.requestUpdate()}}})),this.layer.on("style-layer-visibility-change",(function(t){var i=e._styleRepository,r=i.getLayerById(t.layer);r&&(i.setStyleLayerVisibility(t.layer,t.visibility),3===r.type&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender())})),this.layer.on("style-layer-change",(function(t){e._styleChanges.push({type:2,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("delete-style-layer",(function(t){e._styleChanges.push({type:3,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("load-style",(function(){return e._loadStyle()}))],this.declaredClass)}},{key:"detach",value:function(){this._stop(),this.handles.remove(this.declaredClass)}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this._collisionBoxesDisplay&&this._vectorTileContainer.restartDeclutter(),this.requestUpdate()}},{key:"canResume",value:function(){var e=(0,u.Z)((0,h.Z)(i.prototype),"canResume",this).call(this),t=this.layer;if(e&&t.currentStyleInfo){var r=this.view.scale,n=t.currentStyleInfo;if(n&&n.layerDefinition){var a=n.layerDefinition;a.minScale&&a.minScale<r&&(e=!1),a.maxScale&&a.maxScale>r&&(e=!1)}}return e}},{key:"isUpdating",value:function(){var e=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||e.length>0&&e.filter((function(e){return e.invalidating})).length>0||this.fading}},{key:"acquireTile",value:function(e){var t=this,i=this._createVectorTile(e);return this._tileHandlerPromise.then((function(){t._fetchQueue.push(i.key).then((function(e){return t._parseQueue.push({key:i.key,data:e})})).then((function(e){i.once("attach",(function(){return t.requestUpdate()})),i.setData(e),t.requestUpdate(),t.notifyChange("updating")})).catch((function(e){t.notifyChange("updating"),(0,m.D_)(e)||Ye.error(e)}))})),i}},{key:"releaseTile",value:function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}},{key:"_start",value:function(){var e=this;if(this._stop(),this._tileManager=new ee({acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:this._tileInfoView},this._vectorTileContainer),this.layer.currentStyleInfo){var t=new AbortController,i=this._tileHandler.start({signal:t.signal}).then((function(){e._fetchQueue=new Ge.Z({tileInfoView:e._tileInfoView,process:function(t,i){return e._getTileData(t,i)},concurrency:15}),e._parseQueue=new Ge.Z({tileInfoView:e._tileInfoView,process:function(t,i){return e._parseTileData(t,i)},concurrency:8}),e.requestUpdate(),e._isTileHandlerReady=!0}));this._tileHandler.spriteMosaic.then((function(t){e._vectorTileContainer.setStyleResources(t,e._tileHandler.glyphMosaic,e._styleRepository),e.requestUpdate()})),this._tileHandlerAbortController=t,this._tileHandlerPromise=i}}},{key:"_stop",value:function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null),this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null),this._tileManager&&(this._tileManager.destroy(),this._tileManager=null),this._vectorTileContainer.removeAllChildren()}}},{key:"_getTileData",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t,i){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._tileHandler.fetchTileData(t,i);case 2:return r=e.sent,e.abrupt("return",(this.notifyChange("updating"),r));case 4:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"_parseTileData",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t,i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this._tileHandler.parseTileData(t,i));case 1:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"_applyStyleChanges",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t,i,r,n,s,l,o,u,h,c,y,d,f,v=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._tileManager.clearCache(),t=this._styleChanges,e.prev=2,e.next=5,this._tileHandler.updateStyle(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](2),Ye.error("error applying vector-tiles style update",e.t0.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0;case 10:if(i=this._styleRepository,r=[],t.forEach((function(e){if(3===e.type){var t=e.data,n=i.getLayerById(t.layer);n&&r.push(n.uid)}})),n=[],t.forEach((function(e){var t=e.type,r=e.data;switch(t){case 0:i.setPaintProperties(r.layer,r.paint),s=r.layer;break;case 1:i.setLayoutProperties(r.layer,r.layout),s=r.layer;break;case 3:return void i.deleteStyleLayer(r.layer);case 2:i.setStyleLayer(r.layer,r.index),s=r.layer.id}var a=i.getLayerById(s);a&&n.push(a.uid)})),l=this._vectorTileContainer.children,r.length>0){this._vectorTileContainer.deleteStyleLayers(r),o=(0,a.Z)(l);try{for(o.s();!(u=o.n()).done;)h=u.value,h.deleteLayerData(r)}catch(p){o.e(p)}finally{o.f()}}if(this._fetchQueue.resume(),this._parseQueue.resume(),!(n.length>0)){e.next=22;break}c=[],y=(0,a.Z)(l);try{for(f=function(){var e=d.value,t=v._fetchQueue.push(e.key).then((function(t){return v._parseQueue.push({key:e.key,data:t,styleLayerUIDs:n})})).then((function(t){return e.setData(t)}));c.push(t)},y.s();!(d=y.n()).done;)f()}catch(p){y.e(p)}finally{y.f()}return e.next=22,Promise.all(c);case 22:this._styleChanges=[],this._isTileHandlerReady=!0,this.notifyChange("updating"),this.requestUpdate();case 23:case"end":return e.stop()}}),e,this,[[2,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"_loadStyle",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t,i,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.layer.currentStyleInfo.style,i=(0,p.d9)(t),this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this.notifyChange("updating"),this._styleRepository=new ze.Z(i),this._vectorTileContainer.destroy(),this._tileManager.clear(),this._tileHandlerAbortController.abort(),this._tileHandlerAbortController=new AbortController,r=this._tileHandlerAbortController.signal,e.prev=3,this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,i),e.next=7,this._tileHandlerPromise;case 7:e.next=13;break;case 9:if(e.prev=9,e.t0=e["catch"](3),(0,m.D_)(e.t0)){e.next=13;break}throw e.t0;case 13:if(!r.aborted){e.next=15;break}return e.abrupt("return",(this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange("updating"),void this.requestUpdate()));case 15:return e.next=17,this._tileHandler.spriteMosaic;case 17:n=e.sent,this._vectorTileContainer.setStyleResources(n,this._tileHandler.glyphMosaic,this._styleRepository),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange("updating"),this.requestUpdate();case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"_createVectorTile",value:function(e){var t=this._tileInfoView.getTileBounds((0,Z.Ue)(),e);return new me(e,t[0],t[3],512,512,this._styleRepository)}},{key:"_renderCollisionBoxes",value:function(e){var t,i=(0,a.Z)(this._vectorTileContainer.children);try{for(i.s();!(t=i.n()).done;){var s=t.value;if(s.symbols){var l,o=[],u=(0,a.Z)(s.symbols);try{for(u.s();!(l=u.n()).done;){var h=(0,n.Z)(l.value,2),c=(h[0],h[1]);o.push.apply(o,(0,r.Z)(c))}}catch(y){u.e(y)}finally{u.f()}W(e,o)}}}catch(y){i.e(y)}finally{i.f()}}}]),i}((0,He.y)(Ke.Z));function $e(e){if((0,g.Wi)(e))return 0;switch(e.type){case"partial":return Object.keys(e.diff).length;case"complete":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case"collection":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}(0,d._)([(0,w.Cb)()],Xe.prototype,"_fetchQueue",void 0),(0,d._)([(0,w.Cb)()],Xe.prototype,"_parseQueue",void 0),(0,d._)([(0,w.Cb)()],Xe.prototype,"_isTileHandlerReady",void 0),(0,d._)([(0,w.Cb)()],Xe.prototype,"fading",void 0),Xe=(0,d._)([(0,x.j)("esri.views.2d.layers.VectorTileLayerView2D")],Xe);var et=Xe},74139:function(e,t,i){i.d(t,{Z:function(){return g}});var r=i(76133),n=i(92751),a=i(99418),s=i(49161),l=(i(68309),i(92222),i(63825)),o=i(44171),u=i(78534),h=i(48595),c=i(7054),y=i(87441),d=i(27092),f=i(69324),v=i(2553),p=(i(57787),i(35425),i(90202),i(92236)),_=function(e){(0,a.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,r.Z)(this,i),n=t.call(this,e),n.layer=null,n.parent=null,n}return(0,n.Z)(i,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var i=e.layer&&e.layer.id||"no id",r=e.layer&&e.layer.title||"no title";throw y.Z.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(i,"')"),t),t}}))}},{key:"fullOpacity",get:function(){return(0,d.Pt)(this.get("layer.opacity"),1)*(0,d.Pt)(this.get("parent.fullOpacity"),1)}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){var e;return!0===(null==(e=this.layer)?void 0:e.visible)},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{},t=this;return t.view&&t.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),i}((0,h.p)((0,c.I)((0,f.v)(u.Z.EventedMixin(o.Z)))));(0,l._)([(0,v.Cb)()],_.prototype,"fullOpacity",null),(0,l._)([(0,v.Cb)()],_.prototype,"layer",void 0),(0,l._)([(0,v.Cb)()],_.prototype,"parent",void 0),(0,l._)([(0,v.Cb)({readOnly:!0})],_.prototype,"suspended",null),(0,l._)([(0,v.Cb)({readOnly:!0})],_.prototype,"suspendInfo",null),(0,l._)([(0,v.Cb)({readOnly:!0})],_.prototype,"legendEnabled",null),(0,l._)([(0,v.Cb)({type:Boolean,readOnly:!0})],_.prototype,"updating",null),(0,l._)([(0,v.Cb)({readOnly:!0})],_.prototype,"updatingProgress",null),(0,l._)([(0,v.Cb)()],_.prototype,"visible",null),_=(0,l._)([(0,p.j)("esri.views.layers.LayerView")],_);var g=_}}]);