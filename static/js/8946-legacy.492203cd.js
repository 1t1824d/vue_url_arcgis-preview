"use strict";(self["webpackChunkvue_url_arcgis"]=self["webpackChunkvue_url_arcgis"]||[]).push([[8946],{48946:function(e,t,i){i.r(t),i.d(t,{default:function(){return x}});var r=i(16198),n=i(62032),s=i(76133),a=i(92751),u=(i(78975),i(51532),i(41539),i(78783),i(33948),i(54747),i(70189),i(38862),i(25585)),o=i(87441),h=i(27092),l=i(49938),c=i(75012),d=i(57446),f=i(70805),y=i(63608),p=i(17562),v=i(31023),_=o.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),m={getAttribute:function(e,t){return e.field(t)}};function w(e,t){return b.apply(this,arguments)}function b(){return b=(0,r.Z)(regeneratorRuntime.mark((function e(t,r){var n,s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.e(7263).then(i.bind(i,77263));case 2:return n=e.sent,e.prev=3,s=n.WhereClause.create(t,r),s.isStandardized||(a=new u.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",s),_.error(a)),e.abrupt("return",(function(e){var t=e.readArcadeFeature();return s.testFeature(t,m)}));case 9:return e.prev=9,e.t0=e["catch"](3),e.abrupt("return",(_.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),function(e){return!0}));case 12:case"end":return e.stop()}}),e,null,[[3,9]])}))),b.apply(this,arguments)}var g=o.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter"),k=1,I=2,x=function(){function e(t){(0,s.Z)(this,e),this._geometryBounds=(0,l.Ue)(),this._idToVisibility=new Map,this._serviceInfo=t}return(0,a.Z)(e,[{key:"hash",get:function(){return this._hash}},{key:"check",value:function(e){return this._applyFilter(e)}},{key:"clear",value:function(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}},{key:"invalidate",value:function(){var e=this;this._idToVisibility.forEach((function(t,i){e._idToVisibility.set(i,0)}))}},{key:"setKnownIds",value:function(e){var t,i=(0,n.Z)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._idToVisibility.set(r,k)}}catch(s){i.e(s)}finally{i.f()}}},{key:"setTrue",value:function(e){var t=this,i=[],r=[],n=new Set(e);return this._idToVisibility.forEach((function(e,s){var a=!!(t._idToVisibility.get(s)&k),u=n.has(s);!a&&u?i.push(s):a&&!u&&r.push(s),t._idToVisibility.set(s,u?k|I:0)})),{show:i,hide:r}}},{key:"createQuery",value:function(){var e=this.geometry,t=this.spatialRel,i=this.where,r=this.timeExtent,n=this.objectIds;return p.Z.fromJSON({geometry:e,spatialRel:t,where:i,timeExtent:r,objectIds:n})}},{key:"update",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t,i){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this._hash=JSON.stringify(t),e.next=3,(0,y.j6)(t,null,i);case 3:return r=e.sent,e.next=6,Promise.all([this._setGeometryFilter(r),this._setIdFilter(r),this._setAttributeFilter(r),this._setTimeFilter(r)]);case 6:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"_setAttributeFilter",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t&&t.where){e.next=2;break}return e.abrupt("return",(this._clause=null,void(this.where=null)));case 2:return e.next=4,w(t.where,this._serviceInfo.fieldsIndex);case 4:this._clause=e.sent,this.where=t.where;case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_setIdFilter",value:function(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}},{key:"_setGeometryFilter",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){var i,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t&&t.geometry){e.next=2;break}return e.abrupt("return",(this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null)));case 2:return i=t.geometry,r=t.spatialRel||"esriSpatialRelIntersects",e.next=6,(0,d.cW)(r,i,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);case 6:n=e.sent,(0,c.$P)(this._geometryBounds,i),this._spatialQueryOperator=n,this.geometry=i,this.spatialRel=r;case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_setTimeFilter",value:function(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=(0,f.y)(this._serviceInfo.timeInfo,e.timeExtent,v.k);else{var t=new u.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);g.error(t)}}},{key:"_applyFilter",value:function(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}},{key:"_filterByExpression",value:function(e){return!this.where||this._clause(e)}},{key:"_filterById",value:function(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}},{key:"_filterByGeometry",value:function(e){if(!this.geometry)return!0;var t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}},{key:"_filterByTime",value:function(e){return!(0,h.pC)(this._timeOperator)||this._timeOperator(e)}},{key:"_resetAllHiddenIds",value:function(){var e=this,t=[];return this._idToVisibility.forEach((function(i,r){i&k||(e._idToVisibility.set(r,k),t.push(r))})),t}}]),e}()}}]);